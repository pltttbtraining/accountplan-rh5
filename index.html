<!doctype html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Customer Coaching Support System</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #007AFF;
      --primary-dark: #0056CC;
      --primary-light: #66AFFF;
      --secondary-color: #8E8E93;
      --accent-color: #34C759;
      --success-color: #30D158;
      --warning-color: #FF9500;
      --danger-color: #FF3B30;
      --background-color: #F2F2F7;
      --surface-color: #FFFFFF;
      --border-color: #C6C6C8;
      --text-primary: #000000;
      --text-secondary: #3C3C43;
      --text-muted: #8E8E93;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
      --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
      --shadow-xl: 0 20px 25px rgba(0,0,0,0.1);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--background-color);
      color: var(--text-primary);
      line-height: 1.6;
      font-size: 14px;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Welcome Screen Styles */
    .welcome-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 1s ease, transform 1s ease;
    }

    .welcome-content {
      text-align: center;
      color: white;
      max-width: 600px;
      padding: 2rem;
    }

    .welcome-logo {
      font-size: 4rem;
      margin-bottom: 1.5rem;
      animation: pulse 2s infinite;
    }

    .welcome-title {
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 1rem;
      letter-spacing: -0.025em;
      opacity: 0;
      animation: fadeInUp 1.5s ease forwards 0.5s;
    }

    .welcome-subtitle {
      font-size: 1.5rem;
      font-weight: 400;
      margin-bottom: 3rem;
      opacity: 0.9;
      opacity: 0;
      animation: fadeInUp 1.5s ease forwards 1s;
    }

    .enter-button {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 1rem 3rem;
      border-radius: 50px;
      font-size: 1.25rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      opacity: 0;
      animation: fadeInUp 1.5s ease forwards 1.5s;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    }

    .enter-button:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-5px);
      box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.5);
    }

    .welcome-screen.fade-out {
      opacity: 0;
      transform: scale(1.1);
      pointer-events: none;
    }

    /* Main App Styles (hidden initially) */
    .main-app {
      opacity: 0;
      transition: opacity 1s ease;
    }

    .main-app.show {
      opacity: 1;
    }

    .header {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 2rem 0;
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
      opacity: 0.3;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
      position: relative;
      z-index: 1;
    }

    .header h1 {
      margin: 0 0 0.5rem 0;
      font-size: 2.5rem;
      font-weight: 700;
      letter-spacing: -0.025em;
    }

    .header p {
      margin: 0;
      font-size: 1.125rem;
      opacity: 0.9;
      font-weight: 400;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    .role-selector {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .role-card {
      background: var(--surface-color);
      border: 2px solid var(--border-color);
      border-radius: var(--radius-xl);
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: var(--shadow-sm);
      position: relative;
      overflow: hidden;
    }

    .role-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 122, 255, 0.05), transparent);
      transition: left 0.5s ease;
    }

    .role-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
      border-color: var(--primary-light);
    }

    .role-card:hover::before {
      left: 100%;
    }

    .role-card.active {
      border-color: var(--primary-color);
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      color: white;
      box-shadow: var(--shadow-xl);
    }

    .role-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      display: block;
      filter: grayscale(0.2);
    }

    .role-card.active .role-icon {
      filter: none;
    }

    .role-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      letter-spacing: -0.025em;
    }

    .role-description {
      font-size: 0.875rem;
      opacity: 0.8;
      line-height: 1.5;
    }

    .main-content {
      background: var(--surface-color);
      border-radius: var(--radius-xl);
      padding: 2rem;
      box-shadow: var(--shadow-md);
      margin-top: 1.5rem;
      border: 1px solid var(--border-color);
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.3s ease;
    }

    .main-content.show {
      opacity: 1;
      transform: translateY(0);
    }

    .progress-container {
      background: var(--background-color);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      margin-bottom: 2rem;
      border: 1px solid var(--border-color);
    }

    .progress-bar {
      background: var(--border-color);
      border-radius: var(--radius-md);
      height: 8px;
      margin-bottom: 1rem;
      overflow: hidden;
    }

    .progress-fill {
      background: linear-gradient(90deg, var(--primary-color) 0%, var(--accent-color) 100%);
      height: 100%;
      width: 0%;
      transition: width 0.3s ease;
      border-radius: var(--radius-md);
    }

    .step-indicator {
      display: flex;
      justify-content: space-between;
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    .step {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 500;
    }

    .step.active {
      color: var(--primary-color);
      font-weight: 600;
    }

    .form-section {
      margin-bottom: 2rem;
      padding: 1.5rem;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      transition: all 0.2s ease;
      background: var(--surface-color);
    }

    .form-section:hover {
      border-color: var(--primary-light);
      box-shadow: var(--shadow-sm);
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .section-icon {
      font-size: 1.5rem;
      color: var(--primary-color);
      background: rgba(0, 122, 255, 0.1);
      padding: 0.75rem;
      border-radius: var(--radius-md);
    }

    .section-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
      letter-spacing: -0.025em;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text-primary);
      font-size: 0.875rem;
    }

    .form-sublabel {
      font-size: 0.75rem;
      color: var(--text-muted);
      font-weight: 400;
      margin-left: 0.25rem;
    }

    .form-input, .form-select {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      transition: all 0.2s ease;
      background: var(--surface-color);
      color: var(--text-primary);
      font-family: inherit;
    }

    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    }

    .form-input:disabled, .form-select:disabled {
      background: var(--background-color);
      color: var(--text-muted);
      cursor: not-allowed;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 0.5rem;
      padding: 0.75rem;
      background: var(--background-color);
      border-radius: var(--radius-sm);
      border: 1px solid var(--border-color);
    }

    .checkbox-input {
      width: 16px;
      height: 16px;
      accent-color: var(--primary-color);
    }

    .checkbox-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      cursor: pointer;
    }

    .customer-type-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .customer-type-card {
      padding: 1.5rem;
      border: 2px solid var(--border-color);
      border-radius: var(--radius-lg);
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
      background: var(--surface-color);
    }

    .customer-type-card:hover {
      border-color: var(--primary-light);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .customer-type-card.selected {
      border-color: var(--primary-color);
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      color: white;
      box-shadow: var(--shadow-lg);
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-family: inherit;
      letter-spacing: -0.025em;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      color: white;
      box-shadow: var(--shadow-sm);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .btn-secondary {
      background: var(--secondary-color);
      color: white;
    }

    .btn-secondary:hover {
      background: #6d6d73;
      transform: translateY(-1px);
    }

    .btn-danger {
      background: var(--danger-color);
      color: white;
    }

    .btn-danger:hover {
      background: #d70015;
      transform: translateY(-1px);
    }

    .btn-outline {
      background: transparent;
      color: var(--primary-color);
      border: 1px solid var(--primary-color);
    }

    .btn-outline:hover {
      background: var(--primary-color);
      color: white;
    }

    .floating-save {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      z-index: 1000;
      border-radius: var(--radius-xl);
      padding: 1rem 2rem;
      box-shadow: var(--shadow-xl);
      font-size: 1rem;
    }

    .search-section {
      background: var(--background-color);
      padding: 2rem;
      border-radius: var(--radius-lg);
      margin-bottom: 2rem;
      border: 1px solid var(--border-color);
    }

    .search-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .search-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    .search-controls {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .search-input {
      flex: 1;
      min-width: 300px;
      padding: 0.75rem 1rem;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      font-size: 0.875rem;
    }

    .filter-buttons {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 0.5rem 1rem;
      border: 1px solid var(--border-color);
      background: var(--surface-color);
      color: var(--text-secondary);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.875rem;
    }

    .filter-btn:hover {
      border-color: var(--primary-color);
      color: var(--primary-color);
    }

    .filter-btn.active {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    .customer-card {
      background: var(--surface-color);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      margin-bottom: 1rem;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-color);
      border-left: 4px solid var(--primary-color);
      transition: all 0.2s ease;
    }

    .customer-card:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-1px);
    }

    .customer-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .customer-name {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }

    .customer-meta {
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    .customer-level {
      padding: 0.5rem 1rem;
      border-radius: var(--radius-md);
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .level-critical {
      background: rgba(255, 59, 48, 0.1);
      color: var(--danger-color);
      border: 1px solid rgba(255, 59, 48, 0.2);
    }

    .level-strategic {
      background: rgba(255, 149, 0, 0.1);
      color: var(--warning-color);
      border: 1px solid rgba(255, 149, 0, 0.2);
    }

    .level-wealth {
      background: rgba(48, 209, 88, 0.1);
      color: var(--success-color);
      border: 1px solid rgba(48, 209, 88, 0.2);
    }

    .analysis-result {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 2rem;
      border-radius: var(--radius-lg);
      margin-top: 2rem;
      box-shadow: var(--shadow-lg);
    }

    .analysis-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .analysis-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
    }

    .analysis-item {
      background: rgba(255, 255, 255, 0.1);
      padding: 1.5rem;
      border-radius: var(--radius-md);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .analysis-label {
      font-size: 0.875rem;
      opacity: 0.8;
      margin-bottom: 0.5rem;
    }

    .analysis-value {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .admin-controls {
      background: var(--background-color);
      padding: 2rem;
      border-radius: var(--radius-lg);
      margin-bottom: 2rem;
      border: 1px solid var(--border-color);
    }

    .admin-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .admin-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    .filter-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .filter-label {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-primary);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .stat-card {
      background: var(--surface-color);
      padding: 1.5rem;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-color);
      text-align: center;
    }

    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 0.5rem;
    }

    .stat-label {
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    .toast {
      position: fixed;
      top: 2rem;
      right: 2rem;
      background: var(--success-color);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      z-index: 1001;
      opacity: 0;
      transform: translateX(100%);
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(0);
    }

    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeInUp {
      from { 
        opacity: 0; 
        transform: translateY(30px); 
      }
      to { 
        opacity: 1; 
        transform: translateY(0); 
      }
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
      20%, 40%, 60%, 80% { transform: translateX(3px); }
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      animation: fadeIn 0.3s ease forwards;
    }

    .modal-content {
      background: var(--surface-color);
      padding: 2rem;
      border-radius: var(--radius-xl);
      text-align: center;
      max-width: 450px;
      width: 90%;
      box-shadow: var(--shadow-xl);
      border: 1px solid var(--border-color);
      transform: scale(0.9);
      animation: modalIn 0.3s ease forwards;
    }

    @keyframes modalIn {
      to {
        transform: scale(1);
      }
    }

    .modal-title {
      color: var(--primary-color);
      margin-bottom: 1.5rem;
      font-size: 1.5rem;
      font-weight: 600;
    }

    .modal-message {
      background: var(--background-color);
      padding: 1.5rem;
      border-radius: var(--radius-md);
      margin-bottom: 1.5rem;
      border: 1px solid var(--border-color);
    }

    .modal-input {
      width: 100%;
      padding: 1rem;
      border: 2px solid var(--border-color);
      border-radius: var(--radius-md);
      font-size: 1rem;
      margin-bottom: 1.5rem;
      text-align: center;
      letter-spacing: 2px;
      font-family: inherit;
    }

    .modal-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .modal-error {
      color: var(--danger-color);
      margin-top: 1rem;
      font-size: 0.875rem;
      display: none;
    }

    /* Zone Selection Styles */
    .zone-selector {
      background: linear-gradient(135deg, rgba(0, 122, 255, 0.05) 0%, rgba(102, 175, 255, 0.05) 100%);
      border: 1px solid rgba(0, 122, 255, 0.1);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .zone-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--primary-color);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Enhanced Button Styles */
    .btn-group {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .btn-sm {
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
    }

    .btn-icon {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Data Table Styles */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--surface-color);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-color);
    }

    .data-table th {
      background: var(--background-color);
      padding: 1rem;
      text-align: left;
      font-weight: 600;
      color: var(--text-primary);
      border-bottom: 1px solid var(--border-color);
      font-size: 0.875rem;
    }

    .data-table td {
      padding: 1rem;
      border-bottom: 1px solid var(--border-color);
      font-size: 0.875rem;
    }

    .data-table tr:hover {
      background: var(--background-color);
    }

    /* Enhanced Form Sections */
    .form-subsection {
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 1.5rem;
      margin-bottom: 1rem;
      background: var(--surface-color);
    }

    .subsection-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .subsection-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--primary-color);
      margin: 0;
    }

    .remove-btn {
      background: var(--danger-color);
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .remove-btn:hover {
      background: #d70015;
    }

    /* Tab Styles */
    .tab-btn {
      padding: 0.75rem 1.5rem;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s ease;
      font-size: 0.875rem;
      font-weight: 500;
      font-family: inherit;
    }

    .tab-btn:hover {
      color: var(--primary-color);
      background: rgba(0, 122, 255, 0.05);
    }

    .tab-btn.active {
      color: var(--primary-color);
      border-bottom-color: var(--primary-color);
      background: rgba(0, 122, 255, 0.1);
    }

    .tab-content {
      animation: fadeIn 0.3s ease;
    }

    /* Comment Type Badges */
    .comment-type-badge {
      padding: 0.25rem 0.5rem;
      border-radius: var(--radius-sm);
      font-size: 0.75rem;
      font-weight: 600;
    }

    .comment-type-badge.general {
      background: rgba(142, 142, 147, 0.1);
      color: var(--secondary-color);
    }

    .comment-type-badge.recommendation {
      background: rgba(0, 122, 255, 0.1);
      color: var(--primary-color);
    }

    .comment-type-badge.follow_up {
      background: rgba(52, 199, 89, 0.1);
      color: var(--accent-color);
    }

    .comment-type-badge.concern {
      background: rgba(255, 149, 0, 0.1);
      color: var(--warning-color);
    }

    .comment-type-badge.opportunity {
      background: rgba(88, 86, 214, 0.1);
      color: #5856D6;
    }

    /* Glass morphism buttons */
    .glass-btn {
      background: rgba(255, 255, 255, 0.1) !important;
      backdrop-filter: blur(10px) !important;
      border: 1px solid rgba(255, 255, 255, 0.2) !important;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37) !important;
      transition: all 0.3s ease !important;
    }

    .glass-btn:hover {
      background: rgba(255, 255, 255, 0.2) !important;
      transform: translateY(-2px) !important;
      box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.5) !important;
    }

    .glass-btn:active {
      transform: translateY(0) !important;
    }

    .btn-primary.glass-btn {
      background: rgba(0, 122, 255, 0.3) !important;
      color: white !important;
    }

    .btn-primary.glass-btn:hover {
      background: rgba(0, 122, 255, 0.5) !important;
    }

    .btn-secondary.glass-btn {
      background: rgba(142, 142, 147, 0.3) !important;
      color: white !important;
    }

    .btn-secondary.glass-btn:hover {
      background: rgba(142, 142, 147, 0.5) !important;
    }

    .btn-danger.glass-btn {
      background: rgba(255, 59, 48, 0.3) !important;
      color: white !important;
    }

    .btn-danger.glass-btn:hover {
      background: rgba(255, 59, 48, 0.5) !important;
    }

    .btn-outline.glass-btn {
      background: rgba(255, 255, 255, 0.05) !important;
      color: var(--primary-color) !important;
      border: 1px solid rgba(0, 122, 255, 0.3) !important;
    }

    .btn-outline.glass-btn:hover {
      background: rgba(0, 122, 255, 0.1) !important;
      color: var(--primary-color) !important;
    }

    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }
      
      .header h1 {
        font-size: 2rem;
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .customer-type-grid {
        grid-template-columns: 1fr;
      }
      
      .floating-save {
        bottom: 1rem;
        right: 1rem;
        padding: 0.75rem 1.5rem;
      }

      .search-controls {
        flex-direction: column;
      }

      .search-input {
        min-width: auto;
      }

      .filter-buttons {
        justify-content: center;
      }

      .welcome-title {
        font-size: 2rem;
      }

      .welcome-subtitle {
        font-size: 1.25rem;
      }
    }
  </style>
</head>
<body>
  <!-- Welcome Screen -->
  <div class="welcome-screen" id="welcomeScreen">
    <div class="welcome-content">
      <div class="welcome-logo">📊</div>
      <h1 class="welcome-title">Welcome to RH5 Customer Analysis System</h1>
      <p class="welcome-subtitle">ระบบวิเคราะห์ลูกค้าเพื่อการให้คำปรึกษาอย่างมืออาชีพ</p>
      <button class="enter-button" id="enterButton">เข้าสู่ระบบ</button>
    </div>
  </div>

  <!-- Main Application (hidden initially) -->
  <div class="main-app" id="mainApp">
    <div class="header">
      <div class="header-content">
        <h1 id="system-title">Customer Coaching Support System</h1>
        <p id="company-name">TTB Bank - ระบบสนับสนุนการให้คำปรึกษาลูกค้า</p>
      </div>
    </div>
    
    <div class="container">
      <!-- Role Selection -->
      <div class="role-selector" id="roleSelector">
        <div class="role-card" data-role="employee">
          <span class="role-icon">👨‍💼</span>
          <div class="role-title">Employee / Sales</div>
          <div class="role-description">สำหรับพนักงานขาย - กรอกข้อมูลลูกค้าใหม่และวิเคราะห์ความต้องการ</div>
        </div>
        <div class="role-card" data-role="coach">
          <span class="role-icon">🎯</span>
          <div class="role-title">Coach</div>
          <div class="role-description">สำหรับผู้ให้คำปรึกษา - ค้นหาข้อมูลลูกค้าและเพิ่ม Notes</div>
        </div>
        <div class="role-card" data-role="admin">
          <span class="role-icon">⚙️</span>
          <div class="role-title">Admin</div>
          <div class="role-description">สำหรับผู้ดูแลระบบ - จัดการข้อมูลทั้งหมด</div>
        </div>
      </div>

      <!-- Main Content Areas -->
      <div class="main-content" id="employeeContent">
        <!-- Customer Search Section -->
        <div class="search-section" style="margin-bottom: 2rem;">
          <div class="search-header">
            <span style="font-size: 1.5rem;">🔍</span>
            <h3 class="search-title">ค้นหาข้อมูลลูกค้าเดิม</h3>
          </div>
          <div class="search-controls">
            <input type="text" class="search-input" id="employeeSearchInput" placeholder="ใส่ Customer ID เพื่อค้นหาข้อมูลลูกค้า..." style="flex: 1; min-width: 300px;">
            <button type="button" class="btn btn-primary btn-icon" onclick="searchExistingCustomer()">🔍 ค้นหา</button>
            <button type="button" class="btn btn-outline btn-icon" onclick="clearSearch()">🗑️ ล้างการค้นหา</button>
          </div>
          <div id="searchResultContainer" style="display: none; margin-top: 1.5rem;"></div>
        </div>

        <div class="progress-container">
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div class="step-indicator">
            <div class="step active" id="step1"><span>📋</span> ข้อมูลพื้นฐาน</div>
            <div class="step" id="step2"><span>👤</span> ข้อมูลส่วนตัว</div>
            <div class="step" id="step3"><span>👨‍👩‍👧‍👦</span> ข้อมูลครอบครัว</div>
            <div class="step" id="step4"><span>🏢</span> ข้อมูลธุรกิจ</div>
            <div class="step" id="step5"><span>📊</span> วิเคราะห์ผล</div>
          </div>
        </div>

        <form id="customerForm">
          <!-- Section 1: Basic Information -->
          <div class="form-section">
            <div class="section-header">
              <span class="section-icon">📋</span>
              <h3 class="section-title">ข้อมูลพื้นฐาน</h3>
            </div>
            
            <!-- Zone Selection -->
            <div class="zone-selector">
              <div class="zone-title"><span>📍</span> เลือก Zone ที่สังกัด</div>
              <select class="form-select" id="employeeZone" required>
                <option value="">เลือก Zone</option>
                <option value="ratchaburi">Zone ราชบุรี</option>
                <option value="suratthani">Zone สุราษฎร์ธานี</option>
                <option value="hatyai">Zone หาดใหญ่</option>
                <option value="phuket">Zone ภูเก็ต</option>
                <option value="samutsakorn">Zone สมุทรสาคร</option>
              </select>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Customer ID <span class="form-sublabel">(สร้างอัตโนมัติ)</span></label>
                <input type="text" class="form-input" id="customerId" readonly style="background: var(--background-color); color: var(--text-muted);">
              </div>
              <div class="form-group">
                <label class="form-label">ชื่อพนักงาน <span class="form-sublabel">(ผู้กรอกข้อมูล)</span></label>
                <input type="text" class="form-input" id="employeeName" required>
              </div>
              <div class="form-group">
                <label class="form-label">ชื่อลูกค้า <span class="form-sublabel">(ชื่อ-นามสกุล)</span></label>
                <input type="text" class="form-input" id="customerName" required>
              </div>
            </div>
            
            <div class="form-group">
              <label class="form-label">ลักษณะลูกค้า <span class="form-sublabel">(เลือก 1 ลักษณะ)</span></label>
              <div class="customer-type-grid">
                <div class="customer-type-card" data-type="goal_oriented">
                  <h4>🎯 เป้าประสงค์</h4>
                  <p>มีเป้าหมายชัดเจน วางแผนระยะยาว</p>
                </div>
                <div class="customer-type-card" data-type="celebrity">
                  <h4>⭐ หนึ่งดารา</h4>
                  <p>ชอบความโดดเด่น สนใจภาพลักษณ์</p>
                </div>
                <div class="customer-type-card" data-type="analytical">
                  <h4>🧮 คิดคำนวณ</h4>
                  <p>วิเคราะห์รายละเอียด ตัดสินใจด้วยข้อมูล</p>
                </div>
                <div class="customer-type-card" data-type="conservative">
                  <h4>🛡️ ถนอมจิตร</h4>
                  <p>ระมัดระวัง รักษาความมั่นคง</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Section 2: Personal Information -->
          <div class="form-section">
            <div class="section-header">
              <span class="section-icon">👤</span>
              <h3 class="section-title">ข้อมูลส่วนตัว</h3>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">อาชีพ <span class="form-sublabel">(อาชีพหลัก)</span></label>
                <select class="form-select" id="occupation">
                  <option value="">เลือกอาชีพ</option>
                  <option value="government">ข้าราชการ</option>
                  <option value="business_owner">ธุรกิจส่วนตัว</option>
                  <option value="employee">พนักงานบริษัท</option>
                  <option value="freelance">อาชีพอิสระ</option>
                  <option value="trader">ค้าขาย</option>
                  <option value="other">อื่นๆ</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">รายละเอียดอาชีพ <span class="form-sublabel">(ตำแหน่งงาน/ประเภทธุรกิจ)</span></label>
                <input type="text" class="form-input" id="occupationDetail" placeholder="เช่น Manager, วิศวกร, ร้านอาหาร">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownOccupationDetail">
                  <label class="checkbox-label" for="unknownOccupationDetail">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">รายได้สุทธิ/ปี <span class="form-sublabel">(บาท)</span></label>
                <input type="number" class="form-input" id="netIncome" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownNetIncome">
                  <label class="checkbox-label" for="unknownNetIncome">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
            </div>

            <!-- Assets Section -->
            <h4 style="margin: 2rem 0 1rem 0; color: var(--primary-color); font-weight: 600;">💰 ทรัพย์สิน</h4>
            
            <!-- Real Estate Section -->
            <div class="form-subsection">
              <div class="subsection-header">
                <h5 class="subsection-title">🏠 อสังหาริมทรัพย์</h5>
                <button type="button" class="btn btn-primary btn-sm" onclick="addRealEstate()">+ เพิ่มอสังหาฯ</button>
              </div>
              <div id="realEstateContainer">
                <div class="real-estate-item" data-index="0">
                  <div class="form-grid">
                    <div class="form-group">
                      <label class="form-label">ประเภท</label>
                      <input type="text" class="form-input real-estate-type" placeholder="เช่น บ้าน, คอนโด, ที่ดิน">
                      <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="unknownRealEstateType0">
                        <label class="checkbox-label" for="unknownRealEstateType0">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="form-label">มูลค่า <span class="form-sublabel">(บาท)</span></label>
                      <input type="number" class="form-input real-estate-value" placeholder="0">
                      <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="unknownRealEstateValue0">
                        <label class="checkbox-label" for="unknownRealEstateValue0">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Vehicle Section -->
            <div class="form-subsection">
              <div class="subsection-header">
                <h5 class="subsection-title">🚗 ยานพาหนะ</h5>
                <button type="button" class="btn btn-primary btn-sm" onclick="addVehicle()">+ เพิ่มยานพาหนะ</button>
              </div>
              <div id="vehicleContainer">
                <div class="vehicle-item" data-index="0">
                  <div class="form-grid">
                    <div class="form-group">
                      <label class="form-label">ประเภท</label>
                      <input type="text" class="form-input vehicle-type" placeholder="เช่น รถยนต์, รถจักรยานยนต์">
                      <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="unknownVehicleType0">
                        <label class="checkbox-label" for="unknownVehicleType0">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="form-label">มูลค่า <span class="form-sublabel">(บาท)</span></label>
                      <input type="number" class="form-input vehicle-value" placeholder="0">
                      <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="unknownVehicleValue0">
                        <label class="checkbox-label" for="unknownVehicleValue0">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">เงินฝาก <span class="form-sublabel">(บาท)</span></label>
                <input type="number" class="form-input" id="savings" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownSavings">
                  <label class="checkbox-label" for="unknownSavings">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">หุ้นกู้ <span class="form-sublabel">(บาท)</span></label>
                <input type="number" class="form-input" id="bonds" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownBonds">
                  <label class="checkbox-label" for="unknownBonds">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">กองทุน <span class="form-sublabel">(บาท)</span></label>
                <input type="number" class="form-input" id="funds" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownFunds">
                  <label class="checkbox-label" for="unknownFunds">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">บัตรเครดิต <span class="form-sublabel">(วงเงิน - บาท)</span></label>
                <input type="number" class="form-input" id="creditCards" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownCreditCards">
                  <label class="checkbox-label" for="unknownCreditCards">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">สินเชื่อ <span class="form-sublabel">(ยอดคงเหลือ - บาท)</span></label>
                <input type="number" class="form-input" id="loans" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownLoans">
                  <label class="checkbox-label" for="unknownLoans">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
            </div>

            <!-- Insurance Section -->
            <div class="form-subsection">
              <div class="subsection-header">
                <h4 class="subsection-title">🛡️ ประกันชีวิต</h4>
                <button type="button" class="btn btn-primary btn-sm" onclick="addInsurance()">+ เพิ่มประกัน</button>
              </div>
              <div id="insuranceContainer">
                <div class="insurance-item" data-index="0">
                  <div class="form-grid">
                    <div class="form-group">
                      <label class="form-label">ประเภทความคุ้มครอง</label>
                      <select class="form-select insurance-type">
                        <option value="">เลือกประเภท</option>
                        <option value="life">ประกันชีวิต</option>
                        <option value="health">ประกันสุขภาพ</option>
                        <option value="critical_illness">ประกันโรคร้ายแรง</option>
                        <option value="accident">ประกันอุบัติเหตุ</option>
                        <option value="disability">ประกันทุพพลภาพ</option>
                        <option value="other">อื่นๆ</option>
                      </select>
                      <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="unknownInsuranceType0">
                        <label class="checkbox-label" for="unknownInsuranceType0">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="form-label">ทุนประกัน <span class="form-sublabel">(บาท)</span></label>
                      <input type="number" class="form-input insurance-amount" placeholder="0">
                      <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="unknownInsuranceAmount0">
                        <label class="checkbox-label" for="unknownInsuranceAmount0">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="form-label">เบี้ยประกัน/ปี <span class="form-sublabel">(บาท)</span></label>
                      <input type="number" class="form-input insurance-premium" placeholder="0">
                      <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="unknownInsurancePremium0">
                        <label class="checkbox-label" for="unknownInsurancePremium0">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Investment Section -->
            <h4 style="margin: 2rem 0 1rem 0; color: var(--primary-color); font-weight: 600;">📈 การลงทุน</h4>
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">AUM TTB <span class="form-sublabel">(บาท)</span></label>
                <input type="number" class="form-input" id="aumTtb" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownAumTtb">
                  <label class="checkbox-label" for="unknownAumTtb">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">AUM ที่อื่นๆ <span class="form-sublabel">(บาท)</span></label>
                <input type="number" class="form-input" id="aumOthers" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownAumOthers">
                  <label class="checkbox-label" for="unknownAumOthers">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
            </div>
          </div>

          <!-- Section 3: Family Information -->
          <div class="form-section">
            <div class="section-header">
              <span class="section-icon">👨‍👩‍👧‍👦</span>
              <h3 class="section-title">ข้อมูลครอบครัว</h3>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">อายุคู่สมรส <span class="form-sublabel">(ปี)</span></label>
                <input type="number" class="form-input" id="spouseAge" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownSpouseAge">
                  <label class="checkbox-label" for="unknownSpouseAge">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">อาชีพคู่สมรส</label>
                <select class="form-select" id="spouseOccupation">
                  <option value="">เลือกอาชีพ</option>
                  <option value="government">ข้าราชการ</option>
                  <option value="business_owner">ธุรกิจส่วนตัว</option>
                  <option value="employee">พนักงานบริษัท</option>
                  <option value="freelance">อาชีพอิสระ</option>
                  <option value="trader">ค้าขาย</option>
                  <option value="housewife">แม่บ้าน/พ่อบ้าน</option>
                  <option value="other">อื่นๆ</option>
                </select>
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownSpouseOccupation">
                  <label class="checkbox-label" for="unknownSpouseOccupation">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">รายละเอียดอาชีพคู่สมรส</label>
                <input type="text" class="form-input" id="spouseOccupationDetail" placeholder="ตำแหน่งงาน/ลักษณะงาน">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownSpouseOccupationDetail">
                  <label class="checkbox-label" for="unknownSpouseOccupationDetail">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">จำนวนบุตร <span class="form-sublabel">(คน)</span></label>
                <input type="number" class="form-input" id="childrenCount" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownChildrenCount">
                  <label class="checkbox-label" for="unknownChildrenCount">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">อายุบุตร <span class="form-sublabel">(ปี - คั่นด้วยเครื่องหมายจุลภาค)</span></label>
                <input type="text" class="form-input" id="childrenAges" placeholder="เช่น 15, 18, 22">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownChildrenAges">
                  <label class="checkbox-label" for="unknownChildrenAges">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
              
              <div class="form-subsection">
                <div class="subsection-header">
                  <label class="form-label" style="margin: 0;">อาชีพบุตร</label>
                  <button type="button" class="btn btn-primary btn-sm" onclick="addChildOccupation()">+ เพิ่มบุตร</button>
                </div>
                <div id="childOccupationContainer">
                  <div class="child-occupation-item" data-index="0">
                    <div style="display: flex; gap: 1rem; align-items: start; margin-bottom: 1rem;">
                      <div style="flex: 1;">
                        <label class="form-label" style="font-size: 0.875rem;">บุตรคนที่ 1 - อาชีพ</label>
                        <select class="form-select child-occupation">
                          <option value="">เลือกอาชีพ</option>
                          <option value="student">นักเรียน/นักศึกษา</option>
                          <option value="government">ข้าราชการ</option>
                          <option value="business_owner">ธุรกิจส่วนตัว</option>
                          <option value="employee">พนักงานบริษัท</option>
                          <option value="freelance">อาชีพอิสระ</option>
                          <option value="trader">ค้าขาย</option>
                          <option value="unemployed">ว่างงาน</option>
                          <option value="other">อื่นๆ</option>
                        </select>
                      </div>
                      <div style="flex: 1;">
                        <label class="form-label" style="font-size: 0.875rem;">รายละเอียด</label>
                        <input type="text" class="form-input child-occupation-detail" placeholder="ตำแหน่งงาน/สาขาวิชา">
                      </div>
                    </div>
                    <div class="checkbox-group">
                      <input type="checkbox" class="checkbox-input" id="unknownChildOccupation0">
                      <label class="checkbox-label" for="unknownChildOccupation0">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="form-group">
                <label class="form-label">จำนวนหลาน <span class="form-sublabel">(คน)</span></label>
                <input type="number" class="form-input" id="grandchildrenCount" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownGrandchildrenCount">
                  <label class="checkbox-label" for="unknownGrandchildrenCount">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">บุคคลอื่นๆ ในครอบครัว</label>
                <input type="text" class="form-input" id="otherPeople" placeholder="เช่น พ่อแม่, พี่น้อง">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownOtherPeople">
                  <label class="checkbox-label" for="unknownOtherPeople">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">ผู้มีอำนาจตัดสินใจ</label>
                <input type="text" class="form-input" id="decisionMaker" placeholder="ใครเป็นคนตัดสินใจในครอบครัว">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownDecisionMaker">
                  <label class="checkbox-label" for="unknownDecisionMaker">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">รูปแบบกงสี <span class="form-sublabel">(มีการวางแผนแบ่งมรดกหรือไม่)</span></label>
                <div style="display: flex; gap: 1.5rem; margin-top: 0.75rem;">
                  <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    <input type="radio" name="inheritanceStyle" value="yes" style="width: 16px; height: 16px; accent-color: var(--primary-color);">
                    <span>ใช่</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    <input type="radio" name="inheritanceStyle" value="no" style="width: 16px; height: 16px; accent-color: var(--primary-color);">
                    <span>ไม่ใช่</span>
                  </label>
                </div>
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownInheritanceStyle">
                  <label class="checkbox-label" for="unknownInheritanceStyle">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
            </div>
          </div>

          <!-- Section 4: Business Information -->
          <div class="form-section">
            <div class="section-header">
              <span class="section-icon">🏢</span>
              <h3 class="section-title">ข้อมูลธุรกิจ</h3>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">ชื่อกิจการ</label>
                <input type="text" class="form-input" id="businessName" placeholder="ชื่อบริษัท/ร้านค้า">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownBusinessName">
                  <label class="checkbox-label" for="unknownBusinessName">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">ประเภทกิจการ</label>
                <input type="text" class="form-input" id="businessType" placeholder="ประเภทธุรกิจ">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownBusinessType">
                  <label class="checkbox-label" for="unknownBusinessType">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">ทุนจดทะเบียน <span class="form-sublabel">(บาท)</span></label>
                <input type="number" class="form-input" id="registeredCapital" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownRegisteredCapital">
                  <label class="checkbox-label" for="unknownRegisteredCapital">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">รายได้ธุรกิจ/ปี <span class="form-sublabel">(บาท)</span></label>
                <input type="number" class="form-input" id="businessIncome" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownBusinessIncome">
                  <label class="checkbox-label" for="unknownBusinessIncome">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">กำไรสุทธิ <span class="form-sublabel">(บาท)</span></label>
                <input type="number" class="form-input" id="netProfit" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownNetProfit">
                  <label class="checkbox-label" for="unknownNetProfit">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">ภาษี <span class="form-sublabel">(บาท/ปี)</span></label>
                <input type="number" class="form-input" id="tax" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownTax">
                  <label class="checkbox-label" for="unknownTax">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">สัดส่วนการถือหุ้น <span class="form-sublabel">(%)</span></label>
                <input type="number" class="form-input" id="shareholding" placeholder="0" max="100">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownShareholding">
                  <label class="checkbox-label" for="unknownShareholding">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">ส่วนของผู้ถือหุ้น <span class="form-sublabel">(บาท)</span></label>
                <input type="number" class="form-input" id="shareholderEquity" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownShareholderEquity">
                  <label class="checkbox-label" for="unknownShareholderEquity">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">ข้อมูลอื่นๆ</label>
                <input type="text" class="form-input" id="otherBusinessInfo" placeholder="ข้อมูลเพิ่มเติมเกี่ยวกับธุรกิจ">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownOtherBusinessInfo">
                  <label class="checkbox-label" for="unknownOtherBusinessInfo">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
                </div>
              </div>
            </div>
          </div>
          
          <button type="submit" class="btn btn-primary floating-save">
            <span class="loading" id="saveLoading" style="display: none;"></span>
            <span class="btn-icon">💾 บันทึกข้อมูลและวิเคราะห์</span>
          </button>
        </form>

        <!-- Analysis Result -->
        <div class="analysis-result" id="analysisResult" style="display: none;">
          <h3 class="analysis-title">📊 ผลการวิเคราะห์ลูกค้า</h3>
          <div class="analysis-grid">
            <div class="analysis-item">
              <div class="analysis-label">Risk Score</div>
              <div class="analysis-value" id="riskScore">-</div>
            </div>
            <div class="analysis-item">
              <div class="analysis-label">ระดับลูกค้า</div>
              <div class="analysis-value" id="customerLevel">-</div>
            </div>
            <div class="analysis-item">
              <div class="analysis-label">ผลิตภัณฑ์แนะนำ</div>
              <div class="analysis-value" id="productRecommendations">-</div>
            </div>
            <div class="analysis-item">
              <div class="analysis-label">วงเงินแนะนำ</div>
              <div class="analysis-value" id="suggestedAmount">-</div>
            </div>
          </div>
          <div style="text-align: center; margin-top: 2rem;">
            <button class="btn btn-secondary btn-icon" onclick="generatePDF()">📄 สร้าง PDF รายงาน</button>
          </div>
        </div>
      </div>

      <!-- Coach Content -->
      <div class="main-content" id="coachContent" style="display: none;">
        <div class="search-section">
          <div class="search-header">
            <span style="font-size: 1.5rem;">🔍</span>
            <h3 class="search-title">ค้นหาและกรองข้อมูลลูกค้า</h3>
          </div>
          <div class="search-controls">
            <input type="text" class="search-input" id="searchInput" placeholder="ใส่ Customer ID, ชื่อลูกค้า หรือชื่อพนักงาน...">
            <button class="btn btn-primary btn-icon" onclick="searchCustomer()">🔍 ค้นหา</button>
          </div>
          <div class="filter-buttons">
            <button class="filter-btn active" onclick="filterByDate('all')">📋 ทั้งหมด</button>
            <button class="filter-btn" onclick="filterByDate('today')">📅 วันนี้</button>
            <button class="filter-btn" onclick="filterByDate('week')">📊 สัปดาห์นี้</button>
            <button class="filter-btn" onclick="filterByDate('month')">📆 เดือนนี้</button>
          </div>
        </div>
        <div id="searchResults"></div>
      </div>

      <!-- Admin Content -->
      <div class="main-content" id="adminContent" style="display: none;">
        <div class="admin-controls">
          <div class="admin-header">
            <span style="font-size: 1.5rem;">⚙️</span>
            <h3 class="admin-title">การจัดการระบบและรายงาน</h3>
          </div>
          <div class="filter-section">
            <div class="filter-group">
              <label class="filter-label">ช่วงเวลา</label>
              <select class="form-select" id="adminDateFilter">
                <option value="all">ทั้งหมด</option>
                <option value="today">วันนี้</option>
                <option value="week">สัปดาห์นี้</option>
                <option value="month">เดือนนี้</option>
                <option value="custom">กำหนดเอง</option>
              </select>
            </div>
            <div class="filter-group">
              <label class="filter-label">กลุ่มความเสี่ยง</label>
              <select class="form-select" id="adminRiskFilter">
                <option value="all">ทั้งหมด</option>
                <option value="Critical Risk">Critical Risk</option>
                <option value="Strategic Risk">Strategic Risk</option>
                <option value="Wealth & Lifestyle">Wealth & Lifestyle</option>
              </select>
            </div>
            <div class="filter-group">
              <label class="filter-label">Zone</label>
              <select class="form-select" id="adminZoneFilter">
                <option value="all">ทั้งหมด</option>
                <option value="ratchaburi">Zone ราชบุรี</option>
                <option value="suratthani">Zone สุราษฎร์ธานี</option>
                <option value="hatyai">Zone หาดใหญ่</option>
                <option value="phuket">Zone ภูเก็ต</option>
                <option value="samutsakorn">Zone สมุทรสาคร</option>
              </select>
            </div>
          </div>
          <div class="btn-group">
            <button class="btn btn-primary btn-icon" onclick="applyAdminFilters()">📊 ดูข้อมูลตามเงื่อนไข</button>
            <button class="btn btn-outline btn-icon" onclick="exportToCSV()">📤 ส่งออก CSV</button>
            <button class="btn btn-danger btn-icon" onclick="clearAllData()">🗑️ ล้างข้อมูลทั้งหมด</button>
          </div>
        </div>
        <div id="adminResults"></div>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast" id="toast"></div>

  <script>
    // Global variables
    let currentRole = '';
    let selectedCustomerTypes = [];
    let allCustomers = [];
    let currentRecordCount = 0;
    let realEstateCount = 1;
    let vehicleCount = 1;
    let insuranceCount = 1;
    let childOccupationCount = 1;
    let currentFilter = 'all';

    // Default configuration
    const defaultConfig = {
      system_title: "Customer Coaching Support System",
      company_name: "TTB Bank"
    };

    // Welcome Screen Functionality
    document.addEventListener('DOMContentLoaded', function() {
      // Show welcome screen initially
      document.getElementById('welcomeScreen').style.display = 'flex';
      document.getElementById('mainApp').style.display = 'none';
      
      // Add event listener for enter button
      document.getElementById('enterButton').addEventListener('click', function() {
        enterSystem();
      });
    });

    function enterSystem() {
      const welcomeScreen = document.getElementById('welcomeScreen');
      const mainApp = document.getElementById('mainApp');
      
      // Add fade-out class to welcome screen
      welcomeScreen.classList.add('fade-out');
      
      // After animation completes, hide welcome and show main app
      setTimeout(() => {
        welcomeScreen.style.display = 'none';
        mainApp.style.display = 'block';
        
        // Add show class to main app with a slight delay
        setTimeout(() => {
          mainApp.classList.add('show');
          
          // Initialize the system
          initializeSystem();
        }, 100);
      }, 1000);
    }

    function initializeSystem() {
      initializeSDKs();
      setupEventListeners();
      generateCustomerId();
      updateProgress();
      
      // Load existing data
      loadExistingData();
    }

    // Data handler for SDK
    const dataHandler = {
      onDataChanged(data) {
        allCustomers = data;
        currentRecordCount = data.length;
        updateUI();
      }
    };

    // Initialize SDKs
    async function initializeSDKs() {
      try {
        if (window.dataSdk) {
          const result = await window.dataSdk.init(dataHandler);
          if (!result.isOk) {
            console.error("Failed to initialize data SDK");
          }
        }

        if (window.elementSdk) {
          await window.elementSdk.init({
            defaultConfig,
            render: async (config) => {
              document.getElementById('system-title').textContent = 
                config.system_title || defaultConfig.system_title;
              document.getElementById('company-name').textContent = 
                (config.company_name || defaultConfig.company_name) + " - ระบบสนับสนุนการให้คำปรึกษาลูกค้า";
            },
            mapToCapabilities: (config) => ({
              recolorables: [],
              borderables: [],
              fontEditable: undefined,
              fontSizeable: undefined
            }),
            mapToEditPanelValues: (config) => new Map([
              ["system_title", config.system_title || defaultConfig.system_title],
              ["company_name", config.company_name || defaultConfig.company_name]
            ])
          });
        }
      } catch (error) {
        console.error("SDK initialization error:", error);
      }
    }

    function loadExistingData() {
      // Try to load from localStorage if SDK not available
      if (!window.dataSdk) {
        const storedData = localStorage.getItem('customerData');
        if (storedData) {
          allCustomers = JSON.parse(storedData);
          currentRecordCount = allCustomers.length;
          updateUI();
        }
      }
    }

    function updateUI() {
      if (currentRole === 'coach') {
        displaySearchResults(allCustomers);
      } else if (currentRole === 'admin') {
        displayAdminResults(allCustomers);
      }
    }

    function setupEventListeners() {
      // Role selection
      document.querySelectorAll('.role-card').forEach(card => {
        card.addEventListener('click', function() {
          selectRole(this.dataset.role);
        });
      });

      // Customer type selection
      document.querySelectorAll('.customer-type-card').forEach(card => {
        card.addEventListener('click', function() {
          const type = this.dataset.type;
          if (this.classList.contains('selected')) {
            this.classList.remove('selected');
            selectedCustomerTypes = selectedCustomerTypes.filter(t => t !== type);
          } else {
            // Only allow one selection
            document.querySelectorAll('.customer-type-card').forEach(c => {
              c.classList.remove('selected');
            });
            this.classList.add('selected');
            selectedCustomerTypes = [type];
          }
        });
      });

      // Form submission
      document.getElementById('customerForm').addEventListener('submit', function(e) {
        e.preventDefault();
        saveCustomerData();
      });

      // Input change listeners for progress tracking
      document.querySelectorAll('input, select').forEach(input => {
        input.addEventListener('change', updateProgress);
        input.addEventListener('input', updateProgress);
      });

      // Setup checkbox handlers
      setupCheckboxHandlers();
    }

    function setupCheckboxHandlers() {
      // Set up all checkbox handlers for unknown data
      document.querySelectorAll('.checkbox-input').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          const targetId = this.id.replace('unknown', '').replace(/\d+$/, '');
          const targetElement = document.getElementById(targetId);
          if (targetElement) {
            targetElement.disabled = this.checked;
            if (this.checked) {
              targetElement.value = '';
            }
          }
        });
      });
    }

    function selectRole(role) {
      currentRole = role;
      
      // Update UI
      document.querySelectorAll('.role-card').forEach(card => {
        card.classList.remove('active');
      });
      document.querySelector(`[data-role="${role}"]`).classList.add('active');
      
      // Show relevant content
      document.querySelectorAll('.main-content').forEach(content => {
        content.style.display = 'none';
      });
      
      const targetContent = document.getElementById(`${role}Content`);
      if (targetContent) {
        targetContent.style.display = 'block';
        setTimeout(() => {
          targetContent.classList.add('show');
        }, 10);
      }
      
      showToast(`เปลี่ยนเป็นโหมด: ${getRoleDisplayName(role)}`);
    }

    function getRoleDisplayName(role) {
      const roles = {
        'employee': 'พนักงานขาย',
        'coach': 'ผู้ให้คำปรึกษา', 
        'admin': 'ผู้ดูแลระบบ'
      };
      return roles[role] || role;
    }

    function generateCustomerId() {
      const timestamp = new Date().getTime().toString().slice(-6);
      const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
      const customerId = `CUST${timestamp}${random}`;
      document.getElementById('customerId').value = customerId;
      return customerId;
    }

    function updateProgress() {
      const sections = document.querySelectorAll('.form-section');
      const filledSections = Array.from(sections).filter(section => {
        const inputs = section.querySelectorAll('input, select, textarea');
        return Array.from(inputs).some(input => {
          if (input.type === 'checkbox' || input.type === 'radio') {
            return input.checked;
          }
          return input.value && input.value.trim() !== '';
        });
      }).length;
      
      const progress = (filledSections / sections.length) * 100;
      document.getElementById('progressFill').style.width = `${progress}%`;
      
      // Update step indicators
      const steps = document.querySelectorAll('.step');
      steps.forEach((step, index) => {
        if (index < filledSections) {
          step.classList.add('active');
        } else {
          step.classList.remove('active');
        }
      });
    }

    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast';
      
      // Set color based on type
      if (type === 'error') {
        toast.style.background = 'var(--danger-color)';
      } else if (type === 'warning') {
        toast.style.background = 'var(--warning-color)';
      } else {
        toast.style.background = 'var(--success-color)';
      }
      
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // Dynamic form element functions
    function addRealEstate() {
      const container = document.getElementById('realEstateContainer');
      const newItem = createRealEstateItem(realEstateCount);
      container.appendChild(newItem);
      realEstateCount++;
      setupCheckboxHandlers();
    }

    function createRealEstateItem(index) {
      const newItem = document.createElement('div');
      newItem.className = 'real-estate-item';
      newItem.dataset.index = index;
      newItem.innerHTML = `
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">ประเภท</label>
            <input type="text" class="form-input real-estate-type" placeholder="เช่น บ้าน, คอนโด, ที่ดิน">
            <div class="checkbox-group">
              <input type="checkbox" class="checkbox-input" id="unknownRealEstateType${index}">
              <label class="checkbox-label" for="unknownRealEstateType${index}">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">มูลค่า <span class="form-sublabel">(บาท)</span></label>
            <input type="number" class="form-input real-estate-value" placeholder="0">
            <div class="checkbox-group">
              <input type="checkbox" class="checkbox-input" id="unknownRealEstateValue${index}">
              <label class="checkbox-label" for="unknownRealEstateValue${index}">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
            </div>
          </div>
        </div>
      `;
      return newItem;
    }

    function addVehicle() {
      const container = document.getElementById('vehicleContainer');
      const newItem = createVehicleItem(vehicleCount);
      container.appendChild(newItem);
      vehicleCount++;
      setupCheckboxHandlers();
    }

    function createVehicleItem(index) {
      const newItem = document.createElement('div');
      newItem.className = 'vehicle-item';
      newItem.dataset.index = index;
      newItem.innerHTML = `
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">ประเภท</label>
            <input type="text" class="form-input vehicle-type" placeholder="เช่น รถยนต์, รถจักรยานยนต์">
            <div class="checkbox-group">
              <input type="checkbox" class="checkbox-input" id="unknownVehicleType${index}">
              <label class="checkbox-label" for="unknownVehicleType${index}">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">มูลค่า <span class="form-sublabel">(บาท)</span></label>
            <input type="number" class="form-input vehicle-value" placeholder="0">
            <div class="checkbox-group">
              <input type="checkbox" class="checkbox-input" id="unknownVehicleValue${index}">
              <label class="checkbox-label" for="unknownVehicleValue${index}">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
            </div>
          </div>
        </div>
      `;
      return newItem;
    }

    function addInsurance() {
      const container = document.getElementById('insuranceContainer');
      const newItem = createInsuranceItem(insuranceCount);
      container.appendChild(newItem);
      insuranceCount++;
      setupCheckboxHandlers();
    }

    function createInsuranceItem(index) {
      const newItem = document.createElement('div');
      newItem.className = 'insurance-item';
      newItem.dataset.index = index;
      newItem.innerHTML = `
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">ประเภทความคุ้มครอง</label>
            <select class="form-select insurance-type">
              <option value="">เลือกประเภท</option>
              <option value="life">ประกันชีวิต</option>
              <option value="health">ประกันสุขภาพ</option>
              <option value="critical_illness">ประกันโรคร้ายแรง</option>
              <option value="accident">ประกันอุบัติเหตุ</option>
              <option value="disability">ประกันทุพพลภาพ</option>
              <option value="other">อื่นๆ</option>
            </select>
            <div class="checkbox-group">
              <input type="checkbox" class="checkbox-input" id="unknownInsuranceType${index}">
              <label class="checkbox-label" for="unknownInsuranceType${index}">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">ทุนประกัน <span class="form-sublabel">(บาท)</span></label>
            <input type="number" class="form-input insurance-amount" placeholder="0">
            <div class="checkbox-group">
              <input type="checkbox" class="checkbox-input" id="unknownInsuranceAmount${index}">
              <label class="checkbox-label" for="unknownInsuranceAmount${index}">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">เบี้ยประกัน/ปี <span class="form-sublabel">(บาท)</span></label>
            <input type="number" class="form-input insurance-premium" placeholder="0">
            <div class="checkbox-group">
              <input type="checkbox" class="checkbox-input" id="unknownInsurancePremium${index}">
              <label class="checkbox-label" for="unknownInsurancePremium${index}">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
            </div>
          </div>
        </div>
      `;
      return newItem;
    }

    function addChildOccupation() {
      const container = document.getElementById('childOccupationContainer');
      const newItem = createChildOccupationItem(childOccupationCount);
      container.appendChild(newItem);
      childOccupationCount++;
      setupCheckboxHandlers();
    }

    function createChildOccupationItem(index) {
      const newItem = document.createElement('div');
      newItem.className = 'child-occupation-item';
      newItem.dataset.index = index;
      newItem.innerHTML = `
        <div style="display: flex; gap: 1rem; align-items: start; margin-bottom: 1rem;">
          <div style="flex: 1;">
            <label class="form-label" style="font-size: 0.875rem;">บุตรคนที่ ${index + 1} - อาชีพ</label>
            <select class="form-select child-occupation">
              <option value="">เลือกอาชีพ</option>
              <option value="student">นักเรียน/นักศึกษา</option>
              <option value="government">ข้าราชการ</option>
              <option value="business_owner">ธุรกิจส่วนตัว</option>
              <option value="employee">พนักงานบริษัท</option>
              <option value="freelance">อาชีพอิสระ</option>
              <option value="trader">ค้าขาย</option>
              <option value="unemployed">ว่างงาน</option>
              <option value="other">อื่นๆ</option>
            </select>
          </div>
          <div style="flex: 1;">
            <label class="form-label" style="font-size: 0.875rem;">รายละเอียด</label>
            <input type="text" class="form-input child-occupation-detail" placeholder="ตำแหน่งงาน/สาขาวิชา">
          </div>
        </div>
        <div class="checkbox-group">
          <input type="checkbox" class="checkbox-input" id="unknownChildOccupation${index}">
          <label class="checkbox-label" for="unknownChildOccupation${index}">ไม่ทราบข้อมูล/ไม่มีข้อมูล</label>
        </div>
      `;
      return newItem;
    }

    // Form data collection and analysis
    function collectFormData() {
      const formData = {
        customer_id: document.getElementById('customerId').value,
        employee_name: document.getElementById('employeeName').value,
        employee_zone: document.getElementById('employeeZone').value,
        customer_name: document.getElementById('customerName').value,
        customer_type: getCustomerTypeDisplayName(selectedCustomerTypes[0]),
        occupation: document.getElementById('occupation').value,
        occupation_detail: document.getElementById('occupationDetail').value,
        net_income: parseInt(document.getElementById('netIncome').value) || 0,
        savings: parseInt(document.getElementById('savings').value) || 0,
        bonds: parseInt(document.getElementById('bonds').value) || 0,
        funds: parseInt(document.getElementById('funds').value) || 0,
        credit_cards: parseInt(document.getElementById('creditCards').value) || 0,
        loans: parseInt(document.getElementById('loans').value) || 0,
        aum_ttb: parseInt(document.getElementById('aumTtb').value) || 0,
        aum_others: parseInt(document.getElementById('aumOthers').value) || 0,
        spouse_age: parseInt(document.getElementById('spouseAge').value) || 0,
        spouse_occupation: document.getElementById('spouseOccupation').value,
        spouse_occupation_detail: document.getElementById('spouseOccupationDetail').value,
        children_count: parseInt(document.getElementById('childrenCount').value) || 0,
        children_ages: document.getElementById('childrenAges').value,
        grandchildren_count: parseInt(document.getElementById('grandchildrenCount').value) || 0,
        other_people: document.getElementById('otherPeople').value,
        decision_maker: document.getElementById('decisionMaker').value,
        inheritance_style: document.querySelector('input[name="inheritanceStyle"]:checked')?.value || '',
        business_name: document.getElementById('businessName').value,
        business_type: document.getElementById('businessType').value,
        registered_capital: parseInt(document.getElementById('registeredCapital').value) || 0,
        business_income: parseInt(document.getElementById('businessIncome').value) || 0,
        net_profit: parseInt(document.getElementById('netProfit').value) || 0,
        tax: parseInt(document.getElementById('tax').value) || 0,
        shareholding: parseInt(document.getElementById('shareholding').value) || 0,
        shareholder_equity: parseInt(document.getElementById('shareholderEquity').value) || 0,
        other_business_info: document.getElementById('otherBusinessInfo').value,
        analysis_date: new Date().toISOString()
      };

      // Collect dynamic data
      formData.real_estate_summary = collectRealEstateData();
      formData.vehicle_summary = collectVehicleData();
      formData.insurance_summary = collectInsuranceData();
      formData.children_occupation_summary = collectChildOccupationData();

      return formData;
    }

    function getCustomerTypeDisplayName(type) {
      const types = {
        'goal_oriented': 'เป้าประสงค์',
        'celebrity': 'หนึ่งดารา',
        'analytical': 'คิดคำนวณ',
        'conservative': 'ถนอมจิตร'
      };
      return types[type] || type;
    }

    function collectRealEstateData() {
      const items = [];
      document.querySelectorAll('.real-estate-item').forEach(item => {
        const type = item.querySelector('.real-estate-type').value;
        const value = parseInt(item.querySelector('.real-estate-value').value) || 0;
        if (type || value > 0) {
          items.push({ type, value });
        }
      });
      return JSON.stringify(items);
    }

    function collectVehicleData() {
      const items = [];
      document.querySelectorAll('.vehicle-item').forEach(item => {
        const type = item.querySelector('.vehicle-type').value;
        const value = parseInt(item.querySelector('.vehicle-value').value) || 0;
        if (type || value > 0) {
          items.push({ type, value });
        }
      });
      return JSON.stringify(items);
    }

    function collectInsuranceData() {
      const items = [];
      document.querySelectorAll('.insurance-item').forEach(item => {
        const type = item.querySelector('.insurance-type').value;
        const amount = parseInt(item.querySelector('.insurance-amount').value) || 0;
        const premium = parseInt(item.querySelector('.insurance-premium').value) || 0;
        if (type || amount > 0 || premium > 0) {
          items.push({ type, amount, premium });
        }
      });
      return JSON.stringify(items);
    }

    function collectChildOccupationData() {
      const items = [];
      document.querySelectorAll('.child-occupation-item').forEach((item, index) => {
        const occupation = item.querySelector('.child-occupation').value;
        const detail = item.querySelector('.child-occupation-detail').value;
        if (occupation || detail) {
          items.push({ 
            child_number: index + 1,
            occupation, 
            detail 
          });
        }
      });
      return JSON.stringify(items);
    }

    async function saveCustomerData() {
      const saveButton = document.querySelector('.floating-save');
      const loading = document.getElementById('saveLoading');
      
      saveButton.disabled = true;
      loading.style.display = 'inline-block';
      
      try {
        const formData = collectFormData();
        
        // Perform analysis
        const analysis = analyzeCustomerData(formData);
        formData.risk_score = analysis.riskScore;
        formData.customer_level = analysis.customerLevel;
        formData.product_recommendations = analysis.productRecommendations;
        formData.suggested_amount = analysis.suggestedAmount;
        
        // Save to SDK
        if (window.dataSdk) {
          const result = await window.dataSdk.save(formData);
          if (result.isOk) {
            showToast('บันทึกข้อมูลและวิเคราะห์สำเร็จ! 📊');
            displayAnalysisResult(analysis);
            
            // Add to local array
            allCustomers.push({ ...formData, __backendId: result.data.id });
            currentRecordCount++;
          } else {
            throw new Error('Failed to save data');
          }
        } else {
          // Fallback: Save to localStorage
          const customers = JSON.parse(localStorage.getItem('customerData') || '[]');
          customers.push({ ...formData, id: Date.now().toString() });
          localStorage.setItem('customerData', JSON.stringify(customers));
          
          showToast('บันทึกข้อมูลและวิเคราะห์สำเร็จ! (เก็บข้อมูลชั่วคราว)');
          displayAnalysisResult(analysis);
          
          allCustomers = customers;
          currentRecordCount = customers.length;
        }
        
      } catch (error) {
        console.error('Save error:', error);
        showToast('เกิดข้อผิดพลาดในการบันทึกข้อมูล', 'error');
      } finally {
        saveButton.disabled = false;
        loading.style.display = 'none';
      }
    }

    function analyzeCustomerData(data) {
      // Simplified analysis logic
      let riskScore = 50; // Base score
      
      // Adjust based on income
      if (data.net_income > 1000000) riskScore += 20;
      else if (data.net_income > 500000) riskScore += 10;
      
      // Adjust based on assets
      const totalAssets = data.savings + data.bonds + data.funds + data.aum_ttb + data.aum_others;
      if (totalAssets > 5000000) riskScore += 15;
      else if (totalAssets > 1000000) riskScore += 5;
      
      // Adjust based on liabilities
      const totalLiabilities = data.loans + (data.credit_cards * 0.1);
      if (totalLiabilities > data.net_income * 2) riskScore -= 20;
      else if (totalLiabilities > data.net_income) riskScore -= 10;
      
      // Ensure score is within bounds
      riskScore = Math.max(0, Math.min(100, riskScore));
      
      // Determine customer level
      let customerLevel, productRecommendations, suggestedAmount;
      
      if (riskScore >= 70) {
        customerLevel = 'Critical Risk';
        productRecommendations = 'ประกันชีวิตแบบสะสมทรัพย์, กองทุนรวมผสม, สินเชื่อเพื่อการลงทุน';
        suggestedAmount = '1,000,000 - 5,000,000 บาท';
      } else if (riskScore >= 40) {
        customerLevel = 'Strategic Risk';
        productRecommendations = 'ประกันสุขภาพ, กองทุนตราสารหนี้, บัตรเครดิต';
        suggestedAmount = '500,000 - 1,000,000 บาท';
      } else {
        customerLevel = 'Wealth & Lifestyle';
        productRecommendations = 'บัญชีออมทรัพย์, กองทุนสำรองเลี้ยงชีพ, ประกันอุบัติเหตุ';
        suggestedAmount = '100,000 - 500,000 บาท';
      }
      
      return {
        riskScore,
        customerLevel,
        productRecommendations,
        suggestedAmount
      };
    }

    function displayAnalysisResult(analysis) {
      document.getElementById('riskScore').textContent = `${analysis.riskScore}/100`;
      document.getElementById('customerLevel').textContent = analysis.customerLevel;
      document.getElementById('productRecommendations').textContent = analysis.productRecommendations;
      document.getElementById('suggestedAmount').textContent = analysis.suggestedAmount;
      
      const resultSection = document.getElementById('analysisResult');
      resultSection.style.display = 'block';
      resultSection.scrollIntoView({ behavior: 'smooth' });
    }

    function generatePDF() {
      // Simple PDF generation using jsPDF
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      doc.setFontSize(20);
      doc.text('รายงานการวิเคราะห์ลูกค้า', 20, 20);
      
      doc.setFontSize(12);
      doc.text(`Customer ID: ${document.getElementById('customerId').value}`, 20, 40);
      doc.text(`ชื่อลูกค้า: ${document.getElementById('customerName').value}`, 20, 50);
      doc.text(`Risk Score: ${document.getElementById('riskScore').textContent}`, 20, 60);
      doc.text(`ระดับลูกค้า: ${document.getElementById('customerLevel').textContent}`, 20, 70);
      doc.text(`ผลิตภัณฑ์แนะนำ: ${document.getElementById('productRecommendations').textContent}`, 20, 80);
      doc.text(`วงเงินแนะนำ: ${document.getElementById('suggestedAmount').textContent}`, 20, 90);
      
      doc.save(`customer-report-${document.getElementById('customerId').value}.pdf`);
      showToast('สร้าง PDF รายงานสำเร็จ!');
    }

    // Employee Search Functions
    function searchExistingCustomer() {
      const searchTerm = document.getElementById('employeeSearchInput').value.trim();
      
      if (!searchTerm) {
        showToast('กรุณาใส่ Customer ID', 'warning');
        return;
      }

      const customer = allCustomers.find(c => 
        c.customer_id && c.customer_id.toLowerCase() === searchTerm.toLowerCase()
      );

      if (!customer) {
        showToast('ไม่พบข้อมูลลูกค้า ID: ' + searchTerm, 'warning');
        document.getElementById('searchResultContainer').style.display = 'none';
        return;
      }

      displaySearchResult(customer);
    }

    function displaySearchResult(customer) {
      const container = document.getElementById('searchResultContainer');
      
      const levelClass = customer.customer_level === 'Critical Risk' ? 'level-critical' :
                       customer.customer_level === 'Strategic Risk' ? 'level-strategic' : 'level-wealth';

      container.innerHTML = `
        <div class="customer-card" style="border-left: 4px solid var(--success-color);">
          <div class="customer-header">
            <div>
              <div class="customer-name">✅ พบข้อมูล: ${customer.customer_name || 'ไม่ระบุชื่อ'}</div>
              <div class="customer-meta">
                ID: ${customer.customer_id || 'N/A'} | 
                พนักงาน: ${customer.employee_name || 'ไม่ระบุ'} | 
                Zone: ${getZoneDisplayName(customer.employee_zone)} |
                วันที่บันทึก: ${customer.analysis_date ? new Date(customer.analysis_date).toLocaleDateString('th-TH') : 'ไม่ระบุ'}
              </div>
            </div>
            <div class="customer-level ${levelClass}">
              ${customer.customer_level || 'ไม่ระบุ'}
            </div>
          </div>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
            <div>
              <strong>Risk Score:</strong> ${customer.risk_score || 0}/100
            </div>
            <div>
              <strong>ลักษณะลูกค้า:</strong> ${customer.customer_type || 'ไม่ระบุ'}
            </div>
            <div>
              <strong>อาชีพ:</strong> ${customer.occupation || 'ไม่ระบุ'}
            </div>
            <div>
              <strong>รายได้/ปี:</strong> ${customer.net_income ? new Intl.NumberFormat('th-TH').format(customer.net_income) + ' บาท' : 'ไม่ระบุ'}
            </div>
          </div>
          
          <div style="background: var(--background-color); padding: 1rem; border-radius: var(--radius-md); margin-bottom: 1rem;">
            <strong>ผลิตภัณฑ์แนะนำ:</strong> ${customer.product_recommendations || 'ไม่มีข้อมูล'}
          </div>

          <!-- Coach Comments Section -->
          <div id="coachCommentsSection" style="background: rgba(52, 199, 89, 0.1); padding: 1rem; border-radius: var(--radius-md); margin-bottom: 1rem; border: 1px solid rgba(52, 199, 89, 0.2);">
            <h5 style="color: var(--accent-color); margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;">
              💬 ความเห็นจาก Coach
            </h5>
            <div id="customerComments">
              <div style="text-align: center; padding: 1rem; color: var(--text-muted); font-style: italic;">
                ยังไม่มีความเห็นจาก Coach สำหรับลูกค้ารายนี้
              </div>
            </div>
          </div>
          
          <div style="display: flex; gap: 0.5rem; justify-content: flex-end; flex-wrap: wrap;">
            <button class="btn btn-sm btn-outline glass-btn" onclick="viewFullCustomerDetail('${customer.id || customer.__backendId}')">
              👁️ ดูรายละเอียดเต็ม
            </button>
            <button class="btn btn-sm btn-secondary glass-btn" onclick="loadCustomerForEdit('${customer.id || customer.__backendId}')">
              ✏️ แก้ไขข้อมูล
            </button>
            <button class="btn btn-sm btn-primary glass-btn" onclick="generateCustomerPDF('${customer.id || customer.__backendId}')">
              📄 สร้าง PDF
            </button>
          </div>
        </div>
      `;
      
      container.style.display = 'block';
      
      // Load coach comments (demo data for now)
      loadCoachComments(customer.customer_id);
    }

    function loadCoachComments(customerId) {
      // Demo coach comments - in real system, this would fetch from database
      const demoComments = [
        {
          id: 1,
          type: 'recommendation',
          content: 'แนะนำให้ลูกค้าเพิ่มความคุ้มครองประกันสุขภาพ เนื่องจากเป็นเจ้าของธุรกิจที่ไม่มีสวัสดิการ',
          author: 'Coach สมชาย',
          date: '2024-01-15T10:30:00Z'
        },
        {
          id: 2,
          type: 'follow_up',
          content: 'ติดตามผลการพิจารณาแผนประกันชีวิต ลูกค้าสนใจแต่ต้องการเวลาปรึกษาครอบครัว',
          author: 'Coach สมหญิง',
          date: '2024-01-20T14:15:00Z'
        }
      ];

      const commentsContainer = document.getElementById('customerComments');
      
      if (demoComments.length > 0) {
        const commentsHtml = demoComments.map(comment => `
          <div style="background: var(--surface-color); border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: 1rem; margin-bottom: 0.5rem; border-left: 3px solid var(--accent-color);">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
              <div>
                <span class="comment-type-badge ${comment.type}">${getCommentTypeIcon(comment.type)} ${getCommentTypeLabel(comment.type)}</span>
              </div>
              <div style="font-size: 0.75rem; color: var(--text-muted);">
                ${comment.author} • ${new Date(comment.date).toLocaleDateString('th-TH')}
              </div>
            </div>
            <div style="line-height: 1.5; color: var(--text-primary); font-size: 0.875rem;">
              ${comment.content}
            </div>
          </div>
        `).join('');
        
        commentsContainer.innerHTML = commentsHtml;
      }
    }

    function clearSearch() {
      document.getElementById('employeeSearchInput').value = '';
      document.getElementById('searchResultContainer').style.display = 'none';
    }

    function viewFullCustomerDetail(customerId) {
      const customer = allCustomers.find(c => 
        c.id === customerId || c.__backendId === customerId
      );
      if (!customer) {
        showToast('ไม่พบข้อมูลลูกค้า', 'error');
        return;
      }
      showCustomerDetailModal(customer);
    }

    function loadCustomerForEdit(customerId) {
      const customer = allCustomers.find(c => 
        c.id === customerId || c.__backendId === customerId
      );
      if (!customer) {
        showToast('ไม่พบข้อมูลลูกค้า', 'error');
        return;
      }

      // Show confirmation modal
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      
      modal.innerHTML = `
        <div class="modal-content">
          <h3 class="modal-title">✏️ แก้ไขข้อมูลลูกค้า</h3>
          <div class="modal-message">
            <p style="margin: 0; font-size: 1rem; color: var(--text-primary);">
              คุณต้องการโหลดข้อมูลของ <strong>${customer.customer_name || customer.customer_id}</strong> เพื่อแก้ไขหรือไม่?
            </p>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.875rem; color: var(--text-muted);">
              ข้อมูลจะถูกโหลดลงในฟอร์มด้านล่าง และคุณสามารถแก้ไขแล้วบันทึกใหม่ได้
            </p>
          </div>
          <div class="modal-buttons">
            <button class="btn btn-secondary glass-btn" onclick="this.closest('.modal-overlay').remove()">ยกเลิก</button>
            <button class="btn btn-primary glass-btn" onclick="confirmLoadCustomer('${customerId}', this)">โหลดข้อมูล</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    function confirmLoadCustomer(customerId, button) {
      const customer = allCustomers.find(c => 
        c.id === customerId || c.__backendId === customerId
      );
      if (!customer) return;

      // Clear search results
      clearSearch();

      // Populate form with customer data
      populateFormWithCustomerData(customer);
      
      // Close modal
      button.closest('.modal-overlay').remove();
      
      // Scroll to form
      document.getElementById('customerForm').scrollIntoView({ behavior: 'smooth' });
      
      showToast('โหลดข้อมูลลูกค้าสำเร็จ! สามารถแก้ไขและบันทึกใหม่ได้ ✏️');
    }

    function populateFormWithCustomerData(customer) {
      // Basic Information
      document.getElementById('customerId').value = customer.customer_id || '';
      document.getElementById('employeeName').value = customer.employee_name || '';
      document.getElementById('employeeZone').value = customer.employee_zone || '';
      document.getElementById('customerName').value = customer.customer_name || '';

      // Customer Type
      if (customer.customer_type) {
        const customerTypes = {
          'เป้าประสงค์': 'goal_oriented',
          'หนึ่งดารา': 'celebrity', 
          'คิดคำนวณ': 'analytical',
          'ถนอมจิตร': 'conservative'
        };
        
        // Clear previous selections
        document.querySelectorAll('.customer-type-card').forEach(card => {
          card.classList.remove('selected');
        });
        selectedCustomerTypes = [];

        // Find and select the matching type
        Object.entries(customerTypes).forEach(([thai, english]) => {
          if (customer.customer_type.includes(thai)) {
            const card = document.querySelector(`[data-type="${english}"]`);
            if (card) {
              card.classList.add('selected');
              selectedCustomerTypes.push(english);
            }
          }
        });
      }

      // Personal Information
      document.getElementById('occupation').value = customer.occupation || '';
      document.getElementById('occupationDetail').value = customer.occupation_detail || '';
      document.getElementById('netIncome').value = customer.net_income || '';
      document.getElementById('savings').value = customer.savings || '';
      document.getElementById('bonds').value = customer.bonds || '';
      document.getElementById('funds').value = customer.funds || '';
      document.getElementById('creditCards').value = customer.credit_cards || '';
      document.getElementById('loans').value = customer.loans || '';
      document.getElementById('aumTtb').value = customer.aum_ttb || '';
      document.getElementById('aumOthers').value = customer.aum_others || '';

      // Family Information
      document.getElementById('spouseAge').value = customer.spouse_age || '';
      document.getElementById('spouseOccupation').value = customer.spouse_occupation || '';
      document.getElementById('spouseOccupationDetail').value = customer.spouse_occupation_detail || '';
      document.getElementById('childrenCount').value = customer.children_count || '';
      document.getElementById('childrenAges').value = customer.children_ages || '';
      document.getElementById('grandchildrenCount').value = customer.grandchildren_count || '';
      document.getElementById('otherPeople').value = customer.other_people || '';
      document.getElementById('decisionMaker').value = customer.decision_maker || '';

      // Inheritance style radio buttons
      if (customer.inheritance_style) {
        const radio = document.querySelector(`input[name="inheritanceStyle"][value="${customer.inheritance_style}"]`);
        if (radio) radio.checked = true;
      }

      // Business Information
      document.getElementById('businessName').value = customer.business_name || '';
      document.getElementById('businessType').value = customer.business_type || '';
      document.getElementById('registeredCapital').value = customer.registered_capital || '';
      document.getElementById('businessIncome').value = customer.business_income || '';
      document.getElementById('netProfit').value = customer.net_profit || '';
      document.getElementById('tax').value = customer.tax || '';
      document.getElementById('shareholding').value = customer.shareholding || '';
      document.getElementById('shareholderEquity').value = customer.shareholder_equity || '';
      document.getElementById('otherBusinessInfo').value = customer.other_business_info || '';

      // Complex data - Real Estate
      if (customer.real_estate_summary) {
        try {
          const realEstateData = JSON.parse(customer.real_estate_summary);
          populateRealEstateData(realEstateData);
        } catch (e) {
          console.error('Error parsing real estate data:', e);
        }
      }

      // Complex data - Vehicles
      if (customer.vehicle_summary) {
        try {
          const vehicleData = JSON.parse(customer.vehicle_summary);
          populateVehicleData(vehicleData);
        } catch (e) {
          console.error('Error parsing vehicle data:', e);
        }
      }

      // Complex data - Insurance
      if (customer.insurance_summary) {
        try {
          const insuranceData = JSON.parse(customer.insurance_summary);
          populateInsuranceData(insuranceData);
        } catch (e) {
          console.error('Error parsing insurance data:', e);
        }
      }

      // Complex data - Children Occupation
      if (customer.children_occupation_summary) {
        try {
          const childOccupationData = JSON.parse(customer.children_occupation_summary);
          populateChildOccupationData(childOccupationData);
        } catch (e) {
          console.error('Error parsing child occupation data:', e);
        }
      }

      // Update progress
      updateProgress();
    }

    function populateRealEstateData(data) {
      const container = document.getElementById('realEstateContainer');
      container.innerHTML = ''; // Clear existing
      
      data.forEach((item, index) => {
        if (index === 0) {
          // Create first item
          const firstItem = createRealEstateItem(0);
          container.appendChild(firstItem);
          const typeInput = firstItem.querySelector('.real-estate-type');
          const valueInput = firstItem.querySelector('.real-estate-value');
          if (typeInput) typeInput.value = item.type || '';
          if (valueInput) valueInput.value = item.value || '';
        } else {
          // Add new items
          addRealEstate();
          const newItem = container.lastElementChild;
          const typeInput = newItem.querySelector('.real-estate-type');
          const valueInput = newItem.querySelector('.real-estate-value');
          if (typeInput) typeInput.value = item.type || '';
          if (valueInput) valueInput.value = item.value || '';
        }
      });
    }

    function populateVehicleData(data) {
      const container = document.getElementById('vehicleContainer');
      container.innerHTML = ''; // Clear existing
      
      data.forEach((item, index) => {
        if (index === 0) {
          // Create first item
          const firstItem = createVehicleItem(0);
          container.appendChild(firstItem);
          const typeInput = firstItem.querySelector('.vehicle-type');
          const valueInput = firstItem.querySelector('.vehicle-value');
          if (typeInput) typeInput.value = item.type || '';
          if (valueInput) valueInput.value = item.value || '';
        } else {
          // Add new items
          addVehicle();
          const newItem = container.lastElementChild;
          const typeInput = newItem.querySelector('.vehicle-type');
          const valueInput = newItem.querySelector('.vehicle-value');
          if (typeInput) typeInput.value = item.type || '';
          if (valueInput) valueInput.value = item.value || '';
        }
      });
    }

    function populateInsuranceData(data) {
      const container = document.getElementById('insuranceContainer');
      container.innerHTML = ''; // Clear existing
      
      data.forEach((item, index) => {
        if (index === 0) {
          // Create first item
          const firstItem = createInsuranceItem(0);
          container.appendChild(firstItem);
          const typeSelect = firstItem.querySelector('.insurance-type');
          const amountInput = firstItem.querySelector('.insurance-amount');
          const premiumInput = firstItem.querySelector('.insurance-premium');
          if (typeSelect) typeSelect.value = item.type || '';
          if (amountInput) amountInput.value = item.amount || '';
          if (premiumInput) premiumInput.value = item.premium || '';
        } else {
          // Add new items
          addInsurance();
          const newItem = container.lastElementChild;
          const typeSelect = newItem.querySelector('.insurance-type');
          const amountInput = newItem.querySelector('.insurance-amount');
          const premiumInput = newItem.querySelector('.insurance-premium');
          if (typeSelect) typeSelect.value = item.type || '';
          if (amountInput) amountInput.value = item.amount || '';
          if (premiumInput) premiumInput.value = item.premium || '';
        }
      });
    }

    function populateChildOccupationData(data) {
      const container = document.getElementById('childOccupationContainer');
      container.innerHTML = ''; // Clear existing
      
      data.forEach((item, index) => {
        if (index === 0) {
          // Create first item
          const firstItem = createChildOccupationItem(0);
          container.appendChild(firstItem);
          const occupationSelect = firstItem.querySelector('.child-occupation');
          const detailInput = firstItem.querySelector('.child-occupation-detail');
          if (occupationSelect) occupationSelect.value = item.occupation || '';
          if (detailInput) detailInput.value = item.detail || '';
        } else {
          // Add new items
          addChildOccupation();
          const newItem = container.lastElementChild;
          const occupationSelect = newItem.querySelector('.child-occupation');
          const detailInput = newItem.querySelector('.child-occupation-detail');
          if (occupationSelect) occupationSelect.value = item.occupation || '';
          if (detailInput) detailInput.value = item.detail || '';
        }
      });
    }

    function generateCustomerPDF(customerId) {
      const customer = allCustomers.find(c => 
        c.id === customerId || c.__backendId === customerId
      );
      if (!customer) {
        showToast('ไม่พบข้อมูลลูกค้า', 'error');
        return;
      }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      doc.setFontSize(20);
      doc.text('รายงานการวิเคราะห์ลูกค้า', 20, 20);
      
      doc.setFontSize(12);
      doc.text(`Customer ID: ${customer.customer_id}`, 20, 40);
      doc.text(`ชื่อลูกค้า: ${customer.customer_name}`, 20, 50);
      doc.text(`พนักงาน: ${customer.employee_name}`, 20, 60);
      doc.text(`Zone: ${getZoneDisplayName(customer.employee_zone)}`, 20, 70);
      doc.text(`Risk Score: ${customer.risk_score}/100`, 20, 80);
      doc.text(`ระดับลูกค้า: ${customer.customer_level}`, 20, 90);
      doc.text(`ผลิตภัณฑ์แนะนำ: ${customer.product_recommendations}`, 20, 100);
      doc.text(`วงเงินแนะนำ: ${customer.suggested_amount}`, 20, 110);
      doc.text(`วันที่วิเคราะห์: ${new Date(customer.analysis_date).toLocaleDateString('th-TH')}`, 20, 120);
      
      doc.save(`customer-report-${customer.customer_id}.pdf`);
      showToast('สร้าง PDF รายงานสำเร็จ!');
    }

    function showCustomerDetailModal(customer) {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      
      const levelClass = customer.customer_level === 'Critical Risk' ? 'level-critical' :
                       customer.customer_level === 'Strategic Risk' ? 'level-strategic' : 'level-wealth';
      
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 600px; text-align: left;">
          <h3 class="modal-title">รายละเอียดลูกค้า</h3>
          <div class="modal-message">
            <div style="margin-bottom: 1rem;">
              <strong>Customer ID:</strong> ${customer.customer_id || 'N/A'}
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>ชื่อลูกค้า:</strong> ${customer.customer_name || 'N/A'}
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>พนักงาน:</strong> ${customer.employee_name || 'N/A'}
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>Zone:</strong> ${getZoneDisplayName(customer.employee_zone)}
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>ลักษณะลูกค้า:</strong> ${customer.customer_type || 'N/A'}
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>อาชีพ:</strong> ${customer.occupation || 'N/A'}
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>รายได้/ปี:</strong> ${customer.net_income ? new Intl.NumberFormat('th-TH').format(customer.net_income) + ' บาท' : 'N/A'}
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>Risk Score:</strong> ${customer.risk_score || 0}/100
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>ระดับลูกค้า:</strong> <span class="customer-level ${levelClass}">${customer.customer_level || 'N/A'}</span>
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>ผลิตภัณฑ์แนะนำ:</strong> ${customer.product_recommendations || 'N/A'}
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>วงเงินแนะนำ:</strong> ${customer.suggested_amount || 'N/A'}
            </div>
            <div>
              <strong>วันที่วิเคราะห์:</strong> ${customer.analysis_date ? new Date(customer.analysis_date).toLocaleDateString('th-TH') : 'N/A'}
            </div>
          </div>
          <div class="modal-buttons">
            <button class="btn btn-primary glass-btn" onclick="this.closest('.modal-overlay').remove()">ปิด</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    // Coach Functions
    function searchCustomer() {
      const searchTerm = document.getElementById('searchInput').value.trim();
      
      if (!searchTerm) {
        // Show all customers if no search term
        displaySearchResults(allCustomers);
        return;
      }

      const filteredCustomers = allCustomers.filter(customer => 
        customer.customer_id?.toLowerCase().includes(searchTerm.toLowerCase()) ||
        customer.customer_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
        customer.employee_name?.toLowerCase().includes(searchTerm.toLowerCase())
      );

      displaySearchResults(filteredCustomers);
    }

    function displaySearchResults(customers) {
      const container = document.getElementById('searchResults');
      
      if (customers.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
            <div style="font-size: 3rem; margin-bottom: 1rem;">🔍</div>
            <h3 style="margin-bottom: 0.5rem;">ไม่พบข้อมูลลูกค้า</h3>
            <p>ลองเปลี่ยนคำค้นหาหรือเงื่อนไขการกรอง</p>
          </div>
        `;
        return;
      }

      const customersHtml = customers.map(customer => {
        const levelClass = customer.customer_level === 'Critical Risk' ? 'level-critical' :
                         customer.customer_level === 'Strategic Risk' ? 'level-strategic' : 'level-wealth';
        
        return `
          <div class="customer-card">
            <div class="customer-header">
              <div>
                <div class="customer-name">${customer.customer_name || 'ไม่ระบุชื่อ'}</div>
                <div class="customer-meta">
                  ID: ${customer.customer_id || 'N/A'} | 
                  พนักงาน: ${customer.employee_name || 'ไม่ระบุ'} | 
                  Zone: ${getZoneDisplayName(customer.employee_zone)} |
                  วันที่บันทึก: ${customer.analysis_date ? new Date(customer.analysis_date).toLocaleDateString('th-TH') : 'ไม่ระบุ'}
                </div>
              </div>
              <div class="customer-level ${levelClass}">
                ${customer.customer_level || 'ไม่ระบุ'}
              </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
              <div>
                <strong>Risk Score:</strong> ${customer.risk_score || 0}/100
              </div>
              <div>
                <strong>ลักษณะลูกค้า:</strong> ${customer.customer_type || 'ไม่ระบุ'}
              </div>
              <div>
                <strong>อาชีพ:</strong> ${customer.occupation || 'ไม่ระบุ'}
              </div>
              <div>
                <strong>รายได้/ปี:</strong> ${customer.net_income ? new Intl.NumberFormat('th-TH').format(customer.net_income) + ' บาท' : 'ไม่ระบุ'}
              </div>
            </div>
            
            <div style="background: var(--background-color); padding: 1rem; border-radius: var(--radius-md); margin-bottom: 1rem;">
              <strong>ผลิตภัณฑ์แนะนำ:</strong> ${customer.product_recommendations || 'ไม่มีข้อมูล'}
            </div>
            
            <div style="display: flex; gap: 0.5rem; justify-content: flex-end; flex-wrap: wrap;">
              <button class="btn btn-sm btn-outline glass-btn" onclick="viewFullCustomerDetail('${customer.id || customer.__backendId}')">
                👁️ ดูรายละเอียด
              </button>
              <button class="btn btn-sm btn-primary glass-btn" onclick="addCoachComment('${customer.id || customer.__backendId}')">
                💬 เพิ่มความเห็น
              </button>
              <button class="btn btn-sm btn-secondary glass-btn" onclick="generateCustomerPDF('${customer.id || customer.__backendId}')">
                📄 สร้าง PDF
              </button>
            </div>
          </div>
        `;
      }).join('');
      
      container.innerHTML = customersHtml;
    }

    function filterByDate(filter) {
      currentFilter = filter;
      
      // Update active filter button
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      let filteredCustomers = [...allCustomers];
      
      const now = new Date();
      
      if (filter === 'today') {
        filteredCustomers = allCustomers.filter(customer => {
          if (!customer.analysis_date) return false;
          const customerDate = new Date(customer.analysis_date);
          return customerDate.toDateString() === now.toDateString();
        });
      } else if (filter === 'week') {
        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
        filteredCustomers = allCustomers.filter(customer => {
          if (!customer.analysis_date) return false;
          const customerDate = new Date(customer.analysis_date);
          return customerDate >= weekAgo;
        });
      } else if (filter === 'month') {
        const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
        filteredCustomers = allCustomers.filter(customer => {
          if (!customer.analysis_date) return false;
          const customerDate = new Date(customer.analysis_date);
          return customerDate >= monthAgo;
        });
      }
      
      displaySearchResults(filteredCustomers);
    }

    function addCoachComment(customerId) {
      const customer = allCustomers.find(c => 
        c.id === customerId || c.__backendId === customerId
      );
      if (!customer) {
        showToast('ไม่พบข้อมูลลูกค้า', 'error');
        return;
      }

      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 500px;">
          <h3 class="modal-title">💬 เพิ่มความเห็นสำหรับลูกค้า</h3>
          <div class="modal-message">
            <p style="margin: 0; font-size: 1rem; color: var(--text-primary);">
              ${customer.customer_name || customer.customer_id}
            </p>
          </div>
          
          <div style="margin-bottom: 1.5rem; text-align: left;">
            <label class="form-label">ประเภทความเห็น</label>
            <select class="form-select" id="commentType" style="width: 100%;">
              <option value="general">ทั่วไป</option>
              <option value="recommendation">คำแนะนำ</option>
              <option value="follow_up">ติดตามผล</option>
              <option value="concern">ข้อกังวล</option>
              <option value="opportunity">โอกาส</option>
            </select>
          </div>
          
          <div style="margin-bottom: 1.5rem; text-align: left;">
            <label class="form-label">รายละเอียดความเห็น</label>
            <textarea class="form-input" id="commentContent" placeholder="ระบุความเห็นของคุณ..." style="width: 100%; height: 120px; resize: vertical;"></textarea>
          </div>
          
          <div class="modal-buttons">
            <button class="btn btn-secondary glass-btn" onclick="this.closest('.modal-overlay').remove()">ยกเลิก</button>
            <button class="btn btn-primary glass-btn" onclick="saveCoachComment('${customerId}', this)">บันทึกความเห็น</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    function saveCoachComment(customerId, button) {
      const commentType = document.getElementById('commentType').value;
      const commentContent = document.getElementById('commentContent').value.trim();
      
      if (!commentContent) {
        showToast('กรุณาระบุรายละเอียดความเห็น', 'warning');
        return;
      }
      
      // In a real system, this would save to the database
      // For now, we'll just show a success message
      button.closest('.modal-overlay').remove();
      showToast('บันทึกความเห็นสำเร็จ!');
    }

    // Admin Functions
    function applyAdminFilters() {
      const dateFilter = document.getElementById('adminDateFilter').value;
      const riskFilter = document.getElementById('adminRiskFilter').value;
      const zoneFilter = document.getElementById('adminZoneFilter').value;
      
      let filteredCustomers = [...allCustomers];
      
      // Apply date filter
      if (dateFilter !== 'all') {
        const now = new Date();
        
        if (dateFilter === 'today') {
          filteredCustomers = filteredCustomers.filter(customer => {
            if (!customer.analysis_date) return false;
            const customerDate = new Date(customer.analysis_date);
            return customerDate.toDateString() === now.toDateString();
          });
        } else if (dateFilter === 'week') {
          const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
          filteredCustomers = filteredCustomers.filter(customer => {
            if (!customer.analysis_date) return false;
            const customerDate = new Date(customer.analysis_date);
            return customerDate >= weekAgo;
          });
        } else if (dateFilter === 'month') {
          const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
          filteredCustomers = filteredCustomers.filter(customer => {
            if (!customer.analysis_date) return false;
            const customerDate = new Date(customer.analysis_date);
            return customerDate >= monthAgo;
          });
        }
      }
      
      // Apply risk filter
      if (riskFilter !== 'all') {
        filteredCustomers = filteredCustomers.filter(customer => 
          customer.customer_level === riskFilter
        );
      }
      
      // Apply zone filter
      if (zoneFilter !== 'all') {
        filteredCustomers = filteredCustomers.filter(customer => 
          customer.employee_zone === zoneFilter
        );
      }
      
      displayAdminResults(filteredCustomers);
    }

    function displayAdminResults(customers) {
      const container = document.getElementById('adminResults');
      
      if (customers.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
            <div style="font-size: 3rem; margin-bottom: 1rem;">📊</div>
            <h3 style="margin-bottom: 0.5rem;">ไม่พบข้อมูลตามเงื่อนไข</h3>
            <p>ลองเปลี่ยนเงื่อนไขการกรอง</p>
          </div>
        `;
        return;
      }

      // Calculate statistics
      const criticalCount = customers.filter(c => c.customer_level === 'Critical Risk').length;
      const strategicCount = customers.filter(c => c.customer_level === 'Strategic Risk').length;
      const wealthCount = customers.filter(c => c.customer_level === 'Wealth & Lifestyle').length;
      
      const totalIncome = customers.reduce((sum, customer) => sum + (customer.net_income || 0), 0);
      const avgIncome = customers.length > 0 ? totalIncome / customers.length : 0;
      
      const statsHtml = `
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-number">${customers.length}</div>
            <div class="stat-label">จำนวนลูกค้าทั้งหมด</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${criticalCount}</div>
            <div class="stat-label">Critical Risk</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${strategicCount}</div>
            <div class="stat-label">Strategic Risk</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${wealthCount}</div>
            <div class="stat-label">Wealth & Lifestyle</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${new Intl.NumberFormat('th-TH').format(Math.round(avgIncome))}</div>
            <div class="stat-label">รายได้เฉลี่ย/ปี</div>
          </div>
        </div>
      `;
      
      const tableHtml = `
        <div style="margin-top: 2rem; overflow-x: auto;">
          <table class="data-table">
            <thead>
              <tr>
                <th>Customer ID</th>
                <th>ชื่อลูกค้า</th>
                <th>พนักงาน</th>
                <th>Zone</th>
                <th>Risk Score</th>
                <th>ระดับ</th>
                <th>วันที่บันทึก</th>
                <th>การดำเนินการ</th>
              </tr>
            </thead>
            <tbody>
              ${customers.map(customer => {
                const levelClass = customer.customer_level === 'Critical Risk' ? 'level-critical' :
                                 customer.customer_level === 'Strategic Risk' ? 'level-strategic' : 'level-wealth';
                
                return `
                  <tr>
                    <td>${customer.customer_id || 'N/A'}</td>
                    <td>${customer.customer_name || 'N/A'}</td>
                    <td>${customer.employee_name || 'N/A'}</td>
                    <td>${getZoneDisplayName(customer.employee_zone)}</td>
                    <td>${customer.risk_score || 0}/100</td>
                    <td><span class="customer-level ${levelClass}">${customer.customer_level || 'N/A'}</span></td>
                    <td>${customer.analysis_date ? new Date(customer.analysis_date).toLocaleDateString('th-TH') : 'N/A'}</td>
                    <td>
                      <div class="btn-group">
                        <button class="btn btn-sm btn-outline" onclick="viewFullCustomerDetail('${customer.id || customer.__backendId}')">ดู</button>
                        <button class="btn btn-sm btn-secondary" onclick="generateCustomerPDF('${customer.id || customer.__backendId}')">PDF</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCustomer('${customer.id || customer.__backendId}')">ลบ</button>
                      </div>
                    </td>
                  </tr>
                `;
              }).join('')}
            </tbody>
          </table>
        </div>
      `;
      
      container.innerHTML = statsHtml + tableHtml;
    }

    function exportToCSV() {
      if (allCustomers.length === 0) {
        showToast('ไม่มีข้อมูลที่จะส่งออก', 'warning');
        return;
      }
      
      // Create CSV content
      const headers = ['Customer ID', 'ชื่อลูกค้า', 'พนักงาน', 'Zone', 'Risk Score', 'ระดับ', 'วันที่บันทึก'];
      const csvContent = [
        headers.join(','),
        ...allCustomers.map(customer => [
          customer.customer_id || '',
          customer.customer_name || '',
          customer.employee_name || '',
          customer.employee_zone || '',
          customer.risk_score || '',
          customer.customer_level || '',
          customer.analysis_date ? new Date(customer.analysis_date).toLocaleDateString('th-TH') : ''
        ].join(','))
      ].join('\n');
      
      // Create download link
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.setAttribute('href', url);
      link.setAttribute('download', `customer-data-${new Date().toISOString().split('T')[0]}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      showToast('ส่งออกข้อมูลเป็น CSV สำเร็จ!');
    }

    function clearAllData() {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      
      modal.innerHTML = `
        <div class="modal-content">
          <h3 class="modal-title" style="color: var(--danger-color);">⚠️ ล้างข้อมูลทั้งหมด</h3>
          <div class="modal-message">
            <p style="margin: 0; font-size: 1rem; color: var(--text-primary);">
              คุณแน่ใจว่าต้องการล้างข้อมูลลูกค้าทั้งหมดหรือไม่?
            </p>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.875rem; color: var(--text-muted);">
              การกระทำนี้ไม่สามารถย้อนกลับได้ และจะลบข้อมูลทั้งหมดออกจากระบบ
            </p>
          </div>
          <div class="modal-buttons">
            <button class="btn btn-secondary glass-btn" onclick="this.closest('.modal-overlay').remove()">ยกเลิก</button>
            <button class="btn btn-danger glass-btn" onclick="confirmClearAllData(this)">ล้างข้อมูลทั้งหมด</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    function confirmClearAllData(button) {
      // Clear data from SDK
      if (window.dataSdk) {
        // This would typically be done through the SDK's delete all method
        // For now, we'll just clear the local storage
      }
      
      // Clear from localStorage
      localStorage.removeItem('customerData');
      
      // Clear from memory
      allCustomers = [];
      currentRecordCount = 0;
      
      // Update UI
      updateUI();
      
      // Close modal
      button.closest('.modal-overlay').remove();
      
      showToast('ล้างข้อมูลทั้งหมดสำเร็จ!', 'success');
    }

    function deleteCustomer(customerId) {
      const customer = allCustomers.find(c => 
        c.id === customerId || c.__backendId === customerId
      );
      if (!customer) {
        showToast('ไม่พบข้อมูลลูกค้า', 'error');
        return;
      }

      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      
      modal.innerHTML = `
        <div class="modal-content">
          <h3 class="modal-title" style="color: var(--danger-color);">🗑️ ลบข้อมูลลูกค้า</h3>
          <div class="modal-message">
            <p style="margin: 0; font-size: 1rem; color: var(--text-primary);">
              คุณแน่ใจว่าต้องการลบข้อมูลของ <strong>${customer.customer_name || customer.customer_id}</strong> หรือไม่?
            </p>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.875rem; color: var(--text-muted);">
              การกระทำนี้ไม่สามารถย้อนกลับได้
            </p>
          </div>
          <div class="modal-buttons">
            <button class="btn btn-secondary glass-btn" onclick="this.closest('.modal-overlay').remove()">ยกเลิก</button>
            <button class="btn btn-danger glass-btn" onclick="confirmDeleteCustomer('${customerId}', this)">ลบข้อมูล</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    function confirmDeleteCustomer(customerId, button) {
      // Remove from memory
      allCustomers = allCustomers.filter(customer => 
        customer.id !== customerId && customer.__backendId !== customerId
      );
      
      // Update localStorage
      localStorage.setItem('customerData', JSON.stringify(allCustomers));
      
      // Update UI
      updateUI();
      
      // Close modal
      button.closest('.modal-overlay').remove();
      
      showToast('ลบข้อมูลลูกค้าสำเร็จ!', 'success');
    }

    // Helper functions
    function getCommentTypeIcon(type) {
      const icons = {
        'general': '💬',
        'recommendation': '💡',
        'follow_up': '🔄',
        'concern': '⚠️',
        'opportunity': '🎯'
      };
      return icons[type] || '💬';
    }

    function getCommentTypeLabel(type) {
      const labels = {
        'general': 'ทั่วไป',
        'recommendation': 'คำแนะนำ',
        'follow_up': 'ติดตามผล',
        'concern': 'ข้อกังวล',
        'opportunity': 'โอกาส'
      };
      return labels[type] || 'ทั่วไป';
    }

    function getZoneDisplayName(zone) {
      const zones = {
        'ratchaburi': 'Zone ราชบุรี',
        'suratthani': 'Zone สุราษฎร์ธานี',
        'hatyai': 'Zone หาดใหญ่',
        'phuket': 'Zone ภูเก็ต',
        'samutsakorn': 'Zone สมุทรสาคร'
      };
      return zones[zone] || zone;
    }
  </script>
</body>
</html>
