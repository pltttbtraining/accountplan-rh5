<!doctype html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Customer Coaching Support System</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #007AFF;
      --primary-dark: #0056CC;
      --primary-light: #66AFFF;
      --secondary-color: #8E8E93;
      --accent-color: #34C759;
      --success-color: #30D158;
      --warning-color: #FF9500;
      --danger-color: #FF3B30;
      --background-color: #F2F2F7;
      --surface-color: #FFFFFF;
      --border-color: #C6C6C8;
      --text-primary: #000000;
      --text-secondary: #3C3C43;
      --text-muted: #8E8E93;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
      --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
      --shadow-xl: 0 20px 25px rgba(0,0,0,0.1);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--background-color);
      color: var(--text-primary);
      line-height: 1.6;
      font-size: 14px;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Welcome Screen Styles */
    .welcome-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 1s ease, transform 1s ease;
    }

    .welcome-content {
      text-align: center;
      color: white;
      max-width: 600px;
      padding: 2rem;
    }

    .welcome-logo {
      font-size: 4rem;
      margin-bottom: 1.5rem;
      animation: pulse 2s infinite;
    }

    .welcome-title {
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 1rem;
      letter-spacing: -0.025em;
      opacity: 0;
      animation: fadeInUp 1.5s ease forwards 0.5s;
    }

    .welcome-subtitle {
      font-size: 1.5rem;
      font-weight: 400;
      margin-bottom: 3rem;
      opacity: 0.9;
      opacity: 0;
      animation: fadeInUp 1.5s ease forwards 1s;
    }

    .enter-button {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 1rem 3rem;
      border-radius: 50px;
      font-size: 1.25rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      opacity: 0;
      animation: fadeInUp 1.5s ease forwards 1.5s;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    }

    .enter-button:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-5px);
      box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.5);
    }

    .welcome-screen.fade-out {
      opacity: 0;
      transform: scale(1.1);
      pointer-events: none;
    }

    /* Main App Styles (hidden initially) */
    .main-app {
      opacity: 0;
      transition: opacity 1s ease;
    }

    .main-app.show {
      opacity: 1;
    }

    .header {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 2rem 0;
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
      opacity: 0.3;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
      position: relative;
      z-index: 1;
    }

    .header h1 {
      margin: 0 0 0.5rem 0;
      font-size: 2.5rem;
      font-weight: 700;
      letter-spacing: -0.025em;
    }

    .header p {
      margin: 0;
      font-size: 1.125rem;
      opacity: 0.9;
      font-weight: 400;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    .role-selector {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .role-card {
      background: var(--surface-color);
      border: 2px solid var(--border-color);
      border-radius: var(--radius-xl);
      padding: 2rem;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: var(--shadow-sm);
      position: relative;
      overflow: hidden;
    }

    .role-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 122, 255, 0.05), transparent);
      transition: left 0.5s ease;
    }

    .role-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
      border-color: var(--primary-light);
    }

    .role-card:hover::before {
      left: 100%;
    }

    .role-card.active {
      border-color: var(--primary-color);
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      color: white;
      box-shadow: var(--shadow-xl);
    }

    .role-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      display: block;
      filter: grayscale(0.2);
    }

    .role-card.active .role-icon {
      filter: none;
    }

    .role-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      letter-spacing: -0.025em;
    }

    .role-description {
      font-size: 0.875rem;
      opacity: 0.8;
      line-height: 1.5;
    }

    .main-content {
      background: var(--surface-color);
      border-radius: var(--radius-xl);
      padding: 2rem;
      box-shadow: var(--shadow-md);
      margin-top: 1.5rem;
      border: 1px solid var(--border-color);
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.3s ease;
    }

    .main-content.show {
      opacity: 1;
      transform: translateY(0);
    }

    .progress-container {
      background: var(--background-color);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      margin-bottom: 2rem;
      border: 1px solid var(--border-color);
    }

    .progress-bar {
      background: var(--border-color);
      border-radius: var(--radius-md);
      height: 8px;
      margin-bottom: 1rem;
      overflow: hidden;
    }

    .progress-fill {
      background: linear-gradient(90deg, var(--primary-color) 0%, var(--accent-color) 100%);
      height: 100%;
      width: 0%;
      transition: width 0.3s ease;
      border-radius: var(--radius-md);
    }

    .step-indicator {
      display: flex;
      justify-content: space-between;
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    .step {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 500;
    }

    .step.active {
      color: var(--primary-color);
      font-weight: 600;
    }

    .form-section {
      margin-bottom: 2rem;
      padding: 1.5rem;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      transition: all 0.2s ease;
      background: var(--surface-color);
    }

    .form-section:hover {
      border-color: var(--primary-light);
      box-shadow: var(--shadow-sm);
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .section-icon {
      font-size: 1.5rem;
      color: var(--primary-color);
      background: rgba(0, 122, 255, 0.1);
      padding: 0.75rem;
      border-radius: var(--radius-md);
    }

    .section-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
      letter-spacing: -0.025em;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text-primary);
      font-size: 0.875rem;
    }

    .form-sublabel {
      font-size: 0.75rem;
      color: var(--text-muted);
      font-weight: 400;
      margin-left: 0.25rem;
    }

    .form-input, .form-select {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      transition: all 0.2s ease;
      background: var(--surface-color);
      color: var(--text-primary);
      font-family: inherit;
    }

    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    }

    .form-input:disabled, .form-select:disabled {
      background: var(--background-color);
      color: var(--text-muted);
      cursor: not-allowed;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 0.5rem;
      padding: 0.75rem;
      background: var(--background-color);
      border-radius: var(--radius-sm);
      border: 1px solid var(--border-color);
    }

    .checkbox-input {
      width: 16px;
      height: 16px;
      accent-color: var(--primary-color);
    }

    .checkbox-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      cursor: pointer;
    }

    .customer-type-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .customer-type-card {
      padding: 1.5rem;
      border: 2px solid var(--border-color);
      border-radius: var(--radius-lg);
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
      background: var(--surface-color);
    }

    .customer-type-card:hover {
      border-color: var(--primary-light);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .customer-type-card.selected {
      border-color: var(--primary-color);
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      color: white;
      box-shadow: var(--shadow-lg);
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-family: inherit;
      letter-spacing: -0.025em;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      color: white;
      box-shadow: var(--shadow-sm);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .btn-secondary {
      background: var(--secondary-color);
      color: white;
    }

    .btn-secondary:hover {
      background: #6d6d73;
      transform: translateY(-1px);
    }

    .btn-danger {
      background: var(--danger-color);
      color: white;
    }

    .btn-danger:hover {
      background: #d70015;
      transform: translateY(-1px);
    }

    .btn-outline {
      background: transparent;
      color: var(--primary-color);
      border: 1px solid var(--primary-color);
    }

    .btn-outline:hover {
      background: var(--primary-color);
      color: white;
    }

    .floating-save {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      z-index: 1000;
      border-radius: var(--radius-xl);
      padding: 1rem 2rem;
      box-shadow: var(--shadow-xl);
      font-size: 1rem;
    }

    .search-section {
      background: var(--background-color);
      padding: 2rem;
      border-radius: var(--radius-lg);
      margin-bottom: 2rem;
      border: 1px solid var(--border-color);
    }

    .search-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .search-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    .search-controls {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .search-input {
      flex: 1;
      min-width: 300px;
      padding: 0.75rem 1rem;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      font-size: 0.875rem;
    }

    .filter-buttons {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 0.5rem 1rem;
      border: 1px solid var(--border-color);
      background: var(--surface-color);
      color: var(--text-secondary);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.875rem;
    }

    .filter-btn:hover {
      border-color: var(--primary-color);
      color: var(--primary-color);
    }

    .filter-btn.active {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    .customer-card {
      background: var(--surface-color);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      margin-bottom: 1rem;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-color);
      border-left: 4px solid var(--primary-color);
      transition: all 0.2s ease;
    }

    .customer-card:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-1px);
    }

    .customer-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-color);
    }

    .customer-name {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }

    .customer-meta {
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    .customer-level {
      padding: 0.5rem 1rem;
      border-radius: var(--radius-md);
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .level-critical {
      background: rgba(255, 59, 48, 0.1);
      color: var(--danger-color);
      border: 1px solid rgba(255, 59, 48, 0.2);
    }

    .level-strategic {
      background: rgba(255, 149, 0, 0.1);
      color: var(--warning-color);
      border: 1px solid rgba(255, 149, 0, 0.2);
    }

    .level-wealth {
      background: rgba(48, 209, 88, 0.1);
      color: var(--success-color);
      border: 1px solid rgba(48, 209, 88, 0.2);
    }

    .analysis-result {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      color: white;
      padding: 2rem;
      border-radius: var(--radius-lg);
      margin-top: 2rem;
      box-shadow: var(--shadow-lg);
    }

    .analysis-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .analysis-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
    }

    .analysis-item {
      background: rgba(255, 255, 255, 0.1);
      padding: 1.5rem;
      border-radius: var(--radius-md);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .analysis-label {
      font-size: 0.875rem;
      opacity: 0.8;
      margin-bottom: 0.5rem;
    }

    .analysis-value {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .admin-controls {
      background: var(--background-color);
      padding: 2rem;
      border-radius: var(--radius-lg);
      margin-bottom: 2rem;
      border: 1px solid var(--border-color);
    }

    .admin-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .admin-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    .filter-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .filter-label {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-primary);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .stat-card {
      background: var(--surface-color);
      padding: 1.5rem;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-color);
      text-align: center;
    }

    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 0.5rem;
    }

    .stat-label {
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    .toast {
      position: fixed;
      top: 2rem;
      right: 2rem;
      background: var(--success-color);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      z-index: 1001;
      opacity: 0;
      transform: translateX(100%);
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(0);
    }

    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeInUp {
      from { 
        opacity: 0; 
        transform: translateY(30px); 
      }
      to { 
        opacity: 1; 
        transform: translateY(0); 
      }
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
      20%, 40%, 60%, 80% { transform: translateX(3px); }
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      animation: fadeIn 0.3s ease forwards;
    }

    .modal-content {
      background: var(--surface-color);
      padding: 2rem;
      border-radius: var(--radius-xl);
      text-align: center;
      max-width: 450px;
      width: 90%;
      box-shadow: var(--shadow-xl);
      border: 1px solid var(--border-color);
      transform: scale(0.9);
      animation: modalIn 0.3s ease forwards;
    }

    @keyframes modalIn {
      to {
        transform: scale(1);
      }
    }

    .modal-title {
      color: var(--primary-color);
      margin-bottom: 1.5rem;
      font-size: 1.5rem;
      font-weight: 600;
    }

    .modal-message {
      background: var(--background-color);
      padding: 1.5rem;
      border-radius: var(--radius-md);
      margin-bottom: 1.5rem;
      border: 1px solid var(--border-color);
    }

    .modal-input {
      width: 100%;
      padding: 1rem;
      border: 2px solid var(--border-color);
      border-radius: var(--radius-md);
      font-size: 1rem;
      margin-bottom: 1.5rem;
      text-align: center;
      letter-spacing: 2px;
      font-family: inherit;
    }

    .modal-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .modal-error {
      color: var(--danger-color);
      margin-top: 1rem;
      font-size: 0.875rem;
      display: none;
    }

    /* Zone Selection Styles */
    .zone-selector {
      background: linear-gradient(135deg, rgba(0, 122, 255, 0.05) 0%, rgba(102, 175, 255, 0.05) 100%);
      border: 1px solid rgba(0, 122, 255, 0.1);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .zone-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--primary-color);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Enhanced Button Styles */
    .btn-group {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .btn-sm {
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
    }

    .btn-icon {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Data Table Styles */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--surface-color);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-color);
    }

    .data-table th {
      background: var(--background-color);
      padding: 1rem;
      text-align: left;
      font-weight: 600;
      color: var(--text-primary);
      border-bottom: 1px solid var(--border-color);
      font-size: 0.875rem;
    }

    .data-table td {
      padding: 1rem;
      border-bottom: 1px solid var(--border-color);
      font-size: 0.875rem;
    }

    .data-table tr:hover {
      background: var(--background-color);
    }

    /* Enhanced Form Sections */
    .form-subsection {
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 1.5rem;
      margin-bottom: 1rem;
      background: var(--surface-color);
    }

    .subsection-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .subsection-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--primary-color);
      margin: 0;
    }

    .remove-btn {
      background: var(--danger-color);
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .remove-btn:hover {
      background: #d70015;
    }

    /* Tab Styles */
    .tab-btn {
      padding: 0.75rem 1.5rem;
      border: none;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s ease;
      font-size: 0.875rem;
      font-weight: 500;
      font-family: inherit;
    }

    .tab-btn:hover {
      color: var(--primary-color);
      background: rgba(0, 122, 255, 0.05);
    }

    .tab-btn.active {
      color: var(--primary-color);
      border-bottom-color: var(--primary-color);
      background: rgba(0, 122, 255, 0.1);
    }

    .tab-content {
      animation: fadeIn 0.3s ease;
    }

    /* Comment Type Badges */
    .comment-type-badge {
      padding: 0.25rem 0.5rem;
      border-radius: var(--radius-sm);
      font-size: 0.75rem;
      font-weight: 600;
    }

    .comment-type-badge.general {
      background: rgba(142, 142, 147, 0.1);
      color: var(--secondary-color);
    }

    .comment-type-badge.recommendation {
      background: rgba(0, 122, 255, 0.1);
      color: var(--primary-color);
    }

    .comment-type-badge.follow_up {
      background: rgba(52, 199, 89, 0.1);
      color: var(--accent-color);
    }

    .comment-type-badge.concern {
      background: rgba(255, 149, 0, 0.1);
      color: var(--warning-color);
    }

    .comment-type-badge.opportunity {
      background: rgba(88, 86, 214, 0.1);
      color: #5856D6;
    }

    /* Glass morphism buttons */
    .glass-btn {
      background: rgba(255, 255, 255, 0.1) !important;
      backdrop-filter: blur(10px) !important;
      border: 1px solid rgba(255, 255, 255, 0.2) !important;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37) !important;
      transition: all 0.3s ease !important;
    }

    .glass-btn:hover {
      background: rgba(255, 255, 255, 0.2) !important;
      transform: translateY(-2px) !important;
      box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.5) !important;
    }

    .glass-btn:active {
      transform: translateY(0) !important;
    }

    .btn-primary.glass-btn {
      background: rgba(0, 122, 255, 0.3) !important;
      color: white !important;
    }

    .btn-primary.glass-btn:hover {
      background: rgba(0, 122, 255, 0.5) !important;
    }

    .btn-secondary.glass-btn {
      background: rgba(142, 142, 147, 0.3) !important;
      color: white !important;
    }

    .btn-secondary.glass-btn:hover {
      background: rgba(142, 142, 147, 0.5) !important;
    }

    .btn-danger.glass-btn {
      background: rgba(255, 59, 48, 0.3) !important;
      color: white !important;
    }

    .btn-danger.glass-btn:hover {
      background: rgba(255, 59, 48, 0.5) !important;
    }

    .btn-outline.glass-btn {
      background: rgba(255, 255, 255, 0.05) !important;
      color: var(--primary-color) !important;
      border: 1px solid rgba(0, 122, 255, 0.3) !important;
    }

    .btn-outline.glass-btn:hover {
      background: rgba(0, 122, 255, 0.1) !important;
      color: var(--primary-color) !important;
    }

    @media (max-width: 768px) {
      .container {
        padding: 1rem;
      }
      
      .header h1 {
        font-size: 2rem;
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .customer-type-grid {
        grid-template-columns: 1fr;
      }
      
      .floating-save {
        bottom: 1rem;
        right: 1rem;
        padding: 0.75rem 1.5rem;
      }

      .search-controls {
        flex-direction: column;
      }

      .search-input {
        min-width: auto;
      }

      .filter-buttons {
        justify-content: center;
      }

      .welcome-title {
        font-size: 2rem;
      }

      .welcome-subtitle {
        font-size: 1.25rem;
      }
    }
  </style>
</head>
<body>
  <!-- Welcome Screen -->
  <div class="welcome-screen" id="welcomeScreen">
    <div class="welcome-content">
      <div class="welcome-logo">üìä</div>
      <h1 class="welcome-title">Welcome to RH5 Customer Analysis System</h1>
      <p class="welcome-subtitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</p>
      <button class="enter-button" id="enterButton">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
  </div>

  <!-- Main Application (hidden initially) -->
  <div class="main-app" id="mainApp">
    <div class="header">
      <div class="header-content">
        <h1 id="system-title">Customer Coaching Support System</h1>
        <p id="company-name">TTB Bank - ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</p>
      </div>
    </div>
    
    <div class="container">
      <!-- Role Selection -->
      <div class="role-selector" id="roleSelector">
        <div class="role-card" data-role="employee">
          <span class="role-icon">üë®‚Äçüíº</span>
          <div class="role-title">Employee / Sales</div>
          <div class="role-description">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢ - ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</div>
        </div>
        <div class="role-card" data-role="coach">
          <span class="role-icon">üéØ</span>
          <div class="role-title">Coach</div>
          <div class="role-description">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤ - ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏° Notes</div>
        </div>
        <div class="role-card" data-role="admin">
          <span class="role-icon">‚öôÔ∏è</span>
          <div class="role-title">Admin</div>
          <div class="role-description">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
        </div>
      </div>

      <!-- Main Content Areas -->
      <div class="main-content" id="employeeContent">
        <!-- Customer Search Section -->
        <div class="search-section" style="margin-bottom: 2rem;">
          <div class="search-header">
            <span style="font-size: 1.5rem;">üîç</span>
            <h3 class="search-title">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°</h3>
          </div>
          <div class="search-controls">
            <input type="text" class="search-input" id="employeeSearchInput" placeholder="‡πÉ‡∏™‡πà Customer ID ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤..." style="flex: 1; min-width: 300px;">
            <button type="button" class="btn btn-primary btn-icon" onclick="searchExistingCustomer()">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
            <button type="button" class="btn btn-outline btn-icon" onclick="clearSearch()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
          </div>
          <div id="searchResultContainer" style="display: none; margin-top: 1.5rem;"></div>
        </div>

        <div class="progress-container">
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div class="step-indicator">
            <div class="step active" id="step1"><span>üìã</span> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</div>
            <div class="step" id="step2"><span>üë§</span> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</div>
            <div class="step" id="step3"><span>üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</div>
            <div class="step" id="step4"><span>üè¢</span> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à</div>
            <div class="step" id="step5"><span>üìä</span> ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ú‡∏•</div>
          </div>
        </div>

        <form id="customerForm">
          <!-- Section 1: Basic Information -->
          <div class="form-section">
            <div class="section-header">
              <span class="section-icon">üìã</span>
              <h3 class="section-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h3>
            </div>
            
            <!-- Zone Selection -->
            <div class="zone-selector">
              <div class="zone-title"><span>üìç</span> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone ‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î</div>
              <select class="form-select" id="employeeZone" required>
                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Zone</option>
                <option value="ratchaburi">Zone ‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ</option>
                <option value="suratthani">Zone ‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ</option>
                <option value="hatyai">Zone ‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà</option>
                <option value="phuket">Zone ‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï</option>
                <option value="samutsakorn">Zone ‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£</option>
              </select>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Customer ID <span class="form-sublabel">(‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</span></label>
                <input type="text" class="form-input" id="customerId" readonly style="background: var(--background-color); color: var(--text-muted);">
              </div>
              <div class="form-group">
                <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô <span class="form-sublabel">(‡∏ú‡∏π‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)</span></label>
                <input type="text" class="form-input" id="employeeName" required>
              </div>
              <div class="form-group">
                <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ <span class="form-sublabel">(‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•)</span></label>
                <input type="text" class="form-input" id="customerName" required>
              </div>
            </div>
            
            <div class="form-group">
              <label class="form-label">‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ <span class="form-sublabel">(‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1 ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞)</span></label>
              <div class="customer-type-grid">
                <div class="customer-type-card" data-type="goal_oriented">
                  <h4>üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</h4>
                  <p>‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß</p>
                </div>
                <div class="customer-type-card" data-type="celebrity">
                  <h4>‚≠ê ‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏î‡∏≤‡∏£‡∏≤</h4>
                  <p>‡∏ä‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏î‡∏î‡πÄ‡∏î‡πà‡∏ô ‡∏™‡∏ô‡πÉ‡∏à‡∏†‡∏≤‡∏û‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå</p>
                </div>
                <div class="customer-type-card" data-type="analytical">
                  <h4>üßÆ ‡∏Ñ‡∏¥‡∏î‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</h4>
                  <p>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                </div>
                <div class="customer-type-card" data-type="conservative">
                  <h4>üõ°Ô∏è ‡∏ñ‡∏ô‡∏≠‡∏°‡∏à‡∏¥‡∏ï‡∏£</h4>
                  <p>‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏£‡∏∞‡∏ß‡∏±‡∏á ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Section 2: Personal Information -->
          <div class="form-section">
            <div class="section-header">
              <span class="section-icon">üë§</span>
              <h3 class="section-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h3>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">‡∏≠‡∏≤‡∏ä‡∏µ‡∏û <span class="form-sublabel">(‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏´‡∏•‡∏±‡∏Å)</span></label>
                <select class="form-select" id="occupation">
                  <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</option>
                  <option value="government">‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</option>
                  <option value="business_owner">‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</option>
                  <option value="employee">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</option>
                  <option value="freelance">‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏≠‡∏¥‡∏™‡∏£‡∏∞</option>
                  <option value="trader">‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢</option>
                  <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏≤‡∏ä‡∏µ‡∏û <span class="form-sublabel">(‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô/‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à)</span></label>
                <input type="text" class="form-input" id="occupationDetail" placeholder="‡πÄ‡∏ä‡πà‡∏ô Manager, ‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£, ‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownOccupationDetail">
                  <label class="checkbox-label" for="unknownOccupationDetail">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥/‡∏õ‡∏µ <span class="form-sublabel">(‡∏ö‡∏≤‡∏ó)</span></label>
                <input type="number" class="form-input" id="netIncome" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownNetIncome">
                  <label class="checkbox-label" for="unknownNetIncome">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
            </div>

            <!-- Assets Section -->
            <h4 style="margin: 2rem 0 1rem 0; color: var(--primary-color); font-weight: 600;">üí∞ ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</h4>
            
            <!-- Real Estate Section -->
            <div class="form-subsection">
              <div class="subsection-header">
                <h5 class="subsection-title">üè† ‡∏≠‡∏™‡∏±‡∏á‡∏´‡∏≤‡∏£‡∏¥‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå</h5>
                <button type="button" class="btn btn-primary btn-sm" onclick="addRealEstate()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏™‡∏±‡∏á‡∏´‡∏≤‡∏Ø</button>
              </div>
              <div id="realEstateContainer">
                <div class="real-estate-item" data-index="0">
                  <div class="form-grid">
                    <div class="form-group">
                      <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                      <input type="text" class="form-input real-estate-type" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ö‡πâ‡∏≤‡∏ô, ‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î, ‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô">
                      <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="unknownRealEstateType0">
                        <label class="checkbox-label" for="unknownRealEstateType0">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="form-label">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ <span class="form-sublabel">(‡∏ö‡∏≤‡∏ó)</span></label>
                      <input type="number" class="form-input real-estate-value" placeholder="0">
                      <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="unknownRealEstateValue0">
                        <label class="checkbox-label" for="unknownRealEstateValue0">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Vehicle Section -->
            <div class="form-subsection">
              <div class="subsection-header">
                <h5 class="subsection-title">üöó ‡∏¢‡∏≤‡∏ô‡∏û‡∏≤‡∏´‡∏ô‡∏∞</h5>
                <button type="button" class="btn btn-primary btn-sm" onclick="addVehicle()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏¢‡∏≤‡∏ô‡∏û‡∏≤‡∏´‡∏ô‡∏∞</button>
              </div>
              <div id="vehicleContainer">
                <div class="vehicle-item" data-index="0">
                  <div class="form-grid">
                    <div class="form-group">
                      <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                      <input type="text" class="form-input vehicle-type" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå, ‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå">
                      <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="unknownVehicleType0">
                        <label class="checkbox-label" for="unknownVehicleType0">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="form-label">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ <span class="form-sublabel">(‡∏ö‡∏≤‡∏ó)</span></label>
                      <input type="number" class="form-input vehicle-value" placeholder="0">
                      <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="unknownVehicleValue0">
                        <label class="checkbox-label" for="unknownVehicleValue0">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">‡πÄ‡∏á‡∏¥‡∏ô‡∏ù‡∏≤‡∏Å <span class="form-sublabel">(‡∏ö‡∏≤‡∏ó)</span></label>
                <input type="number" class="form-input" id="savings" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownSavings">
                  <label class="checkbox-label" for="unknownSavings">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">‡∏´‡∏∏‡πâ‡∏ô‡∏Å‡∏π‡πâ <span class="form-sublabel">(‡∏ö‡∏≤‡∏ó)</span></label>
                <input type="number" class="form-input" id="bonds" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownBonds">
                  <label class="checkbox-label" for="unknownBonds">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô <span class="form-sublabel">(‡∏ö‡∏≤‡∏ó)</span></label>
                <input type="number" class="form-input" id="funds" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownFunds">
                  <label class="checkbox-label" for="unknownFunds">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï <span class="form-sublabel">(‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô - ‡∏ö‡∏≤‡∏ó)</span></label>
                <input type="number" class="form-input" id="creditCards" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownCreditCards">
                  <label class="checkbox-label" for="unknownCreditCards">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠ <span class="form-sublabel">(‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ - ‡∏ö‡∏≤‡∏ó)</span></label>
                <input type="number" class="form-input" id="loans" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownLoans">
                  <label class="checkbox-label" for="unknownLoans">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
            </div>

            <!-- Insurance Section -->
            <div class="form-subsection">
              <div class="subsection-header">
                <h4 class="subsection-title">üõ°Ô∏è ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</h4>
                <button type="button" class="btn btn-primary btn-sm" onclick="addInsurance()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô</button>
              </div>
              <div id="insuranceContainer">
                <div class="insurance-item" data-index="0">
                  <div class="form-grid">
                    <div class="form-group">
                      <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á</label>
                      <select class="form-select insurance-type">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
                        <option value="life">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</option>
                        <option value="health">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</option>
                        <option value="critical_illness">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÇ‡∏£‡∏Ñ‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á</option>
                        <option value="accident">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏</option>
                        <option value="disability">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏û‡∏û‡∏•‡∏†‡∏≤‡∏û</option>
                        <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                      </select>
                      <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="unknownInsuranceType0">
                        <label class="checkbox-label" for="unknownInsuranceType0">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="form-label">‡∏ó‡∏∏‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô <span class="form-sublabel">(‡∏ö‡∏≤‡∏ó)</span></label>
                      <input type="number" class="form-input insurance-amount" placeholder="0">
                      <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="unknownInsuranceAmount0">
                        <label class="checkbox-label" for="unknownInsuranceAmount0">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="form-label">‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô/‡∏õ‡∏µ <span class="form-sublabel">(‡∏ö‡∏≤‡∏ó)</span></label>
                      <input type="number" class="form-input insurance-premium" placeholder="0">
                      <div class="checkbox-group">
                        <input type="checkbox" class="checkbox-input" id="unknownInsurancePremium0">
                        <label class="checkbox-label" for="unknownInsurancePremium0">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Investment Section -->
            <h4 style="margin: 2rem 0 1rem 0; color: var(--primary-color); font-weight: 600;">üìà ‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô</h4>
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">AUM TTB <span class="form-sublabel">(‡∏ö‡∏≤‡∏ó)</span></label>
                <input type="number" class="form-input" id="aumTtb" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownAumTtb">
                  <label class="checkbox-label" for="unknownAumTtb">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">AUM ‡∏ó‡∏µ‡πà‡∏≠‡∏∑‡πà‡∏ô‡πÜ <span class="form-sublabel">(‡∏ö‡∏≤‡∏ó)</span></label>
                <input type="number" class="form-input" id="aumOthers" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownAumOthers">
                  <label class="checkbox-label" for="unknownAumOthers">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
            </div>
          </div>

          <!-- Section 3: Family Information -->
          <div class="form-section">
            <div class="section-header">
              <span class="section-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
              <h3 class="section-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</h3>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ñ‡∏π‡πà‡∏™‡∏°‡∏£‡∏™ <span class="form-sublabel">(‡∏õ‡∏µ)</span></label>
                <input type="number" class="form-input" id="spouseAge" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownSpouseAge">
                  <label class="checkbox-label" for="unknownSpouseAge">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏Ñ‡∏π‡πà‡∏™‡∏°‡∏£‡∏™</label>
                <select class="form-select" id="spouseOccupation">
                  <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</option>
                  <option value="government">‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</option>
                  <option value="business_owner">‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</option>
                  <option value="employee">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</option>
                  <option value="freelance">‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏≠‡∏¥‡∏™‡∏£‡∏∞</option>
                  <option value="trader">‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢</option>
                  <option value="housewife">‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô/‡∏û‡πà‡∏≠‡∏ö‡πâ‡∏≤‡∏ô</option>
                  <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                </select>
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownSpouseOccupation">
                  <label class="checkbox-label" for="unknownSpouseOccupation">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏Ñ‡∏π‡πà‡∏™‡∏°‡∏£‡∏™</label>
                <input type="text" class="form-input" id="spouseOccupationDetail" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô/‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏á‡∏≤‡∏ô">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownSpouseOccupationDetail">
                  <label class="checkbox-label" for="unknownSpouseOccupationDetail">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏∏‡∏ï‡∏£ <span class="form-sublabel">(‡∏Ñ‡∏ô)</span></label>
                <input type="number" class="form-input" id="childrenCount" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownChildrenCount">
                  <label class="checkbox-label" for="unknownChildrenCount">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">‡∏≠‡∏≤‡∏¢‡∏∏‡∏ö‡∏∏‡∏ï‡∏£ <span class="form-sublabel">(‡∏õ‡∏µ - ‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏à‡∏∏‡∏•‡∏†‡∏≤‡∏Ñ)</span></label>
                <input type="text" class="form-input" id="childrenAges" placeholder="‡πÄ‡∏ä‡πà‡∏ô 15, 18, 22">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownChildrenAges">
                  <label class="checkbox-label" for="unknownChildrenAges">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
              
              <div class="form-subsection">
                <div class="subsection-header">
                  <label class="form-label" style="margin: 0;">‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏ö‡∏∏‡∏ï‡∏£</label>
                  <button type="button" class="btn btn-primary btn-sm" onclick="addChildOccupation()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏∏‡∏ï‡∏£</button>
                </div>
                <div id="childOccupationContainer">
                  <div class="child-occupation-item" data-index="0">
                    <div style="display: flex; gap: 1rem; align-items: start; margin-bottom: 1rem;">
                      <div style="flex: 1;">
                        <label class="form-label" style="font-size: 0.875rem;">‡∏ö‡∏∏‡∏ï‡∏£‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà 1 - ‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</label>
                        <select class="form-select child-occupation">
                          <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</option>
                          <option value="student">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
                          <option value="government">‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</option>
                          <option value="business_owner">‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</option>
                          <option value="employee">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</option>
                          <option value="freelance">‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏≠‡∏¥‡∏™‡∏£‡∏∞</option>
                          <option value="trader">‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢</option>
                          <option value="unemployed">‡∏ß‡πà‡∏≤‡∏á‡∏á‡∏≤‡∏ô</option>
                          <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                        </select>
                      </div>
                      <div style="flex: 1;">
                        <label class="form-label" style="font-size: 0.875rem;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                        <input type="text" class="form-input child-occupation-detail" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô/‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤">
                      </div>
                    </div>
                    <div class="checkbox-group">
                      <input type="checkbox" class="checkbox-input" id="unknownChildOccupation0">
                      <label class="checkbox-label" for="unknownChildOccupation0">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="form-group">
                <label class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏•‡∏≤‡∏ô <span class="form-sublabel">(‡∏Ñ‡∏ô)</span></label>
                <input type="number" class="form-input" id="grandchildrenCount" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownGrandchildrenCount">
                  <label class="checkbox-label" for="unknownGrandchildrenCount">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÉ‡∏ô‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</label>
                <input type="text" class="form-input" id="otherPeople" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏û‡πà‡∏≠‡πÅ‡∏°‡πà, ‡∏û‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏á">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownOtherPeople">
                  <label class="checkbox-label" for="unknownOtherPeople">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à</label>
                <input type="text" class="form-input" id="decisionMaker" placeholder="‡πÉ‡∏Ñ‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡πÉ‡∏ô‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownDecisionMaker">
                  <label class="checkbox-label" for="unknownDecisionMaker">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏á‡∏™‡∏µ <span class="form-sublabel">(‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÅ‡∏ö‡πà‡∏á‡∏°‡∏£‡∏î‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà)</span></label>
                <div style="display: flex; gap: 1.5rem; margin-top: 0.75rem;">
                  <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    <input type="radio" name="inheritanceStyle" value="yes" style="width: 16px; height: 16px; accent-color: var(--primary-color);">
                    <span>‡πÉ‡∏ä‡πà</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                    <input type="radio" name="inheritanceStyle" value="no" style="width: 16px; height: 16px; accent-color: var(--primary-color);">
                    <span>‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà</span>
                  </label>
                </div>
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownInheritanceStyle">
                  <label class="checkbox-label" for="unknownInheritanceStyle">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
            </div>
          </div>

          <!-- Section 4: Business Information -->
          <div class="form-section">
            <div class="section-header">
              <span class="section-icon">üè¢</span>
              <h3 class="section-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à</h3>
            </div>
            
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£</label>
                <input type="text" class="form-input" id="businessName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó/‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownBusinessName">
                  <label class="checkbox-label" for="unknownBusinessName">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏¥‡∏à‡∏Å‡∏≤‡∏£</label>
                <input type="text" class="form-input" id="businessType" placeholder="‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownBusinessType">
                  <label class="checkbox-label" for="unknownBusinessType">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">‡∏ó‡∏∏‡∏ô‡∏à‡∏î‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô <span class="form-sublabel">(‡∏ö‡∏≤‡∏ó)</span></label>
                <input type="number" class="form-input" id="registeredCapital" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownRegisteredCapital">
                  <label class="checkbox-label" for="unknownRegisteredCapital">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à/‡∏õ‡∏µ <span class="form-sublabel">(‡∏ö‡∏≤‡∏ó)</span></label>
                <input type="number" class="form-input" id="businessIncome" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownBusinessIncome">
                  <label class="checkbox-label" for="unknownBusinessIncome">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ <span class="form-sublabel">(‡∏ö‡∏≤‡∏ó)</span></label>
                <input type="number" class="form-input" id="netProfit" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownNetProfit">
                  <label class="checkbox-label" for="unknownNetProfit">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">‡∏†‡∏≤‡∏©‡∏µ <span class="form-sublabel">(‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ)</span></label>
                <input type="number" class="form-input" id="tax" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownTax">
                  <label class="checkbox-label" for="unknownTax">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô <span class="form-sublabel">(%)</span></label>
                <input type="number" class="form-input" id="shareholding" placeholder="0" max="100">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownShareholding">
                  <label class="checkbox-label" for="unknownShareholding">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô <span class="form-sublabel">(‡∏ö‡∏≤‡∏ó)</span></label>
                <input type="number" class="form-input" id="shareholderEquity" placeholder="0">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownShareholderEquity">
                  <label class="checkbox-label" for="unknownShareholderEquity">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô‡πÜ</label>
                <input type="text" class="form-input" id="otherBusinessInfo" placeholder="‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à">
                <div class="checkbox-group">
                  <input type="checkbox" class="checkbox-input" id="unknownOtherBusinessInfo">
                  <label class="checkbox-label" for="unknownOtherBusinessInfo">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                </div>
              </div>
            </div>
          </div>
          
          <button type="submit" class="btn btn-primary floating-save">
            <span class="loading" id="saveLoading" style="display: none;"></span>
            <span class="btn-icon">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</span>
          </button>
        </form>

        <!-- Analysis Result -->
        <div class="analysis-result" id="analysisResult" style="display: none;">
          <h3 class="analysis-title">üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
          <div class="analysis-grid">
            <div class="analysis-item">
              <div class="analysis-label">Risk Score</div>
              <div class="analysis-value" id="riskScore">-</div>
            </div>
            <div class="analysis-item">
              <div class="analysis-label">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</div>
              <div class="analysis-value" id="customerLevel">-</div>
            </div>
            <div class="analysis-item">
              <div class="analysis-label">‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</div>
              <div class="analysis-value" id="productRecommendations">-</div>
            </div>
            <div class="analysis-item">
              <div class="analysis-label">‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</div>
              <div class="analysis-value" id="suggestedAmount">-</div>
            </div>
          </div>
          <div style="text-align: center; margin-top: 2rem;">
            <button class="btn btn-secondary btn-icon" onclick="generatePDF()">üìÑ ‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
          </div>
        </div>
      </div>

      <!-- Coach Content -->
      <div class="main-content" id="coachContent" style="display: none;">
        <div class="search-section">
          <div class="search-header">
            <span style="font-size: 1.5rem;">üîç</span>
            <h3 class="search-title">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
          </div>
          <div class="search-controls">
            <input type="text" class="search-input" id="searchInput" placeholder="‡πÉ‡∏™‡πà Customer ID, ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô...">
            <button class="btn btn-primary btn-icon" onclick="searchCustomer()">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
          </div>
          <div class="filter-buttons">
            <button class="filter-btn active" onclick="filterByDate('all')">üìã ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            <button class="filter-btn" onclick="filterByDate('today')">üìÖ ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
            <button class="filter-btn" onclick="filterByDate('week')">üìä ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</button>
            <button class="filter-btn" onclick="filterByDate('month')">üìÜ ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button>
          </div>
        </div>
        <div id="searchResults"></div>
      </div>

      <!-- Admin Content -->
      <div class="main-content" id="adminContent" style="display: none;">
        <div class="admin-controls">
          <div class="admin-header">
            <span style="font-size: 1.5rem;">‚öôÔ∏è</span>
            <h3 class="admin-title">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3>
          </div>
          <div class="filter-section">
            <div class="filter-group">
              <label class="filter-label">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</label>
              <select class="form-select" id="adminDateFilter">
                <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                <option value="today">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</option>
                <option value="week">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</option>
                <option value="month">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</option>
                <option value="custom">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á</option>
              </select>
            </div>
            <div class="filter-group">
              <label class="filter-label">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á</label>
              <select class="form-select" id="adminRiskFilter">
                <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                <option value="Critical Risk">Critical Risk</option>
                <option value="Strategic Risk">Strategic Risk</option>
                <option value="Wealth & Lifestyle">Wealth & Lifestyle</option>
              </select>
            </div>
            <div class="filter-group">
              <label class="filter-label">Zone</label>
              <select class="form-select" id="adminZoneFilter">
                <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                <option value="ratchaburi">Zone ‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ</option>
                <option value="suratthani">Zone ‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ</option>
                <option value="hatyai">Zone ‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà</option>
                <option value="phuket">Zone ‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï</option>
                <option value="samutsakorn">Zone ‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£</option>
              </select>
            </div>
          </div>
          <div class="btn-group">
            <button class="btn btn-primary btn-icon" onclick="applyAdminFilters()">üìä ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</button>
            <button class="btn btn-outline btn-icon" onclick="exportToCSV()">üì§ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å CSV</button>
            <button class="btn btn-danger btn-icon" onclick="clearAllData()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
          </div>
        </div>
        <div id="adminResults"></div>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast" id="toast"></div>

  <script>
    // Global variables
    let currentRole = '';
    let selectedCustomerTypes = [];
    let allCustomers = [];
    let currentRecordCount = 0;
    let realEstateCount = 1;
    let vehicleCount = 1;
    let insuranceCount = 1;
    let childOccupationCount = 1;
    let currentFilter = 'all';

    // Default configuration
    const defaultConfig = {
      system_title: "Customer Coaching Support System",
      company_name: "TTB Bank"
    };

    // Welcome Screen Functionality
    document.addEventListener('DOMContentLoaded', function() {
      // Show welcome screen initially
      document.getElementById('welcomeScreen').style.display = 'flex';
      document.getElementById('mainApp').style.display = 'none';
      
      // Add event listener for enter button
      document.getElementById('enterButton').addEventListener('click', function() {
        enterSystem();
      });
    });

    function enterSystem() {
      const welcomeScreen = document.getElementById('welcomeScreen');
      const mainApp = document.getElementById('mainApp');
      
      // Add fade-out class to welcome screen
      welcomeScreen.classList.add('fade-out');
      
      // After animation completes, hide welcome and show main app
      setTimeout(() => {
        welcomeScreen.style.display = 'none';
        mainApp.style.display = 'block';
        
        // Add show class to main app with a slight delay
        setTimeout(() => {
          mainApp.classList.add('show');
          
          // Initialize the system
          initializeSystem();
        }, 100);
      }, 1000);
    }

    function initializeSystem() {
      initializeSDKs();
      setupEventListeners();
      generateCustomerId();
      updateProgress();
      
      // Load existing data
      loadExistingData();
    }

    // Data handler for SDK
    const dataHandler = {
      onDataChanged(data) {
        allCustomers = data;
        currentRecordCount = data.length;
        updateUI();
      }
    };

    // Initialize SDKs
    async function initializeSDKs() {
      try {
        if (window.dataSdk) {
          const result = await window.dataSdk.init(dataHandler);
          if (!result.isOk) {
            console.error("Failed to initialize data SDK");
          }
        }

        if (window.elementSdk) {
          await window.elementSdk.init({
            defaultConfig,
            render: async (config) => {
              document.getElementById('system-title').textContent = 
                config.system_title || defaultConfig.system_title;
              document.getElementById('company-name').textContent = 
                (config.company_name || defaultConfig.company_name) + " - ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤";
            },
            mapToCapabilities: (config) => ({
              recolorables: [],
              borderables: [],
              fontEditable: undefined,
              fontSizeable: undefined
            }),
            mapToEditPanelValues: (config) => new Map([
              ["system_title", config.system_title || defaultConfig.system_title],
              ["company_name", config.company_name || defaultConfig.company_name]
            ])
          });
        }
      } catch (error) {
        console.error("SDK initialization error:", error);
      }
    }

    function loadExistingData() {
      // Try to load from localStorage if SDK not available
      if (!window.dataSdk) {
        const storedData = localStorage.getItem('customerData');
        if (storedData) {
          allCustomers = JSON.parse(storedData);
          currentRecordCount = allCustomers.length;
          updateUI();
        }
      }
    }

    function updateUI() {
      if (currentRole === 'coach') {
        displaySearchResults(allCustomers);
      } else if (currentRole === 'admin') {
        displayAdminResults(allCustomers);
      }
    }

    function setupEventListeners() {
      // Role selection
      document.querySelectorAll('.role-card').forEach(card => {
        card.addEventListener('click', function() {
          selectRole(this.dataset.role);
        });
      });

      // Customer type selection
      document.querySelectorAll('.customer-type-card').forEach(card => {
        card.addEventListener('click', function() {
          const type = this.dataset.type;
          if (this.classList.contains('selected')) {
            this.classList.remove('selected');
            selectedCustomerTypes = selectedCustomerTypes.filter(t => t !== type);
          } else {
            // Only allow one selection
            document.querySelectorAll('.customer-type-card').forEach(c => {
              c.classList.remove('selected');
            });
            this.classList.add('selected');
            selectedCustomerTypes = [type];
          }
        });
      });

      // Form submission
      document.getElementById('customerForm').addEventListener('submit', function(e) {
        e.preventDefault();
        saveCustomerData();
      });

      // Input change listeners for progress tracking
      document.querySelectorAll('input, select').forEach(input => {
        input.addEventListener('change', updateProgress);
        input.addEventListener('input', updateProgress);
      });

      // Setup checkbox handlers
      setupCheckboxHandlers();
    }

    function setupCheckboxHandlers() {
      // Set up all checkbox handlers for unknown data
      document.querySelectorAll('.checkbox-input').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          const targetId = this.id.replace('unknown', '').replace(/\d+$/, '');
          const targetElement = document.getElementById(targetId);
          if (targetElement) {
            targetElement.disabled = this.checked;
            if (this.checked) {
              targetElement.value = '';
            }
          }
        });
      });
    }

    function selectRole(role) {
      currentRole = role;
      
      // Update UI
      document.querySelectorAll('.role-card').forEach(card => {
        card.classList.remove('active');
      });
      document.querySelector(`[data-role="${role}"]`).classList.add('active');
      
      // Show relevant content
      document.querySelectorAll('.main-content').forEach(content => {
        content.style.display = 'none';
      });
      
      const targetContent = document.getElementById(`${role}Content`);
      if (targetContent) {
        targetContent.style.display = 'block';
        setTimeout(() => {
          targetContent.classList.add('show');
        }, 10);
      }
      
      showToast(`‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏´‡∏°‡∏î: ${getRoleDisplayName(role)}`);
    }

    function getRoleDisplayName(role) {
      const roles = {
        'employee': '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≤‡∏¢',
        'coach': '‡∏ú‡∏π‡πâ‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤', 
        'admin': '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö'
      };
      return roles[role] || role;
    }

    function generateCustomerId() {
      const timestamp = new Date().getTime().toString().slice(-6);
      const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
      const customerId = `CUST${timestamp}${random}`;
      document.getElementById('customerId').value = customerId;
      return customerId;
    }

    function updateProgress() {
      const sections = document.querySelectorAll('.form-section');
      const filledSections = Array.from(sections).filter(section => {
        const inputs = section.querySelectorAll('input, select, textarea');
        return Array.from(inputs).some(input => {
          if (input.type === 'checkbox' || input.type === 'radio') {
            return input.checked;
          }
          return input.value && input.value.trim() !== '';
        });
      }).length;
      
      const progress = (filledSections / sections.length) * 100;
      document.getElementById('progressFill').style.width = `${progress}%`;
      
      // Update step indicators
      const steps = document.querySelectorAll('.step');
      steps.forEach((step, index) => {
        if (index < filledSections) {
          step.classList.add('active');
        } else {
          step.classList.remove('active');
        }
      });
    }

    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast';
      
      // Set color based on type
      if (type === 'error') {
        toast.style.background = 'var(--danger-color)';
      } else if (type === 'warning') {
        toast.style.background = 'var(--warning-color)';
      } else {
        toast.style.background = 'var(--success-color)';
      }
      
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // Dynamic form element functions
    function addRealEstate() {
      const container = document.getElementById('realEstateContainer');
      const newItem = createRealEstateItem(realEstateCount);
      container.appendChild(newItem);
      realEstateCount++;
      setupCheckboxHandlers();
    }

    function createRealEstateItem(index) {
      const newItem = document.createElement('div');
      newItem.className = 'real-estate-item';
      newItem.dataset.index = index;
      newItem.innerHTML = `
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
            <input type="text" class="form-input real-estate-type" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ö‡πâ‡∏≤‡∏ô, ‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î, ‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô">
            <div class="checkbox-group">
              <input type="checkbox" class="checkbox-input" id="unknownRealEstateType${index}">
              <label class="checkbox-label" for="unknownRealEstateType${index}">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ <span class="form-sublabel">(‡∏ö‡∏≤‡∏ó)</span></label>
            <input type="number" class="form-input real-estate-value" placeholder="0">
            <div class="checkbox-group">
              <input type="checkbox" class="checkbox-input" id="unknownRealEstateValue${index}">
              <label class="checkbox-label" for="unknownRealEstateValue${index}">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
            </div>
          </div>
        </div>
      `;
      return newItem;
    }

    function addVehicle() {
      const container = document.getElementById('vehicleContainer');
      const newItem = createVehicleItem(vehicleCount);
      container.appendChild(newItem);
      vehicleCount++;
      setupCheckboxHandlers();
    }

    function createVehicleItem(index) {
      const newItem = document.createElement('div');
      newItem.className = 'vehicle-item';
      newItem.dataset.index = index;
      newItem.innerHTML = `
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
            <input type="text" class="form-input vehicle-type" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå, ‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå">
            <div class="checkbox-group">
              <input type="checkbox" class="checkbox-input" id="unknownVehicleType${index}">
              <label class="checkbox-label" for="unknownVehicleType${index}">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ <span class="form-sublabel">(‡∏ö‡∏≤‡∏ó)</span></label>
            <input type="number" class="form-input vehicle-value" placeholder="0">
            <div class="checkbox-group">
              <input type="checkbox" class="checkbox-input" id="unknownVehicleValue${index}">
              <label class="checkbox-label" for="unknownVehicleValue${index}">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
            </div>
          </div>
        </div>
      `;
      return newItem;
    }

    function addInsurance() {
      const container = document.getElementById('insuranceContainer');
      const newItem = createInsuranceItem(insuranceCount);
      container.appendChild(newItem);
      insuranceCount++;
      setupCheckboxHandlers();
    }

    function createInsuranceItem(index) {
      const newItem = document.createElement('div');
      newItem.className = 'insurance-item';
      newItem.dataset.index = index;
      newItem.innerHTML = `
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á</label>
            <select class="form-select insurance-type">
              <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
              <option value="life">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</option>
              <option value="health">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</option>
              <option value="critical_illness">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÇ‡∏£‡∏Ñ‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á</option>
              <option value="accident">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏</option>
              <option value="disability">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏û‡∏û‡∏•‡∏†‡∏≤‡∏û</option>
              <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
            </select>
            <div class="checkbox-group">
              <input type="checkbox" class="checkbox-input" id="unknownInsuranceType${index}">
              <label class="checkbox-label" for="unknownInsuranceType${index}">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">‡∏ó‡∏∏‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô <span class="form-sublabel">(‡∏ö‡∏≤‡∏ó)</span></label>
            <input type="number" class="form-input insurance-amount" placeholder="0">
            <div class="checkbox-group">
              <input type="checkbox" class="checkbox-input" id="unknownInsuranceAmount${index}">
              <label class="checkbox-label" for="unknownInsuranceAmount${index}">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô/‡∏õ‡∏µ <span class="form-sublabel">(‡∏ö‡∏≤‡∏ó)</span></label>
            <input type="number" class="form-input insurance-premium" placeholder="0">
            <div class="checkbox-group">
              <input type="checkbox" class="checkbox-input" id="unknownInsurancePremium${index}">
              <label class="checkbox-label" for="unknownInsurancePremium${index}">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
            </div>
          </div>
        </div>
      `;
      return newItem;
    }

    function addChildOccupation() {
      const container = document.getElementById('childOccupationContainer');
      const newItem = createChildOccupationItem(childOccupationCount);
      container.appendChild(newItem);
      childOccupationCount++;
      setupCheckboxHandlers();
    }

    function createChildOccupationItem(index) {
      const newItem = document.createElement('div');
      newItem.className = 'child-occupation-item';
      newItem.dataset.index = index;
      newItem.innerHTML = `
        <div style="display: flex; gap: 1rem; align-items: start; margin-bottom: 1rem;">
          <div style="flex: 1;">
            <label class="form-label" style="font-size: 0.875rem;">‡∏ö‡∏∏‡∏ï‡∏£‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà ${index + 1} - ‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</label>
            <select class="form-select child-occupation">
              <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</option>
              <option value="student">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
              <option value="government">‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</option>
              <option value="business_owner">‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</option>
              <option value="employee">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</option>
              <option value="freelance">‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏≠‡∏¥‡∏™‡∏£‡∏∞</option>
              <option value="trader">‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≤‡∏¢</option>
              <option value="unemployed">‡∏ß‡πà‡∏≤‡∏á‡∏á‡∏≤‡∏ô</option>
              <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
            </select>
          </div>
          <div style="flex: 1;">
            <label class="form-label" style="font-size: 0.875rem;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
            <input type="text" class="form-input child-occupation-detail" placeholder="‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô/‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤">
          </div>
        </div>
        <div class="checkbox-group">
          <input type="checkbox" class="checkbox-input" id="unknownChildOccupation${index}">
          <label class="checkbox-label" for="unknownChildOccupation${index}">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•/‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
        </div>
      `;
      return newItem;
    }

    // Form data collection and analysis
    function collectFormData() {
      const formData = {
        customer_id: document.getElementById('customerId').value,
        employee_name: document.getElementById('employeeName').value,
        employee_zone: document.getElementById('employeeZone').value,
        customer_name: document.getElementById('customerName').value,
        customer_type: getCustomerTypeDisplayName(selectedCustomerTypes[0]),
        occupation: document.getElementById('occupation').value,
        occupation_detail: document.getElementById('occupationDetail').value,
        net_income: parseInt(document.getElementById('netIncome').value) || 0,
        savings: parseInt(document.getElementById('savings').value) || 0,
        bonds: parseInt(document.getElementById('bonds').value) || 0,
        funds: parseInt(document.getElementById('funds').value) || 0,
        credit_cards: parseInt(document.getElementById('creditCards').value) || 0,
        loans: parseInt(document.getElementById('loans').value) || 0,
        aum_ttb: parseInt(document.getElementById('aumTtb').value) || 0,
        aum_others: parseInt(document.getElementById('aumOthers').value) || 0,
        spouse_age: parseInt(document.getElementById('spouseAge').value) || 0,
        spouse_occupation: document.getElementById('spouseOccupation').value,
        spouse_occupation_detail: document.getElementById('spouseOccupationDetail').value,
        children_count: parseInt(document.getElementById('childrenCount').value) || 0,
        children_ages: document.getElementById('childrenAges').value,
        grandchildren_count: parseInt(document.getElementById('grandchildrenCount').value) || 0,
        other_people: document.getElementById('otherPeople').value,
        decision_maker: document.getElementById('decisionMaker').value,
        inheritance_style: document.querySelector('input[name="inheritanceStyle"]:checked')?.value || '',
        business_name: document.getElementById('businessName').value,
        business_type: document.getElementById('businessType').value,
        registered_capital: parseInt(document.getElementById('registeredCapital').value) || 0,
        business_income: parseInt(document.getElementById('businessIncome').value) || 0,
        net_profit: parseInt(document.getElementById('netProfit').value) || 0,
        tax: parseInt(document.getElementById('tax').value) || 0,
        shareholding: parseInt(document.getElementById('shareholding').value) || 0,
        shareholder_equity: parseInt(document.getElementById('shareholderEquity').value) || 0,
        other_business_info: document.getElementById('otherBusinessInfo').value,
        analysis_date: new Date().toISOString()
      };

      // Collect dynamic data
      formData.real_estate_summary = collectRealEstateData();
      formData.vehicle_summary = collectVehicleData();
      formData.insurance_summary = collectInsuranceData();
      formData.children_occupation_summary = collectChildOccupationData();

      return formData;
    }

    function getCustomerTypeDisplayName(type) {
      const types = {
        'goal_oriented': '‡πÄ‡∏õ‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå',
        'celebrity': '‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏î‡∏≤‡∏£‡∏≤',
        'analytical': '‡∏Ñ‡∏¥‡∏î‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì',
        'conservative': '‡∏ñ‡∏ô‡∏≠‡∏°‡∏à‡∏¥‡∏ï‡∏£'
      };
      return types[type] || type;
    }

    function collectRealEstateData() {
      const items = [];
      document.querySelectorAll('.real-estate-item').forEach(item => {
        const type = item.querySelector('.real-estate-type').value;
        const value = parseInt(item.querySelector('.real-estate-value').value) || 0;
        if (type || value > 0) {
          items.push({ type, value });
        }
      });
      return JSON.stringify(items);
    }

    function collectVehicleData() {
      const items = [];
      document.querySelectorAll('.vehicle-item').forEach(item => {
        const type = item.querySelector('.vehicle-type').value;
        const value = parseInt(item.querySelector('.vehicle-value').value) || 0;
        if (type || value > 0) {
          items.push({ type, value });
        }
      });
      return JSON.stringify(items);
    }

    function collectInsuranceData() {
      const items = [];
      document.querySelectorAll('.insurance-item').forEach(item => {
        const type = item.querySelector('.insurance-type').value;
        const amount = parseInt(item.querySelector('.insurance-amount').value) || 0;
        const premium = parseInt(item.querySelector('.insurance-premium').value) || 0;
        if (type || amount > 0 || premium > 0) {
          items.push({ type, amount, premium });
        }
      });
      return JSON.stringify(items);
    }

    function collectChildOccupationData() {
      const items = [];
      document.querySelectorAll('.child-occupation-item').forEach((item, index) => {
        const occupation = item.querySelector('.child-occupation').value;
        const detail = item.querySelector('.child-occupation-detail').value;
        if (occupation || detail) {
          items.push({ 
            child_number: index + 1,
            occupation, 
            detail 
          });
        }
      });
      return JSON.stringify(items);
    }

    async function saveCustomerData() {
      const saveButton = document.querySelector('.floating-save');
      const loading = document.getElementById('saveLoading');
      
      saveButton.disabled = true;
      loading.style.display = 'inline-block';
      
      try {
        const formData = collectFormData();
        
        // Perform analysis
        const analysis = analyzeCustomerData(formData);
        formData.risk_score = analysis.riskScore;
        formData.customer_level = analysis.customerLevel;
        formData.product_recommendations = analysis.productRecommendations;
        formData.suggested_amount = analysis.suggestedAmount;
        
        // Save to SDK
        if (window.dataSdk) {
          const result = await window.dataSdk.save(formData);
          if (result.isOk) {
            showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üìä');
            displayAnalysisResult(analysis);
            
            // Add to local array
            allCustomers.push({ ...formData, __backendId: result.data.id });
            currentRecordCount++;
          } else {
            throw new Error('Failed to save data');
          }
        } else {
          // Fallback: Save to localStorage
          const customers = JSON.parse(localStorage.getItem('customerData') || '[]');
          customers.push({ ...formData, id: Date.now().toString() });
          localStorage.setItem('customerData', JSON.stringify(customers));
          
          showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß)');
          displayAnalysisResult(analysis);
          
          allCustomers = customers;
          currentRecordCount = customers.length;
        }
        
      } catch (error) {
        console.error('Save error:', error);
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
      } finally {
        saveButton.disabled = false;
        loading.style.display = 'none';
      }
    }

    function analyzeCustomerData(data) {
      // Simplified analysis logic
      let riskScore = 50; // Base score
      
      // Adjust based on income
      if (data.net_income > 1000000) riskScore += 20;
      else if (data.net_income > 500000) riskScore += 10;
      
      // Adjust based on assets
      const totalAssets = data.savings + data.bonds + data.funds + data.aum_ttb + data.aum_others;
      if (totalAssets > 5000000) riskScore += 15;
      else if (totalAssets > 1000000) riskScore += 5;
      
      // Adjust based on liabilities
      const totalLiabilities = data.loans + (data.credit_cards * 0.1);
      if (totalLiabilities > data.net_income * 2) riskScore -= 20;
      else if (totalLiabilities > data.net_income) riskScore -= 10;
      
      // Ensure score is within bounds
      riskScore = Math.max(0, Math.min(100, riskScore));
      
      // Determine customer level
      let customerLevel, productRecommendations, suggestedAmount;
      
      if (riskScore >= 70) {
        customerLevel = 'Critical Risk';
        productRecommendations = '‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÅ‡∏ö‡∏ö‡∏™‡∏∞‡∏™‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå, ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°‡∏ú‡∏™‡∏°, ‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô';
        suggestedAmount = '1,000,000 - 5,000,000 ‡∏ö‡∏≤‡∏ó';
      } else if (riskScore >= 40) {
        customerLevel = 'Strategic Risk';
        productRecommendations = '‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û, ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏ï‡∏£‡∏≤‡∏™‡∏≤‡∏£‡∏´‡∏ô‡∏µ‡πâ, ‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï';
        suggestedAmount = '500,000 - 1,000,000 ‡∏ö‡∏≤‡∏ó';
      } else {
        customerLevel = 'Wealth & Lifestyle';
        productRecommendations = '‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏≠‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå, ‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ä‡∏µ‡∏û, ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏';
        suggestedAmount = '100,000 - 500,000 ‡∏ö‡∏≤‡∏ó';
      }
      
      return {
        riskScore,
        customerLevel,
        productRecommendations,
        suggestedAmount
      };
    }

    function displayAnalysisResult(analysis) {
      document.getElementById('riskScore').textContent = `${analysis.riskScore}/100`;
      document.getElementById('customerLevel').textContent = analysis.customerLevel;
      document.getElementById('productRecommendations').textContent = analysis.productRecommendations;
      document.getElementById('suggestedAmount').textContent = analysis.suggestedAmount;
      
      const resultSection = document.getElementById('analysisResult');
      resultSection.style.display = 'block';
      resultSection.scrollIntoView({ behavior: 'smooth' });
    }

    function generatePDF() {
      // Simple PDF generation using jsPDF
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      doc.setFontSize(20);
      doc.text('‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', 20, 20);
      
      doc.setFontSize(12);
      doc.text(`Customer ID: ${document.getElementById('customerId').value}`, 20, 40);
      doc.text(`‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${document.getElementById('customerName').value}`, 20, 50);
      doc.text(`Risk Score: ${document.getElementById('riskScore').textContent}`, 20, 60);
      doc.text(`‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${document.getElementById('customerLevel').textContent}`, 20, 70);
      doc.text(`‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ${document.getElementById('productRecommendations').textContent}`, 20, 80);
      doc.text(`‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ${document.getElementById('suggestedAmount').textContent}`, 20, 90);
      
      doc.save(`customer-report-${document.getElementById('customerId').value}.pdf`);
      showToast('‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
    }

    // Employee Search Functions
    function searchExistingCustomer() {
      const searchTerm = document.getElementById('employeeSearchInput').value.trim();
      
      if (!searchTerm) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Customer ID', 'warning');
        return;
      }

      const customer = allCustomers.find(c => 
        c.customer_id && c.customer_id.toLowerCase() === searchTerm.toLowerCase()
      );

      if (!customer) {
        showToast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ID: ' + searchTerm, 'warning');
        document.getElementById('searchResultContainer').style.display = 'none';
        return;
      }

      displaySearchResult(customer);
    }

    function displaySearchResult(customer) {
      const container = document.getElementById('searchResultContainer');
      
      const levelClass = customer.customer_level === 'Critical Risk' ? 'level-critical' :
                       customer.customer_level === 'Strategic Risk' ? 'level-strategic' : 'level-wealth';

      container.innerHTML = `
        <div class="customer-card" style="border-left: 4px solid var(--success-color);">
          <div class="customer-header">
            <div>
              <div class="customer-name">‚úÖ ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${customer.customer_name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠'}</div>
              <div class="customer-meta">
                ID: ${customer.customer_id || 'N/A'} | 
                ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô: ${customer.employee_name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'} | 
                Zone: ${getZoneDisplayName(customer.employee_zone)} |
                ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: ${customer.analysis_date ? new Date(customer.analysis_date).toLocaleDateString('th-TH') : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
              </div>
            </div>
            <div class="customer-level ${levelClass}">
              ${customer.customer_level || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
            </div>
          </div>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
            <div>
              <strong>Risk Score:</strong> ${customer.risk_score || 0}/100
            </div>
            <div>
              <strong>‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> ${customer.customer_type || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
            </div>
            <div>
              <strong>‡∏≠‡∏≤‡∏ä‡∏µ‡∏û:</strong> ${customer.occupation || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
            </div>
            <div>
              <strong>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ/‡∏õ‡∏µ:</strong> ${customer.net_income ? new Intl.NumberFormat('th-TH').format(customer.net_income) + ' ‡∏ö‡∏≤‡∏ó' : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
            </div>
          </div>
          
          <div style="background: var(--background-color); padding: 1rem; border-radius: var(--radius-md); margin-bottom: 1rem;">
            <strong>‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ${customer.product_recommendations || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}
          </div>

          <!-- Coach Comments Section -->
          <div id="coachCommentsSection" style="background: rgba(52, 199, 89, 0.1); padding: 1rem; border-radius: var(--radius-md); margin-bottom: 1rem; border: 1px solid rgba(52, 199, 89, 0.2);">
            <h5 style="color: var(--accent-color); margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;">
              üí¨ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏à‡∏≤‡∏Å Coach
            </h5>
            <div id="customerComments">
              <div style="text-align: center; padding: 1rem; color: var(--text-muted); font-style: italic;">
                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏à‡∏≤‡∏Å Coach ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏ô‡∏µ‡πâ
              </div>
            </div>
          </div>
          
          <div style="display: flex; gap: 0.5rem; justify-content: flex-end; flex-wrap: wrap;">
            <button class="btn btn-sm btn-outline glass-btn" onclick="viewFullCustomerDetail('${customer.id || customer.__backendId}')">
              üëÅÔ∏è ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏ï‡πá‡∏°
            </button>
            <button class="btn btn-sm btn-secondary glass-btn" onclick="loadCustomerForEdit('${customer.id || customer.__backendId}')">
              ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            </button>
            <button class="btn btn-sm btn-primary glass-btn" onclick="generateCustomerPDF('${customer.id || customer.__backendId}')">
              üìÑ ‡∏™‡∏£‡πâ‡∏≤‡∏á PDF
            </button>
          </div>
        </div>
      `;
      
      container.style.display = 'block';
      
      // Load coach comments (demo data for now)
      loadCoachComments(customer.customer_id);
    }

    function loadCoachComments(customerId) {
      // Demo coach comments - in real system, this would fetch from database
      const demoComments = [
        {
          id: 1,
          type: 'recommendation',
          content: '‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡∏Å‡∏≤‡∏£',
          author: 'Coach ‡∏™‡∏°‡∏ä‡∏≤‡∏¢',
          date: '2024-01-15T10:30:00Z'
        },
        {
          id: 2,
          type: 'follow_up',
          content: '‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÅ‡∏ú‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏ô‡πÉ‡∏à‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß',
          author: 'Coach ‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á',
          date: '2024-01-20T14:15:00Z'
        }
      ];

      const commentsContainer = document.getElementById('customerComments');
      
      if (demoComments.length > 0) {
        const commentsHtml = demoComments.map(comment => `
          <div style="background: var(--surface-color); border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: 1rem; margin-bottom: 0.5rem; border-left: 3px solid var(--accent-color);">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
              <div>
                <span class="comment-type-badge ${comment.type}">${getCommentTypeIcon(comment.type)} ${getCommentTypeLabel(comment.type)}</span>
              </div>
              <div style="font-size: 0.75rem; color: var(--text-muted);">
                ${comment.author} ‚Ä¢ ${new Date(comment.date).toLocaleDateString('th-TH')}
              </div>
            </div>
            <div style="line-height: 1.5; color: var(--text-primary); font-size: 0.875rem;">
              ${comment.content}
            </div>
          </div>
        `).join('');
        
        commentsContainer.innerHTML = commentsHtml;
      }
    }

    function clearSearch() {
      document.getElementById('employeeSearchInput').value = '';
      document.getElementById('searchResultContainer').style.display = 'none';
    }

    function viewFullCustomerDetail(customerId) {
      const customer = allCustomers.find(c => 
        c.id === customerId || c.__backendId === customerId
      );
      if (!customer) {
        showToast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', 'error');
        return;
      }
      showCustomerDetailModal(customer);
    }

    function loadCustomerForEdit(customerId) {
      const customer = allCustomers.find(c => 
        c.id === customerId || c.__backendId === customerId
      );
      if (!customer) {
        showToast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', 'error');
        return;
      }

      // Show confirmation modal
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      
      modal.innerHTML = `
        <div class="modal-content">
          <h3 class="modal-title">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
          <div class="modal-message">
            <p style="margin: 0; font-size: 1rem; color: var(--text-primary);">
              ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á <strong>${customer.customer_name || customer.customer_id}</strong> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?
            </p>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.875rem; color: var(--text-muted);">
              ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏•‡∏á‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ
            </p>
          </div>
          <div class="modal-buttons">
            <button class="btn btn-secondary glass-btn" onclick="this.closest('.modal-overlay').remove()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button class="btn btn-primary glass-btn" onclick="confirmLoadCustomer('${customerId}', this)">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    function confirmLoadCustomer(customerId, button) {
      const customer = allCustomers.find(c => 
        c.id === customerId || c.__backendId === customerId
      );
      if (!customer) return;

      // Clear search results
      clearSearch();

      // Populate form with customer data
      populateFormWithCustomerData(customer);
      
      // Close modal
      button.closest('.modal-overlay').remove();
      
      // Scroll to form
      document.getElementById('customerForm').scrollIntoView({ behavior: 'smooth' });
      
      showToast('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ ‚úèÔ∏è');
    }

    function populateFormWithCustomerData(customer) {
      // Basic Information
      document.getElementById('customerId').value = customer.customer_id || '';
      document.getElementById('employeeName').value = customer.employee_name || '';
      document.getElementById('employeeZone').value = customer.employee_zone || '';
      document.getElementById('customerName').value = customer.customer_name || '';

      // Customer Type
      if (customer.customer_type) {
        const customerTypes = {
          '‡πÄ‡∏õ‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå': 'goal_oriented',
          '‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏î‡∏≤‡∏£‡∏≤': 'celebrity', 
          '‡∏Ñ‡∏¥‡∏î‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì': 'analytical',
          '‡∏ñ‡∏ô‡∏≠‡∏°‡∏à‡∏¥‡∏ï‡∏£': 'conservative'
        };
        
        // Clear previous selections
        document.querySelectorAll('.customer-type-card').forEach(card => {
          card.classList.remove('selected');
        });
        selectedCustomerTypes = [];

        // Find and select the matching type
        Object.entries(customerTypes).forEach(([thai, english]) => {
          if (customer.customer_type.includes(thai)) {
            const card = document.querySelector(`[data-type="${english}"]`);
            if (card) {
              card.classList.add('selected');
              selectedCustomerTypes.push(english);
            }
          }
        });
      }

      // Personal Information
      document.getElementById('occupation').value = customer.occupation || '';
      document.getElementById('occupationDetail').value = customer.occupation_detail || '';
      document.getElementById('netIncome').value = customer.net_income || '';
      document.getElementById('savings').value = customer.savings || '';
      document.getElementById('bonds').value = customer.bonds || '';
      document.getElementById('funds').value = customer.funds || '';
      document.getElementById('creditCards').value = customer.credit_cards || '';
      document.getElementById('loans').value = customer.loans || '';
      document.getElementById('aumTtb').value = customer.aum_ttb || '';
      document.getElementById('aumOthers').value = customer.aum_others || '';

      // Family Information
      document.getElementById('spouseAge').value = customer.spouse_age || '';
      document.getElementById('spouseOccupation').value = customer.spouse_occupation || '';
      document.getElementById('spouseOccupationDetail').value = customer.spouse_occupation_detail || '';
      document.getElementById('childrenCount').value = customer.children_count || '';
      document.getElementById('childrenAges').value = customer.children_ages || '';
      document.getElementById('grandchildrenCount').value = customer.grandchildren_count || '';
      document.getElementById('otherPeople').value = customer.other_people || '';
      document.getElementById('decisionMaker').value = customer.decision_maker || '';

      // Inheritance style radio buttons
      if (customer.inheritance_style) {
        const radio = document.querySelector(`input[name="inheritanceStyle"][value="${customer.inheritance_style}"]`);
        if (radio) radio.checked = true;
      }

      // Business Information
      document.getElementById('businessName').value = customer.business_name || '';
      document.getElementById('businessType').value = customer.business_type || '';
      document.getElementById('registeredCapital').value = customer.registered_capital || '';
      document.getElementById('businessIncome').value = customer.business_income || '';
      document.getElementById('netProfit').value = customer.net_profit || '';
      document.getElementById('tax').value = customer.tax || '';
      document.getElementById('shareholding').value = customer.shareholding || '';
      document.getElementById('shareholderEquity').value = customer.shareholder_equity || '';
      document.getElementById('otherBusinessInfo').value = customer.other_business_info || '';

      // Complex data - Real Estate
      if (customer.real_estate_summary) {
        try {
          const realEstateData = JSON.parse(customer.real_estate_summary);
          populateRealEstateData(realEstateData);
        } catch (e) {
          console.error('Error parsing real estate data:', e);
        }
      }

      // Complex data - Vehicles
      if (customer.vehicle_summary) {
        try {
          const vehicleData = JSON.parse(customer.vehicle_summary);
          populateVehicleData(vehicleData);
        } catch (e) {
          console.error('Error parsing vehicle data:', e);
        }
      }

      // Complex data - Insurance
      if (customer.insurance_summary) {
        try {
          const insuranceData = JSON.parse(customer.insurance_summary);
          populateInsuranceData(insuranceData);
        } catch (e) {
          console.error('Error parsing insurance data:', e);
        }
      }

      // Complex data - Children Occupation
      if (customer.children_occupation_summary) {
        try {
          const childOccupationData = JSON.parse(customer.children_occupation_summary);
          populateChildOccupationData(childOccupationData);
        } catch (e) {
          console.error('Error parsing child occupation data:', e);
        }
      }

      // Update progress
      updateProgress();
    }

    function populateRealEstateData(data) {
      const container = document.getElementById('realEstateContainer');
      container.innerHTML = ''; // Clear existing
      
      data.forEach((item, index) => {
        if (index === 0) {
          // Create first item
          const firstItem = createRealEstateItem(0);
          container.appendChild(firstItem);
          const typeInput = firstItem.querySelector('.real-estate-type');
          const valueInput = firstItem.querySelector('.real-estate-value');
          if (typeInput) typeInput.value = item.type || '';
          if (valueInput) valueInput.value = item.value || '';
        } else {
          // Add new items
          addRealEstate();
          const newItem = container.lastElementChild;
          const typeInput = newItem.querySelector('.real-estate-type');
          const valueInput = newItem.querySelector('.real-estate-value');
          if (typeInput) typeInput.value = item.type || '';
          if (valueInput) valueInput.value = item.value || '';
        }
      });
    }

    function populateVehicleData(data) {
      const container = document.getElementById('vehicleContainer');
      container.innerHTML = ''; // Clear existing
      
      data.forEach((item, index) => {
        if (index === 0) {
          // Create first item
          const firstItem = createVehicleItem(0);
          container.appendChild(firstItem);
          const typeInput = firstItem.querySelector('.vehicle-type');
          const valueInput = firstItem.querySelector('.vehicle-value');
          if (typeInput) typeInput.value = item.type || '';
          if (valueInput) valueInput.value = item.value || '';
        } else {
          // Add new items
          addVehicle();
          const newItem = container.lastElementChild;
          const typeInput = newItem.querySelector('.vehicle-type');
          const valueInput = newItem.querySelector('.vehicle-value');
          if (typeInput) typeInput.value = item.type || '';
          if (valueInput) valueInput.value = item.value || '';
        }
      });
    }

    function populateInsuranceData(data) {
      const container = document.getElementById('insuranceContainer');
      container.innerHTML = ''; // Clear existing
      
      data.forEach((item, index) => {
        if (index === 0) {
          // Create first item
          const firstItem = createInsuranceItem(0);
          container.appendChild(firstItem);
          const typeSelect = firstItem.querySelector('.insurance-type');
          const amountInput = firstItem.querySelector('.insurance-amount');
          const premiumInput = firstItem.querySelector('.insurance-premium');
          if (typeSelect) typeSelect.value = item.type || '';
          if (amountInput) amountInput.value = item.amount || '';
          if (premiumInput) premiumInput.value = item.premium || '';
        } else {
          // Add new items
          addInsurance();
          const newItem = container.lastElementChild;
          const typeSelect = newItem.querySelector('.insurance-type');
          const amountInput = newItem.querySelector('.insurance-amount');
          const premiumInput = newItem.querySelector('.insurance-premium');
          if (typeSelect) typeSelect.value = item.type || '';
          if (amountInput) amountInput.value = item.amount || '';
          if (premiumInput) premiumInput.value = item.premium || '';
        }
      });
    }

    function populateChildOccupationData(data) {
      const container = document.getElementById('childOccupationContainer');
      container.innerHTML = ''; // Clear existing
      
      data.forEach((item, index) => {
        if (index === 0) {
          // Create first item
          const firstItem = createChildOccupationItem(0);
          container.appendChild(firstItem);
          const occupationSelect = firstItem.querySelector('.child-occupation');
          const detailInput = firstItem.querySelector('.child-occupation-detail');
          if (occupationSelect) occupationSelect.value = item.occupation || '';
          if (detailInput) detailInput.value = item.detail || '';
        } else {
          // Add new items
          addChildOccupation();
          const newItem = container.lastElementChild;
          const occupationSelect = newItem.querySelector('.child-occupation');
          const detailInput = newItem.querySelector('.child-occupation-detail');
          if (occupationSelect) occupationSelect.value = item.occupation || '';
          if (detailInput) detailInput.value = item.detail || '';
        }
      });
    }

    function generateCustomerPDF(customerId) {
      const customer = allCustomers.find(c => 
        c.id === customerId || c.__backendId === customerId
      );
      if (!customer) {
        showToast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', 'error');
        return;
      }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      doc.setFontSize(20);
      doc.text('‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', 20, 20);
      
      doc.setFontSize(12);
      doc.text(`Customer ID: ${customer.customer_id}`, 20, 40);
      doc.text(`‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${customer.customer_name}`, 20, 50);
      doc.text(`‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô: ${customer.employee_name}`, 20, 60);
      doc.text(`Zone: ${getZoneDisplayName(customer.employee_zone)}`, 20, 70);
      doc.text(`Risk Score: ${customer.risk_score}/100`, 20, 80);
      doc.text(`‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${customer.customer_level}`, 20, 90);
      doc.text(`‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ${customer.product_recommendations}`, 20, 100);
      doc.text(`‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ${customer.suggested_amount}`, 20, 110);
      doc.text(`‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå: ${new Date(customer.analysis_date).toLocaleDateString('th-TH')}`, 20, 120);
      
      doc.save(`customer-report-${customer.customer_id}.pdf`);
      showToast('‡∏™‡∏£‡πâ‡∏≤‡∏á PDF ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
    }

    function showCustomerDetailModal(customer) {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      
      const levelClass = customer.customer_level === 'Critical Risk' ? 'level-critical' :
                       customer.customer_level === 'Strategic Risk' ? 'level-strategic' : 'level-wealth';
      
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 600px; text-align: left;">
          <h3 class="modal-title">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
          <div class="modal-message">
            <div style="margin-bottom: 1rem;">
              <strong>Customer ID:</strong> ${customer.customer_id || 'N/A'}
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> ${customer.customer_name || 'N/A'}
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô:</strong> ${customer.employee_name || 'N/A'}
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>Zone:</strong> ${getZoneDisplayName(customer.employee_zone)}
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> ${customer.customer_type || 'N/A'}
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>‡∏≠‡∏≤‡∏ä‡∏µ‡∏û:</strong> ${customer.occupation || 'N/A'}
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ/‡∏õ‡∏µ:</strong> ${customer.net_income ? new Intl.NumberFormat('th-TH').format(customer.net_income) + ' ‡∏ö‡∏≤‡∏ó' : 'N/A'}
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>Risk Score:</strong> ${customer.risk_score || 0}/100
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> <span class="customer-level ${levelClass}">${customer.customer_level || 'N/A'}</span>
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ${customer.product_recommendations || 'N/A'}
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ${customer.suggested_amount || 'N/A'}
            </div>
            <div>
              <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:</strong> ${customer.analysis_date ? new Date(customer.analysis_date).toLocaleDateString('th-TH') : 'N/A'}
            </div>
          </div>
          <div class="modal-buttons">
            <button class="btn btn-primary glass-btn" onclick="this.closest('.modal-overlay').remove()">‡∏õ‡∏¥‡∏î</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    // Coach Functions
    function searchCustomer() {
      const searchTerm = document.getElementById('searchInput').value.trim();
      
      if (!searchTerm) {
        // Show all customers if no search term
        displaySearchResults(allCustomers);
        return;
      }

      const filteredCustomers = allCustomers.filter(customer => 
        customer.customer_id?.toLowerCase().includes(searchTerm.toLowerCase()) ||
        customer.customer_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
        customer.employee_name?.toLowerCase().includes(searchTerm.toLowerCase())
      );

      displaySearchResults(filteredCustomers);
    }

    function displaySearchResults(customers) {
      const container = document.getElementById('searchResults');
      
      if (customers.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üîç</div>
            <h3 style="margin-bottom: 0.5rem;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
            <p>‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á</p>
          </div>
        `;
        return;
      }

      const customersHtml = customers.map(customer => {
        const levelClass = customer.customer_level === 'Critical Risk' ? 'level-critical' :
                         customer.customer_level === 'Strategic Risk' ? 'level-strategic' : 'level-wealth';
        
        return `
          <div class="customer-card">
            <div class="customer-header">
              <div>
                <div class="customer-name">${customer.customer_name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠'}</div>
                <div class="customer-meta">
                  ID: ${customer.customer_id || 'N/A'} | 
                  ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô: ${customer.employee_name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'} | 
                  Zone: ${getZoneDisplayName(customer.employee_zone)} |
                  ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: ${customer.analysis_date ? new Date(customer.analysis_date).toLocaleDateString('th-TH') : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
                </div>
              </div>
              <div class="customer-level ${levelClass}">
                ${customer.customer_level || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
              </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
              <div>
                <strong>Risk Score:</strong> ${customer.risk_score || 0}/100
              </div>
              <div>
                <strong>‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> ${customer.customer_type || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
              </div>
              <div>
                <strong>‡∏≠‡∏≤‡∏ä‡∏µ‡∏û:</strong> ${customer.occupation || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
              </div>
              <div>
                <strong>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ/‡∏õ‡∏µ:</strong> ${customer.net_income ? new Intl.NumberFormat('th-TH').format(customer.net_income) + ' ‡∏ö‡∏≤‡∏ó' : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}
              </div>
            </div>
            
            <div style="background: var(--background-color); padding: 1rem; border-radius: var(--radius-md); margin-bottom: 1rem;">
              <strong>‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ${customer.product_recommendations || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}
            </div>
            
            <div style="display: flex; gap: 0.5rem; justify-content: flex-end; flex-wrap: wrap;">
              <button class="btn btn-sm btn-outline glass-btn" onclick="viewFullCustomerDetail('${customer.id || customer.__backendId}')">
                üëÅÔ∏è ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
              </button>
              <button class="btn btn-sm btn-primary glass-btn" onclick="addCoachComment('${customer.id || customer.__backendId}')">
                üí¨ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô
              </button>
              <button class="btn btn-sm btn-secondary glass-btn" onclick="generateCustomerPDF('${customer.id || customer.__backendId}')">
                üìÑ ‡∏™‡∏£‡πâ‡∏≤‡∏á PDF
              </button>
            </div>
          </div>
        `;
      }).join('');
      
      container.innerHTML = customersHtml;
    }

    function filterByDate(filter) {
      currentFilter = filter;
      
      // Update active filter button
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      let filteredCustomers = [...allCustomers];
      
      const now = new Date();
      
      if (filter === 'today') {
        filteredCustomers = allCustomers.filter(customer => {
          if (!customer.analysis_date) return false;
          const customerDate = new Date(customer.analysis_date);
          return customerDate.toDateString() === now.toDateString();
        });
      } else if (filter === 'week') {
        const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
        filteredCustomers = allCustomers.filter(customer => {
          if (!customer.analysis_date) return false;
          const customerDate = new Date(customer.analysis_date);
          return customerDate >= weekAgo;
        });
      } else if (filter === 'month') {
        const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
        filteredCustomers = allCustomers.filter(customer => {
          if (!customer.analysis_date) return false;
          const customerDate = new Date(customer.analysis_date);
          return customerDate >= monthAgo;
        });
      }
      
      displaySearchResults(filteredCustomers);
    }

    function addCoachComment(customerId) {
      const customer = allCustomers.find(c => 
        c.id === customerId || c.__backendId === customerId
      );
      if (!customer) {
        showToast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', 'error');
        return;
      }

      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 500px;">
          <h3 class="modal-title">üí¨ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
          <div class="modal-message">
            <p style="margin: 0; font-size: 1rem; color: var(--text-primary);">
              ${customer.customer_name || customer.customer_id}
            </p>
          </div>
          
          <div style="margin-bottom: 1.5rem; text-align: left;">
            <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô</label>
            <select class="form-select" id="commentType" style="width: 100%;">
              <option value="general">‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
              <option value="recommendation">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</option>
              <option value="follow_up">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•</option>
              <option value="concern">‡∏Ç‡πâ‡∏≠‡∏Å‡∏±‡∏á‡∏ß‡∏•</option>
              <option value="opportunity">‡πÇ‡∏≠‡∏Å‡∏≤‡∏™</option>
            </select>
          </div>
          
          <div style="margin-bottom: 1.5rem; text-align: left;">
            <label class="form-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô</label>
            <textarea class="form-input" id="commentContent" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..." style="width: 100%; height: 120px; resize: vertical;"></textarea>
          </div>
          
          <div class="modal-buttons">
            <button class="btn btn-secondary glass-btn" onclick="this.closest('.modal-overlay').remove()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button class="btn btn-primary glass-btn" onclick="saveCoachComment('${customerId}', this)">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    function saveCoachComment(customerId, button) {
      const commentType = document.getElementById('commentType').value;
      const commentContent = document.getElementById('commentContent').value.trim();
      
      if (!commentContent) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô', 'warning');
        return;
      }
      
      // In a real system, this would save to the database
      // For now, we'll just show a success message
      button.closest('.modal-overlay').remove();
      showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
    }

    // Admin Functions
    function applyAdminFilters() {
      const dateFilter = document.getElementById('adminDateFilter').value;
      const riskFilter = document.getElementById('adminRiskFilter').value;
      const zoneFilter = document.getElementById('adminZoneFilter').value;
      
      let filteredCustomers = [...allCustomers];
      
      // Apply date filter
      if (dateFilter !== 'all') {
        const now = new Date();
        
        if (dateFilter === 'today') {
          filteredCustomers = filteredCustomers.filter(customer => {
            if (!customer.analysis_date) return false;
            const customerDate = new Date(customer.analysis_date);
            return customerDate.toDateString() === now.toDateString();
          });
        } else if (dateFilter === 'week') {
          const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
          filteredCustomers = filteredCustomers.filter(customer => {
            if (!customer.analysis_date) return false;
            const customerDate = new Date(customer.analysis_date);
            return customerDate >= weekAgo;
          });
        } else if (dateFilter === 'month') {
          const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
          filteredCustomers = filteredCustomers.filter(customer => {
            if (!customer.analysis_date) return false;
            const customerDate = new Date(customer.analysis_date);
            return customerDate >= monthAgo;
          });
        }
      }
      
      // Apply risk filter
      if (riskFilter !== 'all') {
        filteredCustomers = filteredCustomers.filter(customer => 
          customer.customer_level === riskFilter
        );
      }
      
      // Apply zone filter
      if (zoneFilter !== 'all') {
        filteredCustomers = filteredCustomers.filter(customer => 
          customer.employee_zone === zoneFilter
        );
      }
      
      displayAdminResults(filteredCustomers);
    }

    function displayAdminResults(customers) {
      const container = document.getElementById('adminResults');
      
      if (customers.length === 0) {
        container.innerHTML = `
          <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üìä</div>
            <h3 style="margin-bottom: 0.5rem;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</h3>
            <p>‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á</p>
          </div>
        `;
        return;
      }

      // Calculate statistics
      const criticalCount = customers.filter(c => c.customer_level === 'Critical Risk').length;
      const strategicCount = customers.filter(c => c.customer_level === 'Strategic Risk').length;
      const wealthCount = customers.filter(c => c.customer_level === 'Wealth & Lifestyle').length;
      
      const totalIncome = customers.reduce((sum, customer) => sum + (customer.net_income || 0), 0);
      const avgIncome = customers.length > 0 ? totalIncome / customers.length : 0;
      
      const statsHtml = `
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-number">${customers.length}</div>
            <div class="stat-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${criticalCount}</div>
            <div class="stat-label">Critical Risk</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${strategicCount}</div>
            <div class="stat-label">Strategic Risk</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${wealthCount}</div>
            <div class="stat-label">Wealth & Lifestyle</div>
          </div>
          <div class="stat-card">
            <div class="stat-number">${new Intl.NumberFormat('th-TH').format(Math.round(avgIncome))}</div>
            <div class="stat-label">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏õ‡∏µ</div>
          </div>
        </div>
      `;
      
      const tableHtml = `
        <div style="margin-top: 2rem; overflow-x: auto;">
          <table class="data-table">
            <thead>
              <tr>
                <th>Customer ID</th>
                <th>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                <th>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</th>
                <th>Zone</th>
                <th>Risk Score</th>
                <th>‡∏£‡∏∞‡∏î‡∏±‡∏ö</th>
                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</th>
                <th>‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
              </tr>
            </thead>
            <tbody>
              ${customers.map(customer => {
                const levelClass = customer.customer_level === 'Critical Risk' ? 'level-critical' :
                                 customer.customer_level === 'Strategic Risk' ? 'level-strategic' : 'level-wealth';
                
                return `
                  <tr>
                    <td>${customer.customer_id || 'N/A'}</td>
                    <td>${customer.customer_name || 'N/A'}</td>
                    <td>${customer.employee_name || 'N/A'}</td>
                    <td>${getZoneDisplayName(customer.employee_zone)}</td>
                    <td>${customer.risk_score || 0}/100</td>
                    <td><span class="customer-level ${levelClass}">${customer.customer_level || 'N/A'}</span></td>
                    <td>${customer.analysis_date ? new Date(customer.analysis_date).toLocaleDateString('th-TH') : 'N/A'}</td>
                    <td>
                      <div class="btn-group">
                        <button class="btn btn-sm btn-outline" onclick="viewFullCustomerDetail('${customer.id || customer.__backendId}')">‡∏î‡∏π</button>
                        <button class="btn btn-sm btn-secondary" onclick="generateCustomerPDF('${customer.id || customer.__backendId}')">PDF</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteCustomer('${customer.id || customer.__backendId}')">‡∏•‡∏ö</button>
                      </div>
                    </td>
                  </tr>
                `;
              }).join('')}
            </tbody>
          </table>
        </div>
      `;
      
      container.innerHTML = statsHtml + tableHtml;
    }

    function exportToCSV() {
      if (allCustomers.length === 0) {
        showToast('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å', 'warning');
        return;
      }
      
      // Create CSV content
      const headers = ['Customer ID', '‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô', 'Zone', 'Risk Score', '‡∏£‡∏∞‡∏î‡∏±‡∏ö', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å'];
      const csvContent = [
        headers.join(','),
        ...allCustomers.map(customer => [
          customer.customer_id || '',
          customer.customer_name || '',
          customer.employee_name || '',
          customer.employee_zone || '',
          customer.risk_score || '',
          customer.customer_level || '',
          customer.analysis_date ? new Date(customer.analysis_date).toLocaleDateString('th-TH') : ''
        ].join(','))
      ].join('\n');
      
      // Create download link
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.setAttribute('href', url);
      link.setAttribute('download', `customer-data-${new Date().toISOString().split('T')[0]}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      showToast('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô CSV ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
    }

    function clearAllData() {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      
      modal.innerHTML = `
        <div class="modal-content">
          <h3 class="modal-title" style="color: var(--danger-color);">‚ö†Ô∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
          <div class="modal-message">
            <p style="margin: 0; font-size: 1rem; color: var(--text-primary);">
              ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?
            </p>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.875rem; color: var(--text-muted);">
              ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
            </p>
          </div>
          <div class="modal-buttons">
            <button class="btn btn-secondary glass-btn" onclick="this.closest('.modal-overlay').remove()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button class="btn btn-danger glass-btn" onclick="confirmClearAllData(this)">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    function confirmClearAllData(button) {
      // Clear data from SDK
      if (window.dataSdk) {
        // This would typically be done through the SDK's delete all method
        // For now, we'll just clear the local storage
      }
      
      // Clear from localStorage
      localStorage.removeItem('customerData');
      
      // Clear from memory
      allCustomers = [];
      currentRecordCount = 0;
      
      // Update UI
      updateUI();
      
      // Close modal
      button.closest('.modal-overlay').remove();
      
      showToast('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
    }

    function deleteCustomer(customerId) {
      const customer = allCustomers.find(c => 
        c.id === customerId || c.__backendId === customerId
      );
      if (!customer) {
        showToast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', 'error');
        return;
      }

      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      
      modal.innerHTML = `
        <div class="modal-content">
          <h3 class="modal-title" style="color: var(--danger-color);">üóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
          <div class="modal-message">
            <p style="margin: 0; font-size: 1rem; color: var(--text-primary);">
              ‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á <strong>${customer.customer_name || customer.customer_id}</strong> ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?
            </p>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.875rem; color: var(--text-muted);">
              ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ
            </p>
          </div>
          <div class="modal-buttons">
            <button class="btn btn-secondary glass-btn" onclick="this.closest('.modal-overlay').remove()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button class="btn btn-danger glass-btn" onclick="confirmDeleteCustomer('${customerId}', this)">‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    function confirmDeleteCustomer(customerId, button) {
      // Remove from memory
      allCustomers = allCustomers.filter(customer => 
        customer.id !== customerId && customer.__backendId !== customerId
      );
      
      // Update localStorage
      localStorage.setItem('customerData', JSON.stringify(allCustomers));
      
      // Update UI
      updateUI();
      
      // Close modal
      button.closest('.modal-overlay').remove();
      
      showToast('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
    }

    // Helper functions
    function getCommentTypeIcon(type) {
      const icons = {
        'general': 'üí¨',
        'recommendation': 'üí°',
        'follow_up': 'üîÑ',
        'concern': '‚ö†Ô∏è',
        'opportunity': 'üéØ'
      };
      return icons[type] || 'üí¨';
    }

    function getCommentTypeLabel(type) {
      const labels = {
        'general': '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ',
        'recommendation': '‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥',
        'follow_up': '‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•',
        'concern': '‡∏Ç‡πâ‡∏≠‡∏Å‡∏±‡∏á‡∏ß‡∏•',
        'opportunity': '‡πÇ‡∏≠‡∏Å‡∏≤‡∏™'
      };
      return labels[type] || '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ';
    }

    function getZoneDisplayName(zone) {
      const zones = {
        'ratchaburi': 'Zone ‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ',
        'suratthani': 'Zone ‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ',
        'hatyai': 'Zone ‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà',
        'phuket': 'Zone ‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï',
        'samutsakorn': 'Zone ‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£'
      };
      return zones[zone] || zone;
    }
  </script>
</body>
</html>
