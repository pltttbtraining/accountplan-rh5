<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RH5 Customer Analysis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° */
        :root {
            --primary: #007AFF;
            --primary-dark: #0056CC;
            --primary-light: #66AFFF;
            --secondary: #8E8E93;
            --accent: #34C759;
            --success: #30D158;
            --warning: #FF9500;
            --danger: #FF3B30;
            --background: #F2F2F7;
            --surface: #FFFFFF;
            --border: #C6C6C8;
            --text-primary: #000000;
            --text-secondary: #3C3C43;
            --text-muted: #8E8E93;
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px rgba(0,0,0,0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Sarabun', sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 15px;
            min-height: 100vh;
            overflow-x: hidden;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        /* CSS ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏™‡πà‡∏ß‡∏ô Analysis Result */

        /* Analysis Result - ‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà */
        .analysis-result {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-top: 20px;
            border: 1px solid var(--border);
        }

        .wellness-score {
            text-align: center;
            margin-bottom: 24px;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(var(--success) 0% 75%, var(--background) 75% 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            position: relative;
        }

        .score-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .score-label {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .score-description {
            font-size: 14px;
            color: var(--text-muted);
            margin-top: 8px;
        }

        /* Dashboard ‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
            margin-top: 20px;
        }

        .dashboard-card {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: 16px;
            border: 1px solid var(--border);
        }

        .dashboard-title {
            font-size: 17px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dimension-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .dimension-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--background);
            border-radius: var(--radius-md);
        }

        .dimension-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .dimension-name {
            font-weight: 600;
            font-size: 15px;
        }

        .dimension-score {
            font-size: 13px;
            color: var(--text-muted);
        }

        .dimension-value {
            font-weight: 600;
            font-size: 16px;
        }

        .progress-bar {
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        /* Protection Gaps */
        .gaps-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .gap-item {
            padding: 12px;
            border-radius: var(--radius-md);
            text-align: center;
        }

        .gap-high {
            background: rgba(255, 59, 48, 0.1);
            border: 1px solid var(--danger);
        }

        .gap-medium {
            background: rgba(255, 149, 0, 0.1);
            border: 1px solid var(--warning);
        }

        .gap-low {
            background: rgba(52, 199, 89, 0.1);
            border: 1px solid var(--success);
        }

        .gap-minimal {
            background: rgba(142, 142, 147, 0.1);
            border: 1px solid var(--secondary);
        }

        .gap-name {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .gap-value {
            font-size: 18px;
            font-weight: 700;
        }

        /* Roadmap */
        .roadmap {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .roadmap-phase {
            padding: 16px;
            border-radius: var(--radius-md);
            border-left: 4px solid var(--primary);
            background: var(--background);
        }

        .phase-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .phase-title {
            font-weight: 600;
        }

        .phase-timeline {
            font-size: 14px;
            color: var(--text-muted);
            background: var(--surface);
            padding: 4px 8px;
            border-radius: var(--radius-sm);
        }

        .phase-products {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .product-tag {
            background: var(--surface);
            padding: 6px 12px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            border: 1px solid var(--border);
        }

        /* ‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° */
        /* ... */

    </style>
</head>
<body>
    <!-- Welcome Screen ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° -->
    <div class="welcome-screen" id="welcomeScreen">
        <!-- ... -->
    </div>

    <div class="main-app" id="mainApp">
        <!-- Header ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° -->
        <div class="ios-header">
            <!-- ... -->
        </div>

        <div class="ios-container">
            <!-- Role Selection ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° -->
            <div id="roleSelection">
                <!-- ... -->
            </div>

            <!-- Employee Content -->
            <div class="content-area" id="employeeContent">
                <!-- Search Section ‡πÅ‡∏•‡∏∞ Progress ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° -->
                <div class="ios-card">
                    <!-- ... -->
                </div>

                <div class="progress-container">
                    <!-- ... -->
                </div>

                <!-- Customer Form ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
                <form id="customerForm">
                    <!-- ... (‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î) ... -->
                </form>

                <!-- Analysis Result - ‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
                <div class="analysis-result" id="analysisResult" style="display: none;">
                    <div class="wellness-score">
                        <div class="score-circle" id="wellnessCircle">
                            <div class="score-value" id="wellnessScore">-</div>
                        </div>
                        <div class="score-label" id="wellnessLabel">Financial Wellness Score</div>
                        <div class="score-description" id="wellnessDescription">-</div>
                    </div>
                    
                    <!-- Financial Health Dashboard -->
                    <div class="dashboard">
                        <!-- Financial Health Dimensions -->
                        <div class="dashboard-card">
                            <div class="dashboard-title">
                                <span>üìä ‡∏°‡∏¥‡∏ï‡∏¥‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</span>
                            </div>
                            <div class="dimension-grid" id="dimensionsGrid">
                                <!-- Dynamic content -->
                            </div>
                        </div>
                        
                        <!-- Protection Gaps -->
                        <div class="dashboard-card">
                            <div class="dashboard-title">
                                <span>üõ°Ô∏è ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á</span>
                            </div>
                            <div class="gaps-grid" id="gapsGrid">
                                <!-- Dynamic content -->
                            </div>
                        </div>
                        
                        <!-- Product Roadmap -->
                        <div class="dashboard-card">
                            <div class="dashboard-title">
                                <span>üóìÔ∏è ‡πÅ‡∏ú‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå</span>
                            </div>
                            <div class="roadmap" id="productRoadmap">
                                <!-- Dynamic content -->
                            </div>
                        </div>

                        <!-- Detailed Recommendations -->
                        <div class="dashboard-card">
                            <div class="dashboard-title">
                                <span>üéØ ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å</span>
                            </div>
                            <div id="detailedRecommendations">
                                <!-- Dynamic content -->
                            </div>
                        </div>
                    </div>
                    
                    <button class="ios-button ios-button-outline" onclick="generatePDF()" style="width: 100%; margin-top: 16px;">
                        üìÑ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô PDF
                    </button>
                </div>
            </div>

            <!-- Coach Content ‡πÅ‡∏•‡∏∞ Admin Content ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° -->
            <div class="content-area" id="coachContent">
                <!-- ... -->
            </div>

            <div class="content-area" id="adminContent">
                <!-- ... -->
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="ios-toast" id="toast"></div>

    <script>
        // Global variables - ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°
        let currentRole = '';
        let selectedCustomerTypes = [];
        let childrenAges = [];
        let allCustomers = JSON.parse(localStorage.getItem('customerData') || '[]');
        let navigationHistory = [];

        // Initialize the application - ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°
            setupEventListeners();
            generateCustomerId();
            updateProgress();
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô setupEventListeners, enterSystem, goBack, goHome, 
        // showRoleSelection, selectRole, showAuthenticationModal, verifyAuthentication,
        // proceedToRole, getRoleName, toggleCustomerType, addChildAge, removeChildAge,
        // updateChildrenList, generateCustomerId, updateProgress
        // ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô saveCustomerData - ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÉ‡∏´‡∏°‡πà
        function saveCustomerData() {
            // Validate customer types
            if (selectedCustomerTypes.length < 2) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', 'warning');
                return;
            }
            
            const formData = collectFormData();
            const analysis = analyzeFinancialWellness(formData); // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÉ‡∏´‡∏°‡πà
            
            // Save to localStorage
            allCustomers.push({
                ...formData,
                ...analysis,
                id: Date.now().toString(),
                created_at: new Date().toISOString()
            });
            
            localStorage.setItem('customerData', JSON.stringify(allCustomers));
            
            // Show analysis result
            displayAnalysisResult(analysis);
            
            showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            
            // Scroll to results
            document.getElementById('analysisResult').scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô collectFormData ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        function collectFormData() {
            const kongsi = document.querySelector('input[name="kongsi"]:checked');
            
            return {
                customer_id: document.getElementById('customerId').value,
                full_name: document.getElementById('fullName').value,
                nickname: document.getElementById('nickname').value,
                managers: document.getElementById('managers').value,
                customer_types: selectedCustomerTypes,
                
                // Personal Information
                goals: document.getElementById('goals').value,
                gender: document.getElementById('gender').value,
                age: parseInt(document.getElementById('age').value) || 0,
                marital_status: document.getElementById('maritalStatus').value,
                occupation: document.getElementById('occupation').value,
                net_income: parseInt(document.getElementById('netIncome').value) || 0,
                employment_benefits: document.getElementById('employmentBenefits').value,
                monthly_liabilities: parseInt(document.getElementById('monthlyLiabilities').value) || 0,
                risk_appetite: document.getElementById('riskAppetite').value,
                property_type: document.getElementById('propertyType').value,
                property_value: parseInt(document.getElementById('propertyValue').value) || 0,
                vehicle_type: document.getElementById('vehicleType').value,
                vehicle_value: parseInt(document.getElementById('vehicleValue').value) || 0,
                deposits: parseInt(document.getElementById('deposits').value) || 0,
                bonds: parseInt(document.getElementById('bonds').value) || 0,
                funds: parseInt(document.getElementById('funds').value) || 0,
                credit_card_balance: parseInt(document.getElementById('creditCardBalance').value) || 0,
                loan_balance: parseInt(document.getElementById('loanBalance').value) || 0,
                life_insurance: document.getElementById('lifeInsurance').value,
                aum_ttb: parseInt(document.getElementById('aumTtb').value) || 0,
                aum_other: parseInt(document.getElementById('aumOther').value) || 0,
                lifestyle: document.getElementById('lifestyle').value,
                sensitive_issue: document.getElementById('sensitiveIssue').value,
                other_details: document.getElementById('otherDetails').value,
                
                // Family Information
                spouse_age: parseInt(document.getElementById('spouseAge').value) || 0,
                spouse_occupation: document.getElementById('spouseOccupation').value,
                children_count: parseInt(document.getElementById('childrenCount').value) || 0,
                children_ages: [...childrenAges],
                children_occupation: document.getElementById('childrenOccupation').value,
                grandchildren_count: parseInt(document.getElementById('grandchildrenCount').value) || 0,
                other_relatives: document.getElementById('otherRelatives').value,
                decision_maker: document.getElementById('decisionMaker').value,
                kongsi: kongsi ? kongsi.value : '',
                
                // Business Information
                business_name: document.getElementById('businessName').value,
                business_type: document.getElementById('businessType').value,
                registered_capital: parseInt(document.getElementById('registeredCapital').value) || 0,
                business_revenue: parseInt(document.getElementById('businessRevenue').value) || 0,
                net_profit: parseInt(document.getElementById('netProfit').value) || 0,
                last_year_tax: parseInt(document.getElementById('lastYearTax').value) || 0,
                share_percentage: parseInt(document.getElementById('sharePercentage').value) || 0,
                shareholder_equity: parseInt(document.getElementById('shareholderEquity').value) || 0,
                business_other_details: document.getElementById('businessOtherDetails').value
            };
        }

        // ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        function analyzeFinancialWellness(data) {
            // 1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Financial Health (40%)
            const financialHealth = analyzeFinancialHealth(data);
            
            // 2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Protection Gaps (30%)
            const protectionGaps = analyzeProtectionGaps(data);
            
            // 3. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Life Stage Readiness (20%)
            const lifeStage = analyzeLifeStage(data);
            
            // 4. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Behavioral Profile (10%)
            const behavioralProfile = analyzeBehavioralProfile(data);
            
            // 5. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Wellness Score ‡∏£‡∏ß‡∏°
            const wellnessScore = Math.round(
                financialHealth.score * 0.4 +
                protectionGaps.score * 0.3 +
                lifeStage.score * 0.2 +
                behavioralProfile.score * 0.1
            );
            
            // 6. ‡∏™‡∏£‡πâ‡∏≤‡∏á Product Roadmap
            const productRoadmap = generateProductRoadmap(data, financialHealth, protectionGaps);
            
            // 7. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å
            const detailedRecommendations = generateDetailedRecommendations(data, financialHealth, protectionGaps);
            
            return {
                wellness_score: wellnessScore,
                wellness_label: getWellnessLabel(wellnessScore),
                wellness_description: getWellnessDescription(wellnessScore),
                financial_health: financialHealth,
                protection_gaps: protectionGaps,
                life_stage: lifeStage,
                behavioral_profile: behavioralProfile,
                product_roadmap: productRoadmap,
                detailed_recommendations: detailedRecommendations
            };
        }

        function analyzeFinancialHealth(data) {
            let score = 0;
            const dimensions = [];
            
            // 1. ‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô (10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)
            const emergencyMonths = data.deposits / (data.monthly_liabilities || 1);
            let emergencyScore = 0;
            if (emergencyMonths >= 6) emergencyScore = 10;
            else if (emergencyMonths >= 3) emergencyScore = 7;
            else if (emergencyMonths >= 1) emergencyScore = 4;
            dimensions.push({
                name: "‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô",
                score: emergencyScore,
                maxScore: 10,
                description: `‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á ${emergencyMonths.toFixed(1)} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`
            });
            score += emergencyScore;
            
            // 2. ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô (10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)
            const totalDebt = (data.credit_card_balance || 0) + (data.loan_balance || 0) + (data.monthly_liabilities || 0) * 12;
            const dti = data.net_income > 0 ? totalDebt / data.net_income : 1;
            let debtScore = 0;
            if (dti < 0.3) debtScore = 10;
            else if (dti < 0.5) debtScore = 7;
            else if (dti < 0.7) debtScore = 4;
            dimensions.push({
                name: "‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô",
                score: debtScore,
                maxScore: 10,
                description: `DTI: ${(dti * 100).toFixed(1)}%`
            });
            score += debtScore;
            
            // 3. ‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)
            const totalAssets = (data.property_value || 0) + (data.vehicle_value || 0) + 
                              (data.deposits || 0) + (data.bonds || 0) + (data.funds || 0) +
                              (data.aum_ttb || 0) + (data.aum_other || 0);
            const totalLiabilities = (data.credit_card_balance || 0) + (data.loan_balance || 0);
            const netWorth = totalAssets - totalLiabilities;
            
            let netWorthScore = 0;
            if (netWorth > data.net_income * 5) netWorthScore = 10;
            else if (netWorth > data.net_income * 3) netWorthScore = 7;
            else if (netWorth > 0) netWorthScore = 4;
            dimensions.push({
                name: "‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏∏‡∏ó‡∏ò‡∏¥",
                score: netWorthScore,
                maxScore: 10,
                description: `‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤: ${netWorth.toLocaleString()} ‡∏ö‡∏≤‡∏ó`
            });
            score += netWorthScore;
            
            // 4. ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå (10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)
            const assetTypes = [
                data.property_value > 0,
                data.vehicle_value > 0,
                data.deposits > 0,
                data.bonds > 0,
                data.funds > 0,
                data.aum_ttb > 0,
                data.aum_other > 0
            ].filter(Boolean).length;
            
            let diversificationScore = 0;
            if (assetTypes >= 4) diversificationScore = 10;
            else if (assetTypes >= 2) diversificationScore = 7;
            else diversificationScore = 4;
            dimensions.push({
                name: "‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå",
                score: diversificationScore,
                maxScore: 10,
                description: `‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå: ${assetTypes}`
            });
            score += diversificationScore;
            
            return {
                score: score,
                totalScore: 40,
                dimensions: dimensions
            };
        }

        function analyzeProtectionGaps(data) {
            const gaps = [];
            let totalGapScore = 0;
            
            // 1. ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
            let healthGap = 0;
            if (data.employment_benefits === 'no_benefits') healthGap += 4;
            if (data.age > 45) healthGap += 3;
            if (!data.life_insurance || data.life_insurance.trim() === '') healthGap += 2;
            if (data.sensitive_issue && data.sensitive_issue.toLowerCase().includes('‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û')) healthGap += 1;
            
            healthGap = Math.min(10, healthGap);
            gaps.push({
                name: "‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û",
                score: healthGap,
                description: getGapDescription(healthGap)
            });
            totalGapScore += healthGap;
            
            // 2. ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï
            let lifeGap = 0;
            const humanLifeValue = data.net_income * 10;
            const currentCoverage = data.life_insurance ? parseLifeInsuranceCoverage(data.life_insurance) : 0;
            const coverageRatio = currentCoverage / humanLifeValue;
            
            if (coverageRatio < 0.5) lifeGap += 4;
            if (data.marital_status === 'married') lifeGap += 3;
            if (data.children_count > 0) lifeGap += 2;
            if (data.children_ages.some(age => age < 22)) lifeGap += 1;
            
            lifeGap = Math.min(10, lifeGap);
            gaps.push({
                name: "‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï",
                score: lifeGap,
                description: `HLV: ${humanLifeValue.toLocaleString()} ‡∏ö‡∏≤‡∏ó`
            });
            totalGapScore += lifeGap;
            
            // 3. ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ
            let incomeGap = 0;
            if (data.employment_benefits !== 'executive') incomeGap += 3;
            if (data.monthly_liabilities > data.net_income * 0.3) incomeGap += 3;
            if (['business_owner', 'freelance'].includes(data.occupation)) incomeGap += 2;
            if (data.risk_appetite === 'conservative') incomeGap += 2;
            
            incomeGap = Math.min(10, incomeGap);
            gaps.push({
                name: "‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ",
                score: incomeGap,
                description: getGapDescription(incomeGap)
            });
            totalGapScore += incomeGap;
            
            // 4. ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏°‡∏£‡∏î‡∏Å
            let legacyGap = 0;
            const totalAssets = (data.property_value || 0) + (data.vehicle_value || 0) + 
                              (data.deposits || 0) + (data.bonds || 0) + (data.funds || 0);
            if (totalAssets > 10000000) legacyGap += 4;
            if (data.business_name) legacyGap += 3;
            if (data.children_count > 0) legacyGap += 2;
            if (data.marital_status === 'married') legacyGap += 1;
            
            legacyGap = Math.min(10, legacyGap);
            gaps.push({
                name: "‡∏°‡∏£‡∏î‡∏Å",
                score: legacyGap,
                description: getGapDescription(legacyGap)
            });
            totalGapScore += legacyGap;
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Protection Score (‡∏¢‡∏¥‡πà‡∏á Gap ‡∏ô‡πâ‡∏≠‡∏¢‡∏¢‡∏¥‡πà‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á)
            const protectionScore = Math.max(0, 30 - totalGapScore);
            
            return {
                score: protectionScore,
                totalScore: 30,
                gaps: gaps
            };
        }

        function analyzeLifeStage(data) {
            let score = 0;
            
            // 1. ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏¢ (10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)
            if (data.age < 35) {
                // ‡∏ä‡πà‡∏ß‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô
                score += data.risk_appetite === 'high' ? 8 : 6;
                if (data.net_income > 50000) score += 2;
            } else if (data.age < 50) {
                // ‡∏ä‡πà‡∏ß‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏á‡∏Ñ‡∏±‡πà‡∏á
                score += 7;
                const assets = (data.property_value || 0) + (data.deposits || 0);
                if (assets > data.net_income * 3) score += 3;
            } else if (data.age < 60) {
                // ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì
                score += 6;
                const retirementReady = (data.funds || 0) + (data.bonds || 0) > data.net_income * 5;
                if (retirementReady) score += 4;
            } else {
                // ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏Å‡∏©‡∏µ‡∏¢‡∏ì
                score += 5;
                const stableIncome = (data.deposits || 0) > data.net_income * 2;
                if (stableIncome) score += 5;
            }
            
            // 2. ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)
            if (data.goals && data.goals.trim() !== '') {
                score += 5;
                const hasShortTerm = data.goals.toLowerCase().includes('‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô') || 
                                  data.goals.toLowerCase().includes('short');
                const hasLongTerm = data.goals.toLowerCase().includes('‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß') || 
                                  data.goals.toLowerCase().includes('long');
                if (hasShortTerm && hasLongTerm) score += 5;
                else if (hasShortTerm || hasLongTerm) score += 3;
            }
            
            return {
                score: Math.min(20, score),
                totalScore: 20
            };
        }

        function analyzeBehavioralProfile(data) {
            let score = 0;
            
            // 1. ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï (5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)
            if (data.lifestyle) {
                const lifestyle = data.lifestyle.toLowerCase();
                if (lifestyle.includes('‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î') || lifestyle.includes('save')) score += 3;
                else if (lifestyle.includes('‡∏™‡∏°‡∏î‡∏∏‡∏•') || lifestyle.includes('balance')) score += 2;
                else if (lifestyle.includes('‡∏ü‡∏∏‡πà‡∏°‡πÄ‡∏ü‡∏∑‡∏≠‡∏¢') || lifestyle.includes('luxury')) score += 1;
            }
            
            // 2. ‡∏ó‡∏±‡∏®‡∏ô‡∏Ñ‡∏ï‡∏¥‡∏ï‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á (5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)
            if (data.risk_appetite === 'conservative') score += 2;
            else if (data.risk_appetite === 'medium') score += 3;
            else if (data.risk_appetite === 'high') score += 1;
            
            // 3. ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (5 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)
            if (data.customer_types.includes('analytical')) score += 2;
            if (data.customer_types.includes('goal_oriented')) score += 2;
            if (data.customer_types.includes('conservative')) score += 1;
            
            return {
                score: Math.min(10, score),
                totalScore: 10
            };
        }

        function generateProductRoadmap(data, financialHealth, protectionGaps) {
            const roadmap = [];
            
            // Phase 1: Foundation Protection (0-6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)
            const phase1 = {
                title: "‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô",
                timeline: "0-6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô",
                products: []
            };
            
            if (protectionGaps.gaps.find(g => g.name === "‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û").score >= 7) {
                phase1.products.push("‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û (‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô 5-10 ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó)");
            }
            
            if (protectionGaps.gaps.find(g => g.name === "‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï").score >= 6) {
                phase1.products.push("‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÅ‡∏ö‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡∏™‡∏±‡πâ‡∏ô (Term Life)");
            }
            
            if (financialHealth.dimensions.find(d => d.name === "‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô").score < 7) {
                phase1.products.push("‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô (6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)");
            }
            
            if (phase1.products.length > 0) {
                roadmap.push(phase1);
            }
            
            // Phase 2: Wealth Building (6-18 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)
            const phase2 = {
                title: "‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏á‡∏Ñ‡∏±‡πà‡∏á",
                timeline: "6-18 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô",
                products: []
            };
            
            if (data.age < 50 && data.risk_appetite !== 'low') {
                phase2.products.push("‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÅ‡∏ö‡∏ö‡∏™‡∏∞‡∏™‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå");
                phase2.products.push("‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏£‡∏∞‡∏¢‡∏∞‡∏Å‡∏•‡∏≤‡∏á");
            }
            
            if (protectionGaps.gaps.find(g => g.name === "‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ").score >= 5) {
                phase2.products.push("‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ");
            }
            
            if (phase2.products.length > 0) {
                roadmap.push(phase2);
            }
            
            // Phase 3: Legacy Planning (18+ ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)
            const phase3 = {
                title: "‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏°‡∏£‡∏î‡∏Å",
                timeline: "18+ ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô",
                products: []
            };
            
            if (protectionGaps.gaps.find(g => g.name === "‡∏°‡∏£‡∏î‡∏Å").score >= 5) {
                phase3.products.push("‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÅ‡∏ö‡∏ö‡∏ï‡∏•‡∏≠‡∏î‡∏ä‡∏µ‡∏û");
            }
            
            const totalAssets = (data.property_value || 0) + (data.vehicle_value || 0);
            if (totalAssets > 10000000) {
                phase3.products.push("‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏°‡∏£‡∏î‡∏Å");
            }
            
            if (data.business_name) {
                phase3.products.push("‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠‡∏´‡∏∏‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏Å (Key Person)");
            }
            
            if (phase3.products.length > 0) {
                roadmap.push(phase3);
            }
            
            return roadmap;
        }

        function generateDetailedRecommendations(data, financialHealth, protectionGaps) {
            const recommendations = [];
            
            // ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á
            const emergencyScore = financialHealth.dimensions.find(d => d.name === "‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô").score;
            if (emergencyScore < 7) {
                recommendations.push({
                    icon: "üí∞",
                    title: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô",
                    description: `‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 3-6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ (‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ${(data.deposits/(data.monthly_liabilities || 1)).toFixed(1)} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)`
                });
            }
            
            // ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô
            const debtScore = financialHealth.dimensions.find(d => d.name === "‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô").score;
            if (debtScore < 7) {
                recommendations.push({
                    icon: "üìâ",
                    title: "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô",
                    description: "‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏¥‡∏ô‡∏ï‡πà‡∏≠‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (DTI) ‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏Ñ‡∏ß‡∏£‡∏•‡∏î‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°"
                });
            }
            
            // ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏î‡πâ‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
            const healthGap = protectionGaps.gaps.find(g => g.name === "‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û").score;
            if (healthGap >= 7) {
                recommendations.push({
                    icon: "üè•",
                    title: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û",
                    description: "‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á ‡∏Ñ‡∏ß‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÇ‡∏£‡∏Ñ‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á"
                });
            }
            
            // ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏î‡πâ‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï
            const lifeGap = protectionGaps.gaps.find(g => g.name === "‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï").score;
            if (lifeGap >= 6) {
                recommendations.push({
                    icon: "üõ°Ô∏è",
                    title: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï",
                    description: "‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏∞ ‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß"
                });
            }
            
            return recommendations;
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠
        function getWellnessLabel(score) {
            if (score >= 90) return "‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°";
            if (score >= 75) return "‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏î‡∏µ";
            if (score >= 60) return "‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á";
            if (score >= 40) return "‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á";
            return "‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏π‡∏á";
        }

        function getWellnessDescription(score) {
            if (score >= 90) return "‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á‡∏™‡∏π‡∏á ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß";
            if (score >= 75) return "‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏î‡∏µ ‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï";
            if (score >= 60) return "‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏ô‡∏ö‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô";
            if (score >= 40) return "‡∏Ñ‡∏ß‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô";
            return "‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô";
        }

        function getGapDescription(gapScore) {
            if (gapScore >= 8) return "‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏π‡∏á";
            if (gapScore >= 6) return "‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á";
            if (gapScore >= 4) return "‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢";
            return "‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏°‡∏≤‡∏Å";
        }

        function parseLifeInsuranceCoverage(lifeInsurance) {
            // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏ó‡∏∏‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï
            const matches = lifeInsurance.match(/\d+/g);
            return matches ? parseInt(matches[0]) * 1000000 : 0; // ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÅ‡∏£‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏ó‡∏∏‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÉ‡∏´‡∏°‡πà
        function displayAnalysisResult(analysis) {
            // Wellness Score
            document.getElementById('wellnessScore').textContent = analysis.wellness_score;
            document.getElementById('wellnessLabel').textContent = analysis.wellness_label;
            document.getElementById('wellnessDescription').textContent = analysis.wellness_description;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ß‡∏á‡∏Å‡∏•‡∏° Wellness Score
            const circle = document.getElementById('wellnessCircle');
            const percentage = analysis.wellness_score;
            circle.style.background = `conic-gradient(var(--success) 0% ${percentage}%, var(--background) ${percentage}% 100%)`;
            
            // Financial Health Dimensions
            displayFinancialHealthDimensions(analysis.financial_health);
            
            // Protection Gaps
            displayProtectionGaps(analysis.protection_gaps);
            
            // Product Roadmap
            displayProductRoadmap(analysis.product_roadmap);
            
            // Detailed Recommendations
            displayDetailedRecommendations(analysis.detailed_recommendations);
            
            document.getElementById('analysisResult').style.display = 'block';
        }

        function displayFinancialHealthDimensions(financialHealth) {
            const container = document.getElementById('dimensionsGrid');
            container.innerHTML = '';
            
            financialHealth.dimensions.forEach(dimension => {
                const percentage = (dimension.score / dimension.maxScore) * 100;
                const item = document.createElement('div');
                item.className = 'dimension-item';
                
                item.innerHTML = `
                    <div class="dimension-info">
                        <div class="dimension-name">${dimension.name}</div>
                        <div class="dimension-score">${dimension.description}</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%; background: ${getScoreColor(percentage)};"></div>
                        </div>
                    </div>
                    <div class="dimension-value">${dimension.score}/${dimension.maxScore}</div>
                `;
                
                container.appendChild(item);
            });
        }

        function displayProtectionGaps(protectionGaps) {
            const container = document.getElementById('gapsGrid');
            container.innerHTML = '';
            
            protectionGaps.gaps.forEach(gap => {
                const gapClass = getGapClass(gap.score);
                const item = document.createElement('div');
                item.className = `gap-item ${gapClass}`;
                
                item.innerHTML = `
                    <div class="gap-name">${gap.name}</div>
                    <div class="gap-value">${gap.score}/10</div>
                    <div style="font-size: 12px; margin-top: 4px;">${gap.description}</div>
                `;
                
                container.appendChild(item);
            });
        }

        function displayProductRoadmap(roadmap) {
            const container = document.getElementById('productRoadmap');
            container.innerHTML = '';
            
            if (roadmap.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-muted);">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</p>';
                return;
            }
            
            roadmap.forEach(phase => {
                const phaseElement = document.createElement('div');
                phaseElement.className = 'roadmap-phase';
                
                let productsHTML = '';
                phase.products.forEach(product => {
                    productsHTML += `<div class="product-tag">${product}</div>`;
                });
                
                phaseElement.innerHTML = `
                    <div class="phase-header">
                        <div class="phase-title">${phase.title}</div>
                        <div class="phase-timeline">${phase.timeline}</div>
                    </div>
                    <div class="phase-products">
                        ${productsHTML}
                    </div>
                `;
                
                container.appendChild(phaseElement);
            });
        }

        function displayDetailedRecommendations(recommendations) {
            const container = document.getElementById('detailedRecommendations');
            container.innerHTML = '';
            
            if (recommendations.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-muted);">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</p>';
                return;
            }
            
            recommendations.forEach(rec => {
                const recElement = document.createElement('div');
                recElement.style.cssText = `
                    display: flex;
                    align-items: flex-start;
                    gap: 12px;
                    padding: 12px;
                    background: var(--background);
                    border-radius: var(--radius-md);
                    margin-bottom: 8px;
                `;
                
                recElement.innerHTML = `
                    <div style="font-size: 20px;">${rec.icon}</div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; margin-bottom: 4px;">${rec.title}</div>
                        <div style="font-size: 14px; color: var(--text-secondary);">${rec.description}</div>
                    </div>
                `;
                
                container.appendChild(recElement);
            });
        }

        function getScoreColor(percentage) {
            if (percentage >= 80) return 'var(--success)';
            if (percentage >= 60) return 'var(--warning)';
            return 'var(--danger)';
        }

        function getGapClass(gapScore) {
            if (gapScore >= 8) return 'gap-high';
            if (gapScore >= 6) return 'gap-medium';
            if (gapScore >= 4) return 'gap-low';
            return 'gap-minimal';
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô generatePDF - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ü‡∏≠‡∏ô‡∏ï‡πå
        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // ‡πÉ‡∏ä‡πâ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô
            doc.setFont('helvetica');
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Financial Wellness
            const analysis = analyzeFinancialWellness(collectFormData());
            
            // Header
            doc.setFontSize(20);
            doc.setTextColor(0, 122, 255);
            doc.text('‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', 105, 20, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            doc.text('RH5 Financial Wellness System', 105, 30, { align: 'center' });
            
            // Wellness Score
            doc.setFontSize(16);
            doc.setTextColor(0, 0, 0);
            doc.text(`Financial Wellness Score: ${analysis.wellness_score}/100`, 20, 50);
            
            doc.setFontSize(12);
            doc.text(`‡∏£‡∏∞‡∏î‡∏±‡∏ö: ${analysis.wellness_label}`, 20, 60);
            doc.text(analysis.wellness_description, 20, 68);
            
            // Financial Health Summary
            let yPos = 85;
            doc.setFontSize(14);
            doc.text('‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô', 20, yPos);
            
            yPos += 10;
            doc.setFontSize(10);
            analysis.financial_health.dimensions.forEach(dim => {
                doc.text(`${dim.name}: ${dim.score}/${dim.maxScore} - ${dim.description}`, 20, yPos);
                yPos += 7;
            });
            
            // Protection Gaps
            yPos += 10;
            doc.setFontSize(14);
            doc.text('‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡πâ‡∏°‡∏Ñ‡∏£‡∏≠‡∏á', 20, yPos);
            
            yPos += 10;
            doc.setFontSize(10);
            analysis.protection_gaps.gaps.forEach(gap => {
                doc.text(`${gap.name}: ${gap.score}/10 - ${gap.description}`, 20, yPos);
                yPos += 7;
            });
            
            // Product Recommendations
            yPos += 10;
            doc.setFontSize(14);
            doc.text('‡πÅ‡∏ú‡∏ô‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå', 20, yPos);
            
            yPos += 10;
            doc.setFontSize(10);
            analysis.product_roadmap.forEach(phase => {
                doc.text(`${phase.timeline}: ${phase.title}`, 20, yPos);
                yPos += 7;
                phase.products.forEach(product => {
                    doc.text(`  ‚Ä¢ ${product}`, 25, yPos);
                    yPos += 7;
                });
                yPos += 3;
            });
            
            // Timestamp
            yPos += 10;
            doc.setFontSize(8);
            doc.setTextColor(150, 150, 150);
            doc.text(`‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${new Date().toLocaleString('th-TH')}`, 20, yPos);
            
            // Save the PDF
            doc.save(`financial-wellness-${collectFormData().customer_id}.pdf`);
            showToast('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô PDF ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        // searchExistingCustomer, displaySearchResult, clearSearch, loadCustomerForEdit, 
        // viewCustomerDetail, searchCustomers, displayCoachResults, clearCoachSearch,
        // addCoachComment, saveCoachComment, generateReport, displayAdminResults, 
        // exportToExcel, showToast

    </script>
</body>
</html>